{"version":3,"sources":["webpack:///webpack/bootstrap 7d7e9094d035614efc27","webpack:///external \"child_process\"","webpack:///../shell-command.js","webpack:///external \"assert\"","webpack:///external \"fs-extra\"","webpack:///external \"node-uuid\"","webpack:///external \"path\"","webpack:///external \"terminate\"","webpack:///external \"website-scraper\"","webpack:///./testdevenv2.js"],"names":["module","exports","commandToRun","options","stdio","command","args","childProcess","require","proc","spawn","on","code","signal","process","kill","pid","exit","describe","contentToBundle","bundleHasContent","before","done","timeout","monorepoDir","resolve","__dirname","testdevenvMain","testdevenvMainJs","ensureDirSync","writeFileSync","devEnvProcess","stdout","data","console","log","toString","dataString","indexOf","scrapeDir","removeSync","d","urls","directory","resourceSaver","resource","url","text","substring","err","then","stderr","it","equal"],"mappings":";;AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA,mDAA2C,cAAc;;AAEzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;AChEA,0C;;;;;;;;;ACAA;AACA;;;;;;;;;;;;AAYAA,OAAOC,OAAP,GAAiB,UAACC,YAAD,EAAkD;AAAA,MAAnCC,OAAmC,uEAAzB,EAAEC,OAAO,SAAT,EAAyB;;AACjE,MAAMC,UAAU,IAAhB;AACA,MAAMC,OAAO,CACX,IADW,EAEXJ,YAFW,CAAb;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACE;;AAEF,MAAMK,eAAe,mBAAAC,CAAQ,CAAR,CAArB;AACA,MAAMC,OAAOF,aAAaG,KAAb,CAAmBL,OAAnB,EAA4BC,IAA5B,EAAkCH,WAAW,EAA7C,CAAb;AACAM,OAAKE,EAAL,CAAQ,MAAR,EAAgB,UAACC,IAAD,EAAOC,MAAP,EAAkB;AAChCC,YAAQH,EAAR,CAAW,MAAX,EAAmB,YAAM;AACvB,UAAIE,MAAJ,EAAY;AACVC,gBAAQC,IAAR,CAAaD,QAAQE,GAArB,EAA0BH,MAA1B;AACD,OAFD,MAEO;AACLC,gBAAQG,IAAR,CAAaL,IAAb;AACD;AACF,KAND;AAOD,GARD;AASA,SAAOH,IAAP;AACA;AACD,CA5BD,C;;;;;;ACbA,mC;;;;;;ACAA,qC;;;;;;ACAA,sC;;;;;;ACAA,iC;;;;;;ACAA,sC;;;;;;ACAA,4C;;;;;;;;;;;qjBCAA;;AAKA;;;AAJA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;AACA;;AACA;;;;AACA;;;;;;AAEAS,SAAS,MAAT,EAAiB,YAAW;AAC1BA,WAAS,2BAAT,EAAsC,YAAM;AAC1C,QAAMC,kBAAkB,mBAAxB;AACA,QAAIC,mBAAmB,KAAvB;AACAC,WAAO,UAAUC,IAAV,EAAgB;AACrB,WAAKC,OAAL,CAAa,KAAb;AACA,UAAMC,cAAc,eAAKC,OAAL,CAAaC,SAAb,EAAwB,WAAxB,CAApB;AACA,UAAMC,iBAAiB,eAAKF,OAAL,CAAaD,WAAb,EAA0B,4BAA1B,CAAvB;AACA,UAAMI,mBAAmB,eAAKH,OAAL,CAAaE,cAAb,EAA6B,sBAA7B,CAAzB;AACA,wBAAGE,aAAH,CAAiBF,cAAjB;AACA,wBAAGG,aAAH,CAAiBF,gBAAjB,8BAA4DT,eAA5D;;AAEA,UAAMY,gBAAgB,oHAElB,IAFkB,CAEd,sBAFc,CAAtB;AAGAA,oBAAcC,MAAd,CAAqBrB,EAArB,CAAwB,MAAxB,EAAgC,UAACsB,IAAD,EAAU;AACxCC,gBAAQC,GAAR,CAAY,6DAA6DF,KAAKG,QAAL,EAAzE;AACA,YAAMC,aAAaJ,KAAKG,QAAL,EAAnB;;AAEA,YAAIC,WAAWC,OAAX,CAAmB,iCAAnB,MAA0D,CAAC,CAA/D,EAAkE;AAChEJ,kBAAQC,GAAR,CAAY,4BAAZ;AACA,cAAMI,YAAY,eAAKd,OAAL,CAAaE,cAAb,EAA4B,UAA5B,CAAlB;AACA,4BAAGa,UAAH,CAAcD,SAAd;AACA,cAAIE,IAAI,KAAR;AACA,wCAAO;AACLC,kBAAM,CAAC,wBAAD,CADD;AAELC,uBAAWJ,SAFN;AAGLK;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,6CACgBC,QADhB,EAC0B;AACtBX,0BAAQC,GAAR,CAAY,UAAZ,EAAwBU,SAASC,GAAjC,EAAsCD,SAASE,IAAT,CAAcC,SAAd,CAAwB,CAAxB,EAA0B,EAA1B,CAAtC;AACAd,0BAAQC,GAAR,CAAY,aAAZ,EAA2BU,SAASE,IAAT,CAAcT,OAAd,CAAsBnB,eAAtB,MAA2C,CAAC,CAAvE;AACAC,qCAAmBA,oBAAoByB,SAASE,IAAT,CAAcT,OAAd,CAAsBnB,eAAtB,MAA2C,CAAC,CAAnF;AACD;AALH;AAAA;AAAA,6CAMgB8B,GANhB,EAMqB;AACjBf,0BAAQC,GAAR,CAAY,gBAAZ,EAA8Bc,GAA9B;AACD;AARH;;AAAA;AAAA;AAHK,WAAP,EAaGC,IAbH,CAaQ,YAAM;AACZhB,oBAAQC,GAAR,CAAY,MAAZ;AACA;AACAb;AACAY,oBAAQC,GAAR,CAAY,eAAZ,EAA4BJ,cAAcf,GAA1C,UAAsDe,cAAcf,GAApE;AACA;AADA,cAEA,yBAAUe,cAAcf,GAAxB,EAA4B,UAAUiC,GAAV,EAAe;AACzC,kBAAIA,GAAJ,EAAS;AAAE;AACTf,wBAAQC,GAAR,CAAY,YAAYc,GAAxB,EADO,CACuB;AAC/B,eAFD,MAGK;AACHf,wBAAQC,GAAR,CAAY,MAAZ,EADG,CACkB;AACtB;AACF,aAPD;AAQA;AACA;AACD,WA7BD;AA8BD;AACF,OAxCD;AAyCAJ,oBAAcoB,MAAd,CAAqBxC,EAArB,CAAwB,MAAxB,EAAgC,UAAUsB,IAAV,EAAgB;AAC9CC,gBAAQC,GAAR,CAAY,aAAaF,KAAKG,QAAL,EAAzB;AACD,OAFD;AAGAL,oBAAcpB,EAAd,CAAiB,MAAjB,EAAyB,UAAUC,IAAV,EAAgB;AACvC;AACAsB,gBAAQC,GAAR,CAAY,iCAAZ,EAA8CvB,IAA9C;AACD,OAHD;AAID,KA3DD;AA4DAwC,OAAG,kBAAH,EAAuB,YAAM;AAC3BlB,cAAQC,GAAR,CAAY,kEAAZ,EAA+Ef,gBAA/E;AACA,uBAAOiC,KAAP,CAAajC,gBAAb,EAA+B,IAA/B;AAED,KAJD;AAKD,GApED;AAqED,CAtED,E","file":"testdevenv2.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 8);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 7d7e9094d035614efc27","module.exports = require(\"child_process\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"child_process\"\n// module id = 0\n// module chunks = 0","/* eslint-disable global-require */\n/*\n  This file used in 2 places\n    1.  This file is executed by the monorepo serving as the monorepo's dev environment.\n        (Only the monorepo uses dev_env like this. When the monorepo's packages are scattered\n        into individual repos, each individual repo has a dev_env dependency\n        in its node_modules folder,\n        but this dev_env is executed from a compiled version of the dev_env.\n        This is called from the individual repo's ./node_modules/.bin/devenv,\n        which points to ./node_modules/@defualt/dev_env/dist/dev_env.js.)\n    2.  This file is executed during the npm prepublish, which creates the /dist folder\n        mentioned in (1) above.\n*/\nmodule.exports = (commandToRun, options = { stdio: 'inherit' }) => {\n  const command = 'sh';\n  const args = [\n    '-c',\n    commandToRun,\n  ];\n  //\n  // kexec doesn't work in windows, so fallback to child_process.spawn\n  // this logic copied from babel-cli/lib/babel-node.js\n  // try {\n  //   const kexec = require('kexec');\n  //   kexec(command, args);\n  // } catch (err) {\n    // if (err.code !== 'MODULE_NOT_FOUND') throw err;\n\n  const childProcess = require('child_process');\n  const proc = childProcess.spawn(command, args, options || {});\n  proc.on('exit', (code, signal) => {\n    process.on('exit', () => {\n      if (signal) {\n        process.kill(process.pid, signal);\n      } else {\n        process.exit(code);\n      }\n    });\n  });\n  return proc;\n  // }\n};\n\n\n\n// WEBPACK FOOTER //\n// ../shell-command.js","module.exports = require(\"assert\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"assert\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"fs-extra\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs-extra\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"node-uuid\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"node-uuid\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"terminate\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"terminate\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"website-scraper\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"website-scraper\"\n// module id = 7\n// module chunks = 0","/* eslint-disable no-console */\nimport terminate from 'terminate';\nimport assert from 'assert';\nimport path from 'path';\nimport fs from 'fs-extra';\n// import walkSync from 'walk-sync';\nimport scrape from 'website-scraper';\nimport { spawn } from 'child_process';\nimport shellCommand from '../shell-command';\nimport { v4 as makeUuid  } from 'node-uuid';\n\ndescribe('asdf', function() {\n  describe('localhost dev environment', () => {\n    const contentToBundle = makeUuid();\n    let bundleHasContent = false;\n    before(function (done) {\n      this.timeout(60000);\n      const monorepoDir = path.resolve(__dirname, '../../../');\n      const testdevenvMain = path.resolve(monorepoDir, './packages/testdevenv-main');\n      const testdevenvMainJs = path.resolve(testdevenvMain, './testdevenv-main.js');\n      fs.ensureDirSync(testdevenvMain);\n      fs.writeFileSync(testdevenvMainJs, `document.body.append('${contentToBundle}');`);\n\n      const devEnvProcess = shellCommand(`(\n        npm run dev -- --tailor-web-bundle-for-testing-of-dev-env-itself\n      )`, null/*{ detached: true }*/);\n      devEnvProcess.stdout.on('data', (data) => {\n        console.log('stdout from mocha child process of `npm run dev`:\\n---\\n' + data.toString());\n        const dataString = data.toString();\n        \n        if (dataString.indexOf('webpack: Compiled successfully.') !== -1) {\n          console.log('OK LETS CHECK OUT THE HTML')\n          const scrapeDir = path.resolve(testdevenvMain,'./scrape');\n          fs.removeSync(scrapeDir);\n          var d = false;\n          scrape({\n            urls: ['http://localhost:3000/'],\n            directory: scrapeDir,\n            resourceSaver: class MyResourceSaver {\n              saveResource (resource) {\n                console.log('resource', resource.url, resource.text.substring(0,20));\n                console.log('IS IT THERE', resource.text.indexOf(contentToBundle) !== -1);\n                bundleHasContent = bundleHasContent || resource.text.indexOf(contentToBundle) !== -1;\n              }\n              errorCleanup (err) {\n                console.log('resource error', err);\n              }\n            }\n          }).then(() => {\n            console.log('THEN');\n            // \n            done();\n            console.log('devEnvProcess',devEnvProcess.pid, typeof devEnvProcess.pid)\n            // process.kill(-devEnvProcess.pid);\n            terminate(devEnvProcess.pid,function (err) {\n              if (err) { // you will get an error if you did not supply a valid process.pid\n                console.log(\"Oopsy: \" + err); // handle errors in your preferred way.\n              }\n              else {\n                console.log('done'); // terminating the Processes succeeded.\n              }\n            });\n            // process.kill(devEnvProcess.pid, 'SIGTERM');\n            // ;\n          });\n        }\n      });\n      devEnvProcess.stderr.on('data', function (data) {\n        console.log('stderr: ' + data.toString());\n      });\n      devEnvProcess.on('exit', function (code) {\n        // shellCommand(`rm -rf ${testingTempDir}`);\n        console.log('child process exited with code:',code);\n      });\n    });\n    it('bundleHasContent', () => {\n      console.log('bundleHasContentbundleHasContentbundleHasContentbundleHasContent',bundleHasContent)\n      assert.equal(bundleHasContent, true);\n      \n    });\n  });\n});\n\n\n// WEBPACK FOOTER //\n// ./testdevenv2.js"],"sourceRoot":""}