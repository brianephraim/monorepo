{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap b304629b4f4fab0ade60","webpack:///external \"jquery-deferred\"","webpack:///external \"aws-sdk\"","webpack:///external \"path\"","webpack:///external \"url\"","webpack:///../ensure-leading-slash/ensure-leading-slash.js","webpack:///../bernieserver/js/prepareModuleWithDefaults.js","webpack:///../bernieserver/js/respondWithJson.js","webpack:///external \"webpack\"","webpack:///external \"yargs\"","webpack:///external \"express\"","webpack:///./core/webpackRunCompiler.js","webpack:///./webpackConfig.js","webpack:///external \"fs-extra\"","webpack:///../bernieserver/js/normalizeImageFileData.js","webpack:///external \"sharp\"","webpack:///../bernieserver/js/uploadToS3.js","webpack:///external \"child_process\"","webpack:///external \"babel-polyfill\"","webpack:///../bernieserver/js/mongooseStuff.js","webpack:///../bernieserver/js/getS3ObjectData.js","webpack:///./dev_env.js","webpack:///./core/shellCommand.js","webpack:///./jest/jestSpawnProcess.js","webpack:///./core/webpackBuildCommandLine.js","webpack:///external \"globby\"","webpack:///external \"webpack-node-externals\"","webpack:///external \"find-node-modules\"","webpack:///external \"extract-css-chunks-webpack-plugin\"","webpack:///external \"autodll-webpack-plugin\"","webpack:///external \"stats-webpack-plugin\"","webpack:///external \"webpack/lib/ProgressPlugin\"","webpack:///external \"node-sass-json-importer\"","webpack:///external \"write-file-webpack-plugin\"","webpack:///./core/webpack-config-resolve.js","webpack:///external \"directory-named-webpack-plugin\"","webpack:///./core/parseRequestResolvePlugin.js","webpack:///external \"single-line-log\"","webpack:///./webpackExpressServer.js","webpack:///./universal/server/demoEndpoints.js","webpack:///external \"cookie-parser\"","webpack:///./universal/server/api.js","webpack:///./startUniversalExpress.js","webpack:///external \"webpack-dev-middleware\"","webpack:///external \"webpack-hot-middleware\"","webpack:///external \"webpack-hot-server-middleware\"","webpack:///external \"rimraf\"","webpack:///./webpackParseStatsForDepProblems.js","webpack:///external \"validate-npm-package-name\"","webpack:///../bernieserver/bernieserver.express.js","webpack:///../bernieserver/bernieExpressServer.js","webpack:///../bernieserver/public/js/mymodule.js","webpack:///external \"ejs\"","webpack:///external \"fs\"","webpack:///external \"mongoose\"","webpack:///external \"mongodb-uri\"","webpack:///../bernieserver/js/endpointCompositeImage.js","webpack:///../bernieserver/js/getAllS3Objects.js","webpack:///external \"mime-types\"","webpack:///../bernieserver/js/meldAndCropImages.js","webpack:///../bernieserver/js/calcOverlayAndTemplateProcessingSettings.js","webpack:///../bernieserver/js/endpointGetNormalizedImageInfo.js","webpack:///../bernieserver/js/urlToFileData.js","webpack:///external \"https\"","webpack:///external \"http\"","webpack:///external \"deep-get-set\"","webpack:///../bernieserver/js/deleteS3Object.js","webpack:///../bernieserver/js/endpointGetS3SignedUploadUrl.js","webpack:///../bernieserver/js/endpointIframeUpload.js","webpack:///../bernieserver/js/apiRequestIntoBufferData.js","webpack:///external \"busboy\"","webpack:///../bernieserver/js/generateUrlRegexNamespace.js","webpack:///../junk-express/junk-express.express.js"],"names":["ensureLeadingSlash","str","replace","module","exports","fun","c","prepareModuleWithDefaults","Object","assign","parseSettings","r","Array","isArray","require","s","res","isSuccess","accessKeyId","secretAccessKey","status","statusCode","error","json","message","write","JSON","stringify","end","processed","Promise","resolve","reject","toUse","activeWebpackDevMiddleware","run","err","stats","console","log","stack","details","info","toJson","hasErrors","errors","forEach","e","hasWarnings","warnings","w","warn","makeProgressPlugin","percentage","msg","current","active","modulepath","process","stdout","isTTY","cursorTo","substr","length","toFixed","clearLine","p","__dirname","removeKeysWithEmptyVals","obj","keys","reduce","accum","key","makeOutputSettingsFromFilePath","filePath","output","split","filename","pop","path","join","makeOutputFiles","libraryNameReduced","isBuild","outputFiles","library","libraryMin","demo","makeEntry","libraryName","dirRoot","MainApp","sync","nodeModulesLocationsArray","relative","nodeModulesLocation","indexOf","externalsOld","readdirSync","filter","x","test","externals","mod","generateConfigJson","options","isCommandLine","entry","isMocha","isReact","isClient","isDev","isUniversal","env","dirroot","cwd","packageJson","readJsonSync","name","trace","config","target","devtool","publicPath","chunkFilename","libraryTarget","umdNamedDefine","modulesDir","rules","use","loader","exclude","extract","modules","localIdentName","importer","plugins","optimize","CommonsChunkPlugin","names","minChunks","Infinity","DefinePlugin","NODE_ENV","UglifyJsPlugin","compress","screw_ie8","mangle","comments","sourceMap","HashedModuleIdsPlugin","context","vendor","BannerPlugin","banner","raw","entryOnly","LimitChunkCountPlugin","maxChunks","apply","compiler","setModuleConstant","expressionName","fn","plugin","compilation","data","normalModuleFactory","parser","compilerParserPlugin","state","addVariable","resource","jD","sharp","parseUrl","parse","dfd","Deferred","buffer","Body","image","metadata","meta","smallestDim","Math","min","width","height","largestDim","max","limit","multiplier","floor","resize","withoutEnlargement","rotate","toBuffer","outputBuffer","manipulatedImageFileData","Key","ContentType","url","originalFilename","promise","aws","mime","extension","lookup","update","s3","S3","s3Params","Bucket","ACL","putObject","uploadResponse","mymoduleName","mongoose","uriUtil","mongooseStuff","MongooseStuff","self","mongodbUri","MONGOLAB_URI","ENVNAME","DATABASE_NAME","mongooseUri","formatMongoose","db","connection","models","SimpleImage","model","Schema","String","ComplexImage","Date","Number","UserTemplate","created","customTemplate","templateHeight","templateWidth","prototype","connect","readyState","server","socketOptions","keepAlive","connectTimeoutMS","replset","once","on","bind","checkUrl","idX","then","findOne","simpleimage","GetComplexImage","GetUserTemplatesAll","find","GetComplexImageAll","MakeUserTemplate","findOneAndUpdate","upsert","arguments","UpdateComplexImage","newRecord","save","getImages","nuke","collection","drop","close","getObject","resolveNullOn404","outputParser","item","testdevenv","watch","testPathPattern","serve","commandToRun","stdio","killParentOnExit","command","args","childProcess","proc","spawn","code","signal","kill","pid","exit","configPath","commandBody","DirectoryNamedWebpackPlugin","parseRequestResolvePlugin","basename","inNodeModulesRE","DirectoryDefaultFilePlugin","resolver","req","done","directory","request","match","fileSystem","stat","isDirectory","index","isFile","doResolve","extensions","requestStr","shift","singleLineLog","printProgress","progress","parseRequest","callback","newRequestStr","serverNamespaces","servers","app","asyncRecurseStartApps","startWebpack","extraServers","bernieserver","static","port","listen","i","recurse","backendAppNamespace","someBackendApp","serveBackendApp","default","backendAppSettings","nameSpace","nextNamespace","demoExpress","next","cookie","cookies","jwToken","maxAge","get","headers","authorization","params","category","slug","findVideos","fakeDelay","fpVideos","reactReduxVideos","dbGraphqlVideos","findVideo","allVideos","video","ms","setTimeout","youtubeId","title","by","color","tip","concat","startUniversal","invalidHandler","fileName","changeTime","statSync","clientDevConfig","serverDevConfig","serverNonUniversalConfig","outputPath","colors","multiCompiler","clientCompiler","compilers","waitUntilValid","serverRendererOptions","isDeploy","serverRender","__non_webpack_require__","clientStats","clientProdConfig","serverProdConfig","serverCompiler","ensureTrailingSlash","ensureReadJsonSync","packageDotJsonPath","packageDotJsonContent","showProblemsInConsole","problems","moduleResource","depName","problemMsg","problemInfo","findDependenciesProblems","dependencies","dep","rawRequest","validationResult","validForNewPackages","devDependencies","webpackParseStatsForDepProblems","shouldShowProblemsInConsole","isMonorepo","existsSync","packageDotJsonCache","packagesDir","packageFolderName","packageSomehowPublic","private","privateFromGithub","depProblems","set","engine","renderFile","AWS_ACCESS_KEY","AWS_SECRET_KEY","S3_BUCKET","render","pageName","urlInfo","deriveUrlInfo","userTemplates","buttonText","query","standardRouteHtmlHandler","urlToUse","pathname","offline","iframebutton","result","mymodule","getStandardModesRegex","images","urlPattern","post","body","send","payload","always","templateBaseUrl","rawImagePrefix","isNode","versions","node","standardModes","mode","featured","old","pipedString","l","RegExp","oldModes","a","push","isOldMode","toCompare","is","containsStardardModeCache","containsStardardMode","contains","DeriveUrlInfo","init","nameSpaceWithLeadingSlash","defaultPathname","slashSplit","coords","dims","splice","y","cropWidth","cropHeight","format","customUrl","customUrlQueryString","makeCustomUrl","normalize","val","def","isNaN","round","doubleNormalize","prexisting","doubleNormalizeInterface","dest","defaults","settings","toLowerCase","toNormalize","rawImage","doStandardSquare","serialize","prefix","whatever","hasOwnProperty","k","v","encodeURIComponent","userPhotoKey","customUrlSettings","template","generateTemplateImgListHtml","imgsHtml","offlineTemplates","parseClientCompositeImageUrl","pathnameSplit","compositeS3Key","templateFilename","userImageAndScalePos","userImageFilename","scalePos","overlaySettings","left","top","extname","fileTypes","fileType","compositeImageInstructions","templateCreateMode","getAllS3ObjectsSettingsDict","userPhoto","retrySearchCriteria","Prefix","dict","bufferData","setHeader","getS3ObjectData","dfdMain","promises","entryName","entryDfd","fail","originalErr","retryBucket","listObjectsV2","Contents","normalizeImageFileData","uploadToS3","when","templateFetchResponse","userPhotoFetchResponse","slice","call","calcOverlayAndTemplateProcessingSettings","responses","templateCroppingMode","bgColor","g","b","alpha","imageProcessingSettings","completelyOutOfBound","responseToProcess","background","flatten","templateBuffer","extend","userPhotoBuffer","png","overlayWith","jpeg","cropSettings","userPhotoWidthHeight","cropTop","cropLeft","cropRight","cropBottom","rawWidth","rawHeight","rawRight","rawBottom","rawTop","rawLeft","right","bottom","urlToFileData","originalUrl","host","now","deep","deleteS3Object","decodeURIComponent","image_url","mustBeSquare","must_be_square","respondWithJsonSuccess","respondWithJsonFail","fileData","abs","failingSquare","uploadToS3Promise","userTemplateModel","isHttps","http","response","chunks","chunk","Buffer","contentType","deleteObjects","Delete","Objects","file_name","secondToLast","s3_params","Expires","file_type","getSignedUrl","signed_request","apiRequestIntoBufferData","lastData","public_id","html","Busboy","filenameDfd","busboy","bufferArray","filenamex","toResolve","fieldname","file","encoding","mimetype","pipe","regx"],"mappings":"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","file":"dist/dev_env.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"jquery-deferred\"), require(\"aws-sdk\"), require(\"path\"), require(\"url\"), require(\"webpack\"), require(\"yargs\"), require(\"express\"), require(\"fs-extra\"), require(\"sharp\"), require(\"child_process\"), require(\"babel-polyfill\"), require(\"globby\"), require(\"webpack-node-externals\"), require(\"find-node-modules\"), require(\"extract-css-chunks-webpack-plugin\"), require(\"autodll-webpack-plugin\"), require(\"stats-webpack-plugin\"), require(\"webpack/lib/ProgressPlugin\"), require(\"node-sass-json-importer\"), require(\"write-file-webpack-plugin\"), require(\"directory-named-webpack-plugin\"), require(\"single-line-log\"), require(\"cookie-parser\"), require(\"webpack-dev-middleware\"), require(\"webpack-hot-middleware\"), require(\"webpack-hot-server-middleware\"), require(\"rimraf\"), require(\"validate-npm-package-name\"), require(\"ejs\"), require(\"fs\"), require(\"mongoose\"), require(\"mongodb-uri\"), require(\"mime-types\"), require(\"https\"), require(\"http\"), require(\"deep-get-set\"), require(\"busboy\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"@defualt/dev_env\", [\"jquery-deferred\", \"aws-sdk\", \"path\", \"url\", \"webpack\", \"yargs\", \"express\", \"fs-extra\", \"sharp\", \"child_process\", \"babel-polyfill\", \"globby\", \"webpack-node-externals\", \"find-node-modules\", \"extract-css-chunks-webpack-plugin\", \"autodll-webpack-plugin\", \"stats-webpack-plugin\", \"webpack/lib/ProgressPlugin\", \"node-sass-json-importer\", \"write-file-webpack-plugin\", \"directory-named-webpack-plugin\", \"single-line-log\", \"cookie-parser\", \"webpack-dev-middleware\", \"webpack-hot-middleware\", \"webpack-hot-server-middleware\", \"rimraf\", \"validate-npm-package-name\", \"ejs\", \"fs\", \"mongoose\", \"mongodb-uri\", \"mime-types\", \"https\", \"http\", \"deep-get-set\", \"busboy\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"@defualt/dev_env\"] = factory(require(\"jquery-deferred\"), require(\"aws-sdk\"), require(\"path\"), require(\"url\"), require(\"webpack\"), require(\"yargs\"), require(\"express\"), require(\"fs-extra\"), require(\"sharp\"), require(\"child_process\"), require(\"babel-polyfill\"), require(\"globby\"), require(\"webpack-node-externals\"), require(\"find-node-modules\"), require(\"extract-css-chunks-webpack-plugin\"), require(\"autodll-webpack-plugin\"), require(\"stats-webpack-plugin\"), require(\"webpack/lib/ProgressPlugin\"), require(\"node-sass-json-importer\"), require(\"write-file-webpack-plugin\"), require(\"directory-named-webpack-plugin\"), require(\"single-line-log\"), require(\"cookie-parser\"), require(\"webpack-dev-middleware\"), require(\"webpack-hot-middleware\"), require(\"webpack-hot-server-middleware\"), require(\"rimraf\"), require(\"validate-npm-package-name\"), require(\"ejs\"), require(\"fs\"), require(\"mongoose\"), require(\"mongodb-uri\"), require(\"mime-types\"), require(\"https\"), require(\"http\"), require(\"deep-get-set\"), require(\"busboy\"));\n\telse\n\t\troot[\"@defualt/dev_env\"] = factory(root[\"jquery-deferred\"], root[\"aws-sdk\"], root[\"path\"], root[\"url\"], root[\"webpack\"], root[\"yargs\"], root[\"express\"], root[\"fs-extra\"], root[\"sharp\"], root[\"child_process\"], root[\"babel-polyfill\"], root[\"globby\"], root[\"webpack-node-externals\"], root[\"find-node-modules\"], root[\"extract-css-chunks-webpack-plugin\"], root[\"autodll-webpack-plugin\"], root[\"stats-webpack-plugin\"], root[\"webpack/lib/ProgressPlugin\"], root[\"node-sass-json-importer\"], root[\"write-file-webpack-plugin\"], root[\"directory-named-webpack-plugin\"], root[\"single-line-log\"], root[\"cookie-parser\"], root[\"webpack-dev-middleware\"], root[\"webpack-hot-middleware\"], root[\"webpack-hot-server-middleware\"], root[\"rimraf\"], root[\"validate-npm-package-name\"], root[\"ejs\"], root[\"fs\"], root[\"mongoose\"], root[\"mongodb-uri\"], root[\"mime-types\"], root[\"https\"], root[\"http\"], root[\"deep-get-set\"], root[\"busboy\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_0__, __WEBPACK_EXTERNAL_MODULE_1__, __WEBPACK_EXTERNAL_MODULE_2__, __WEBPACK_EXTERNAL_MODULE_3__, __WEBPACK_EXTERNAL_MODULE_7__, __WEBPACK_EXTERNAL_MODULE_8__, __WEBPACK_EXTERNAL_MODULE_9__, __WEBPACK_EXTERNAL_MODULE_12__, __WEBPACK_EXTERNAL_MODULE_14__, __WEBPACK_EXTERNAL_MODULE_16__, __WEBPACK_EXTERNAL_MODULE_17__, __WEBPACK_EXTERNAL_MODULE_25__, __WEBPACK_EXTERNAL_MODULE_26__, __WEBPACK_EXTERNAL_MODULE_27__, __WEBPACK_EXTERNAL_MODULE_28__, __WEBPACK_EXTERNAL_MODULE_29__, __WEBPACK_EXTERNAL_MODULE_30__, __WEBPACK_EXTERNAL_MODULE_31__, __WEBPACK_EXTERNAL_MODULE_32__, __WEBPACK_EXTERNAL_MODULE_33__, __WEBPACK_EXTERNAL_MODULE_35__, __WEBPACK_EXTERNAL_MODULE_37__, __WEBPACK_EXTERNAL_MODULE_40__, __WEBPACK_EXTERNAL_MODULE_43__, __WEBPACK_EXTERNAL_MODULE_44__, __WEBPACK_EXTERNAL_MODULE_45__, __WEBPACK_EXTERNAL_MODULE_46__, __WEBPACK_EXTERNAL_MODULE_48__, __WEBPACK_EXTERNAL_MODULE_52__, __WEBPACK_EXTERNAL_MODULE_53__, __WEBPACK_EXTERNAL_MODULE_54__, __WEBPACK_EXTERNAL_MODULE_55__, __WEBPACK_EXTERNAL_MODULE_58__, __WEBPACK_EXTERNAL_MODULE_63__, __WEBPACK_EXTERNAL_MODULE_64__, __WEBPACK_EXTERNAL_MODULE_65__, __WEBPACK_EXTERNAL_MODULE_70__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 20);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap b304629b4f4fab0ade60","module.exports = require(\"jquery-deferred\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jquery-deferred\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"aws-sdk\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"aws-sdk\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"url\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"url\"\n// module id = 3\n// module chunks = 0","function ensureLeadingSlash(str) {\n  return str.replace(/^\\/?/, '/');\n}\nexport default ensureLeadingSlash;\n\n\n\n// WEBPACK FOOTER //\n// ../ensure-leading-slash/ensure-leading-slash.js","module.exports = function(fun){\n  return function(c){\n    if(c.prepareModuleWithDefaults){\n      c = Object.assign({},c);\n      var parseSettings = null;\n      if(c.parseSettings){\n        parseSettings = c.parseSettings;\n        delete c.parseSettings;\n      }\n      delete c.prepareModuleWithDefaults;\n      return function(r){\n        if(typeof r === 'object' && !Array.isArray(r)){\n          r = Object.assign({},c,r);\n        }\n        \n        if(parseSettings){\n          r = parseSettings(r);\n        }\n        return fun(r);\n      };\n    } else {\n      return fun(c);\n    }\n  };\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/prepareModuleWithDefaults.js","var prepareModuleWithDefaults = require('./prepareModuleWithDefaults');\nmodule.exports = prepareModuleWithDefaults(function(s){\n\tvar res = s.res;\n\tvar isSuccess = typeof s.isSuccess === 'undefined' || !!s.isSuccess;\n\tdelete s.res;\n\tdelete s.isSuccess;\n\tdelete s.accessKeyId;\n\tdelete s.secretAccessKey;\n\tvar status = 200;//ok\n\tif(s.statusCode){\n\t\tstatus = s.statusCode;\n\t} else if(!isSuccess){\n\t\tstatus = 500;\n\t}\n\tstatus = status === 0 ? 500 : status;\n\t\n\tif(s.error){\n\t\t// res.write(s.error);\n\t\t// res.render('error', s.error);\n\t\tres.status(status).json({\n\t\t\tmessage:s.error.message,\n\t\t\terror:s.error.error\n\t\t})\n\t\t// res.json('error', {\n\t //        message: s.error.message,\n\t //        error: s.error\n\t //    });\n\t} else {\n\t\tres.status(status);\n\t\tres.write(JSON.stringify(s));\n\t}\n\t\n\tres.end();\n});\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/respondWithJson.js","module.exports = require(\"webpack\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"webpack\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"yargs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"yargs\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 9\n// module chunks = 0","export default (processed) => {\n  return new Promise((resolve, reject) => {\n    const toUse = processed.activeWebpackDevMiddleware ? processed.activeWebpackDevMiddleware : processed;\n    toUse.run((err, stats) => {\n      console.log('RUN COMPILER');\n      if (err) {\n        console.error(err.stack || err);\n        if (err.details) {\n          console.error(err.details);\n        }\n        // return reject(err);\n      }\n\n      const info = stats.toJson();\n\n      if (stats.hasErrors()) {\n        info.errors.forEach((e) => {\n          console.error('\\x1b[31m', e, '\\x1b[0m');\n        });\n      }\n\n      if (stats.hasWarnings()) {\n        info.warnings.forEach((w) => {\n          console.warn('\\x1b[33m', w, '\\x1b[0m');\n        });\n      }\n      resolve(err, stats)\n    });\n  });\n};\n\n\n\n\n// WEBPACK FOOTER //\n// ./core/webpackRunCompiler.js","import webpack from 'webpack';\nimport { argv } from 'yargs';\nimport fs from 'fs-extra';\nimport globby from 'globby';\nimport nodeExternals from 'webpack-node-externals';\nimport path from 'path';\n\nimport findNodeModules from 'find-node-modules';\n\n\n\n// from universal\n// import path from 'path';\n// import webpack from 'webpack';\nimport ExtractCssChunks from 'extract-css-chunks-webpack-plugin';\nimport AutoDllPlugin from 'autodll-webpack-plugin';\nimport StatsPlugin from 'stats-webpack-plugin';\nimport ProgressPlugin from 'webpack/lib/ProgressPlugin';\nimport jsonImporter from 'node-sass-json-importer';\nimport WriteFilePlugin from 'write-file-webpack-plugin';\n\nimport webpackConfigResolve from './core/webpack-config-resolve';\n\n// from universal\nconst makeProgressPlugin = () => {\n  return new ProgressPlugin((percentage, msg, current, active, modulepath) => {\n    if (process.stdout.isTTY && percentage < 1) {\n      process.stdout.cursorTo(0);\n      modulepath = modulepath ? ` …${modulepath.substr(modulepath.length - 30)}` : '';\n      current = current ? ` ${current}` : '';\n      active = active ? ` ${active}` : '';\n      process.stdout.write(`${(percentage * 100).toFixed(0)}% ${msg}${current}${active}${modulepath} `)\n      process.stdout.clearLine(1)\n    } else if (percentage === 1) {\n      process.stdout.write('\\n')\n      console.log('webpack: done.')\n    }\n  })\n};\nconst res = (p) => {\n  return path.resolve(__dirname, p);\n};\n\n\n\nfunction removeKeysWithEmptyVals(obj){\n  return Object.keys(obj).reduce((accum, key) => {\n    if (obj[key].length) {\n      accum[key] = obj[key];\n    }\n    return accum;\n  }, {})\n}\n\nfunction makeOutputSettingsFromFilePath(filePath) {\n  let output = filePath;\n  output = output.split('/');\n\n  output = {\n    filename: output.pop(),\n    path: output.join('/'),\n  };\n  return output;\n}\n\nfunction makeOutputFiles({libraryNameReduced,isBuild}) {\n  const outputFiles = {};\n  if (isBuild) {\n    outputFiles.library = `dist/${libraryNameReduced}`;\n    outputFiles.libraryMin = `dist/${libraryNameReduced}.min`;\n    outputFiles.demo = 'dist/demo/index';\n  } else {\n    outputFiles.demo = 'boot';\n    outputFiles.library = `${libraryNameReduced}`;\n  }\n  return outputFiles;\n}\n\nfunction makeEntry({libraryName,isBuild,dirRoot}) {\n  const libraryNameReduced = libraryName.split('/')[1] || libraryName.split('/')[0];\n  const outputFiles = makeOutputFiles({libraryNameReduced,isBuild});\n  return removeKeysWithEmptyVals(\n    argv['demo-entry']\n    ?\n    {\n      [outputFiles.demo]: [argv['demo-entry']],\n    }\n    :\n    {\n      MainApp: globby.sync([`${dirRoot}/packages/MainApp/demo.js`]),\n      [outputFiles.library]: globby.sync([\n        `${dirRoot}/${libraryNameReduced}.js`,\n        `${dirRoot}/src/library/index.js`,\n      ]),\n      ...(\n        outputFiles.libraryMin ? {\n          [outputFiles.libraryMin]: globby.sync([`${dirRoot}/src/library/index.js`]),\n        } : {}\n      ),\n      [outputFiles.demo]: globby.sync([\n        `${dirRoot}/*.demo.js`,\n        `${dirRoot}/demo.js`,\n        `${dirRoot}/**/*/*.demo.js`,\n        `${dirRoot}/**/*/demo.js`,\n        `!${dirRoot}/packages/**/*`,\n        `${dirRoot}/packages/MainApp/demo.js`,\n        `!${dirRoot}/node_modules/**/*`,\n      ]),\n    }\n  )\n}\n// /Users/brianephraim/Sites/monorepo/packages/dev_env/universal/webpack/universalWebpackConfig.js\n// /Users/brianephraim/Sites/monorepo/packages/dev_env/         /       /webpackConfig.js\nconst nodeModulesLocationsArray = findNodeModules({ relative: false });\nlet nodeModulesLocation = nodeModulesLocationsArray[0];\nif (nodeModulesLocation.indexOf('packages/dev_env') !== -1){\n  nodeModulesLocation = nodeModulesLocation.split('packages/dev_env')[0];\n  nodeModulesLocation = `${nodeModulesLocation}node_modules`\n}\n\n\nconst externalsOld = fs\n  .readdirSync(res(nodeModulesLocation))\n  .filter((x) => {\n    return !/\\.bin|react-universal-component|require-universal-module|webpack-flush-chunks/.test(x);      \n  })\n  .reduce((externals, mod) => {\n    externals[mod] = `commonjs ${mod}`\n    return externals\n  }, {});\n\n\n/* eslint-disable no-nested-ternary */\nfunction generateConfigJson(options = {}) {\n  const isCommandLine = options.isCommandLine || argv.entry;\n  const isMocha = options.isMocha;\n  const {isReact = false, isClient = false, isDev = false, isUniversal = false} = options;\n\n  const isBuild = argv.env === 'build';\n  const dirRoot = argv.dirroot || process.cwd();\n  const packageJson = fs.readJsonSync(`${dirRoot}/package.json`);\n  const libraryName = packageJson.name;\n  if (isClient && isDev ) {\n    console.log(options);\n    console.trace();\n    console.log('RRRR')\n    console.log('RRRR')\n    console.log('RRRR')\n    console.log('RRRR')\n    console.log('RRRR')\n    console.log('RRRR')\n    console.log('RRRR')\n    console.log('RRRR')\n  }\n  const config = {\n    ...(isReact ? {\n        name: isClient ? 'client' : 'server'\n    }: {}),\n    target: isReact && isClient ? 'web' : 'node',\n    devtool: 'sourcemap',\n    ...(\n      !isMocha\n      ?\n      (\n        isReact\n        ?\n        {\n          entry: [\n            ...(!isClient && !isDev ? [] : ['babel-polyfill']), // not sure why non babel-polyfill when server-prod\n            'fetch-everywhere',\n            ...(\n              isClient && isDev ? [\n              // 'webpack-hot-middleware/client?path=/__webpack_hmr&timeout=20000&reload=false&quiet=false&noInfo=false',\n              // 'react-hot-loader/patch',\n              ] : []\n            ),\n            path.resolve(__dirname,\n              isClient\n              ?\n              './universal/src/clientRender.js'\n              :\n              (\n                isUniversal\n                ?\n                './universal/server/render.js'\n                :\n                './universal/server/nonUniversalRender.js'\n              )\n            )\n          ],\n          output: {\n            path: res(isClient ? './universal/buildClient' : './universal/buildServer'),\n            filename: isClient && !isDev ? '[name].[chunkhash].js' : '[name].js',\n            publicPath: '/static/',\n            ...(\n              isClient\n              ?\n              {chunkFilename: isDev ? '[name].js' : '[name].[chunkhash].js'}\n              :\n              {libraryTarget: 'commonjs2'}\n            ),      \n          },\n        }\n        :\n        {\n          entry: isCommandLine ? argv.entry : makeEntry({libraryName,isBuild,dirRoot}),\n          output: isCommandLine ? makeOutputSettingsFromFilePath(argv.output) : {\n            path: `${dirRoot}`,\n            filename: '[name].js',\n            library: libraryName,\n            libraryTarget: 'umd',\n            umdNamedDefine: true,\n            publicPath: '/',\n          }\n        }\n      )\n      :\n      {}\n    ),\n\n    // for node start\n    // ...(\n    //   !isReact\n    //   ?\n    //   {\n    //     node: {\n    //       __dirname: false,\n    //       __filename: false,\n    //     }\n    //   }\n    //   :\n    //   {}\n    // ),\n    ...(\n      isReact\n      ?\n      (!isClient ? {externals:externalsOld} : {})\n      :\n      {\n        externals: [\n          nodeExternals({\n            // modulesFromFile: true,\n            modulesDir: path.resolve(__dirname.split('/packages/dev_env')[0], './node_modules'),\n          }),\n        ],\n      }\n    ),\n    // ...(\n    //   !isReact || (isReact && !isClient)\n    //   ?\n    //   {\n    //     externals: [\n    //       nodeExternals({\n    //         // modulesFromFile: true,\n    //         modulesDir: path.resolve(__dirname.split('/packages/dev_env')[0], './node_modules'),\n    //         ...(\n    //           isReact ?\n    //           {\n    //             whitelist: (x) => {\n    //               return !/\\.bin|react-universal-component|require-universal-module|webpack-flush-chunks/.test(x);\n    //             }\n    //             // [\n    //             //   '.bin','react-universal-component','require-universal-module','webpack-flush-chunks',\n    //             // ]\n    //           }\n    //           :\n    //           {}\n    //         )\n    //       }),\n    //     ],\n    //   }\n    //   :\n    //   {}\n    // ),\n        \n    // for node end\n\n    module: {\n      rules: [\n        // for node start\n        ...(\n          !isReact\n          ?\n          [\n            { test: /rx\\.lite\\.aggregates\\.js/, use: 'imports-loader?define=>false' },\n            { test: /async\\.js/, use: 'imports-loader?define=>false' },\n          ]\n          :\n          []\n        ),\n        // for node end\n\n        {\n          test: /\\.(js)?$/,\n          loader: 'babel-loader',\n          exclude: /(node_modules|\\.tmp)/,\n        },\n        ...(\n          isReact\n          ?\n          (\n            isClient\n            ?\n            [\n              {\n                test: /\\.css$/,\n                use: ExtractCssChunks.extract({\n                  use: {\n                    loader: 'css-loader',\n                    options: {\n                      modules: true,\n                      localIdentName: '[name]__[local]--[hash:base64:5]'\n                    }\n                  }\n                })\n              },\n              {\n                test: /\\.scss$/,\n                use: ExtractCssChunks.extract({\n                  use: [\n                    'css-loader?sourceMap',\n                    {\n                      loader: 'sass-loader?sourceMap',\n                      options: {\n                        importer: jsonImporter,\n                        modules: true,\n                        localIdentName: '[name]__[local]--[hash:base64:5]'\n                      }\n                    }\n                  ]\n                })\n              },\n            ]\n            :\n            [\n              {\n                test: /\\.css$/,\n                exclude: /node_modules/,\n                use: {\n                  loader: 'css-loader/locals',\n                  options: {\n                    modules: true,\n                    localIdentName: '[name]__[local]--[hash:base64:5]'\n                  }\n                }\n              },\n              {\n                test: /\\.scss$/,\n                exclude: /node_modules/,\n                use: [\n                  'css-loader?sourceMap',\n                  {\n                    loader: 'sass-loader?sourceMap',\n                    options: {\n                      importer: jsonImporter,\n                      modules: true,\n                      localIdentName: '[name]__[local]--[hash:base64:5]'\n                    }\n                  }\n                ]\n              }\n            ]\n          )\n          :\n          []\n        ),\n      ],\n    },\n    resolve: webpackConfigResolve.resolve,\n    plugins: [\n      ...(\n        isReact\n        ?\n        (\n          isClient\n          ?\n          [\n            (\n              isDev \n                ?\n                new WriteFilePlugin() // used so you can see what chunks are produced in dev\n                :\n                new StatsPlugin('stats.json')\n            ), \n            new ExtractCssChunks(),\n            new webpack.optimize.CommonsChunkPlugin({\n              names: ['bootstrap'], // needed to put webpack bootstrap code before chunks\n              filename: isDev ? '[name].js' : '[name].[chunkhash].js',\n              minChunks: Infinity\n            }),\n            ...(\n              isDev\n                ?\n                [\n                  // new webpack.HotModuleReplacementPlugin(),\n                  // new webpack.NoEmitOnErrorsPlugin(),\n                ]\n                :\n                []\n            ),\n            new webpack.DefinePlugin({\n              'process.env': {\n                NODE_ENV: JSON.stringify(isDev ? 'development' : 'production')\n              }\n            }),\n            ...(\n              !isDev\n                ?\n                [\n                  new webpack.optimize.UglifyJsPlugin({\n                    compress: {\n                      screw_ie8: true,\n                      warnings: false\n                    },\n                    mangle: {\n                      screw_ie8: true\n                    },\n                    output: {\n                      screw_ie8: true,\n                      comments: false\n                    },\n                    sourceMap: true\n                  }),\n                  new webpack.HashedModuleIdsPlugin(), // not needed for strategy to work (just good practice)\n                ]\n                :\n                []\n            ),\n            new AutoDllPlugin({\n              context: path.join(__dirname, '..'),\n              filename: '[name].js',\n              entry: {\n                vendor: [\n                  'react',\n                  'react-dom',\n                  'react-redux',\n                  'redux',\n                  'history/createBrowserHistory',\n                  'transition-group',\n                  'redux-first-router',\n                  'redux-first-router-link',\n                  'fetch-everywhere',\n                  'babel-polyfill',\n                  'redux-devtools-extension/logOnlyInProduction'\n                ]\n              }\n            }),\n            makeProgressPlugin(),\n          ]\n          :\n          // IS SERVER\n          [\n            new webpack.BannerPlugin({\n              banner: 'require(\"source-map-support\").install();',\n              raw: true,\n              entryOnly: false,\n            }),\n            new webpack.optimize.LimitChunkCountPlugin({\n              maxChunks: 1\n            }),\n\n            new webpack.DefinePlugin({\n              'process.env': {\n                NODE_ENV: JSON.stringify(isDev ? 'development' : 'production')\n              }\n            }),\n            makeProgressPlugin(),\n          ]\n        )\n        :\n        [\n          // for node start\n          new webpack.BannerPlugin({\n            banner: 'require(\"source-map-support\").install();',\n            raw: true,\n            entryOnly: false,\n          }),\n          ...(\n            isCommandLine || isMocha || isBuild\n            ?\n            [\n              // I needed __dirname hardcoded as the original dirname\n              // https://github.com/webpack/webpack/issues/1599#issuecomment-266588898\n              {\n                apply(compiler) {\n                  function setModuleConstant(expressionName, fn) {\n                    compiler.plugin('compilation', (compilation, data) => {\n                      data.normalModuleFactory.plugin('parser', (parser) => {\n                        parser.plugin(`expression ${expressionName}`, function compilerParserPlugin() {\n                          this.state.current.addVariable(expressionName, JSON.stringify(fn(this.state.module)));\n                          return true;\n                        });\n                      });\n                    });\n                  }\n\n                  setModuleConstant('__filename', (module) => {\n                    return module.resource;\n                  });\n\n                  setModuleConstant('__dirname', (module) => {\n                    return module.context;\n                  });\n                },\n              },\n            ]\n            :\n            []\n          ),\n          makeProgressPlugin(),\n        ]\n      ),\n          \n      // for node end\n    ]\n  };\n\n  // fs.writeFileSync('./_webpack-config-preview.json', JSON.stringify(config, null, 2));\n  return config;\n}\n\nexport default generateConfigJson;\n\n\n\n// WEBPACK FOOTER //\n// ./webpackConfig.js","module.exports = require(\"fs-extra\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs-extra\"\n// module id = 12\n// module chunks = 0","var jD = require('jquery-deferred');\nvar sharp = require('sharp');\nvar prepareModuleWithDefaults = require('./prepareModuleWithDefaults');\nvar parseUrl = require('url').parse;\nmodule.exports = prepareModuleWithDefaults(function(s){\n  var dfd = jD.Deferred();\n  var buffer = s.Body;\n  var sharp = require('sharp');\n  var image = sharp(buffer);\n  image.metadata(function(err, meta){\n      if(err){\n        dfd.reject(err);\n      } else {\n        var smallestDim = Math.min(meta.width, meta.height);\n        var largestDim = Math.max(meta.width, meta.height);\n        var limit = 1200;\n\n        var multiplier = limit/smallestDim;\n        multiplier = multiplier < 1 ? multiplier : 1;\n        if(multiplier !== 1){\n          limit = Math.floor(largestDim * multiplier);\n          image.resize(limit,limit).max().withoutEnlargement()\n        }\n        image.rotate().toBuffer(function(err, outputBuffer, info) {\n          if(err){\n            dfd.reject(err);\n          } else {\n            var manipulatedImageFileData = {\n              Key: s.filename,\n              ContentType: 'image/png',\n              Body: outputBuffer,\n              width: info.width,\n              height: info.height,\n              url: s.url,\n              originalFilename: s.originalFilename\n            };\n          }\n          dfd.resolve(manipulatedImageFileData);\n        });\n      }\n  });\n  return dfd.promise();\n});\n\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/normalizeImageFileData.js","module.exports = require(\"sharp\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"sharp\"\n// module id = 14\n// module chunks = 0","var jD = require('jquery-deferred');\nvar aws = require('aws-sdk');\nvar prepareModuleWithDefaults = require('./prepareModuleWithDefaults');\nmodule.exports = prepareModuleWithDefaults(function(s){\n  s = Object.assign({},s);\n  if(!s.ContentType){\n    var mime = require('mime-types');\n    var extension = s.Key.split('.').pop();\n    s.ContentType = mime.lookup(extension);\n  }\n  var dfd = jD.Deferred();\n\n  aws.config.update({accessKeyId: s.accessKeyId , secretAccessKey: s.secretAccessKey });\n  var s3 = new aws.S3(); \n  var s3Params = {\n      Bucket: s.Bucket,\n      Key: s.Key,\n      Body: s.Body,\n      ContentType: s.ContentType,\n      ACL: 'public-read'\n  };\n\n  s3.putObject(\n    s3Params,\n    function(err, data) {\n        if (err) {\n          dfd.reject(err);\n        } else {\n          s.uploadResponse = data;\n          dfd.resolve(s);\n        }\n    }\n  );\n  return dfd.promise();\n});\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/uploadToS3.js","module.exports = require(\"child_process\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"child_process\"\n// module id = 16\n// module chunks = 0","module.exports = require(\"babel-polyfill\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-polyfill\"\n// module id = 17\n// module chunks = 0",";\nvar mymoduleName = 'mongooseStuff';;\n(function(exports) {\n\n    var jD = require('jquery-deferred');\n\n\n    var mongoose = require('mongoose');\n    var uriUtil = require('mongodb-uri');\n\n    var mongooseStuff = (function() {\n        var MongooseStuff = function() {\n            var self = this;\n            var mongodbUri = process.env.MONGOLAB_URI;\n            if(process.env.ENVNAME === 'foremanLocal'){\n                mongodbUri = \"mongodb://localhost:27017/\"+process.env.DATABASE_NAME;\n            }\n            \n            this.mongooseUri = uriUtil.formatMongoose(mongodbUri);\n            this.db = mongoose.connection;\n            this.models = {};\n            self.models.SimpleImage = mongoose.model('simpleimage', mongoose.Schema({\n                \"url\": String,\n                \"idX\": String,\n                // \"date\": {\n                //     type: Date,\n                //     default: Date.now\n                // },\n                // \"width\": Number,\n                // \"height\": Number,\n            }));\n\n            self.models.ComplexImage = mongoose.model('ComplexImage', mongoose.Schema({\n                \"url\": String,\n                \"idX\": String,\n                \"date\":Date,\n                \"width\":Number,\n                \"height\":Number,\n                \"cropWidth\":Number,\n                \"cropHeight\":Number,\n                \"x\":Number,\n                \"y\":Number,\n                \"mode\":String,\n                \"customTemplate\":String,\n                \"idX\":String,\n                \"customUrl\":String,\n                \"pathname\":String,\n                \"good\":Number\n                // \"date\": {\n                //     type: Date,\n                //     default: Date.now\n                // },\n                // \"width\": Number,\n                // \"height\": Number,\n            }));\n\n            self.models.UserTemplate = mongoose.model('UserTemplate', mongoose.Schema({\n\t\t\t\tcreated: Date,\n\t\t\t\tcustomTemplate:String,\n\t\t\t\ttemplateHeight: Number,\n\t\t\t\ttemplateWidth:Number\n            }));\n        };\n        MongooseStuff.prototype.connect = function() {\n            var self = this;\n            var dfd = jD.Deferred();\n            if (mongoose.connection.readyState === 0) {\n                var options = {\n                    server: {\n                        socketOptions: {\n                            keepAlive: 1,\n                            connectTimeoutMS: 30000\n                        }\n                    },\n                    replset: {\n                        socketOptions: {\n                            keepAlive: 1,\n                            connectTimeoutMS: 30000\n                        }\n                    }\n                };\n                mongoose.connect(self.mongooseUri, options);\n                self.db.once('open', dfd.resolve);\n                self.db.on('error', console.error.bind(console, 'connection error:'));\n\n            } else {\n                dfd.resolve();\n            }\n\n            return dfd.promise();\n        };\n\n        MongooseStuff.prototype.checkUrl = function(idX) {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n                self.models.SimpleImage.findOne({\n                    'idX': idX\n                }, 'url idX', function(err, simpleimage) {\n\n                    if (simpleimage !== null) {\n                        dfd.resolve(true)\n                    } else {\n                        dfd.resolve(false)\n                    }\n\n                    // if (err) return handleError(err);\n                    // console.log('%s %s is a %s.', person.name.first, person.name.last, person.occupation) // Space Ghost is a talk show host.\n                })\n            });\n            return dfd.promise();\n        };\n\n        MongooseStuff.prototype.GetComplexImage = function(idX) {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n                self.models.ComplexImage.findOne({\n                    'idX': idX\n                }, function(err, data) {\n\n                    if (data !== null) {\n                        dfd.resolve(data)\n                    } else {\n                        dfd.resolve(data)\n                    }\n\n                    // if (err) return handleError(err);\n                    // console.log('%s %s is a %s.', person.name.first, person.name.last, person.occupation) // Space Ghost is a talk show host.\n                })\n            });\n            return dfd.promise();\n        };\n\n        MongooseStuff.prototype.GetUserTemplatesAll = function() {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n                self.models.UserTemplate.find({\n                }, function(err, data) {\n\n                    if (data !== null) {\n                        dfd.resolve(data)\n                    } else {\n                        dfd.resolve(data)\n                    }\n\n                    // if (err) return handleError(err);\n                    // console.log('%s %s is a %s.', person.name.first, person.name.last, person.occupation) // Space Ghost is a talk show host.\n                })\n            });\n            return dfd.promise();\n        };\n\n        MongooseStuff.prototype.GetComplexImageAll = function() {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n                self.models.ComplexImage.find({\n                }, function(err, data) {\n\n                    if (data !== null) {\n                        dfd.resolve(data)\n                    } else {\n                        dfd.resolve(data)\n                    }\n\n                    // if (err) return handleError(err);\n                    // console.log('%s %s is a %s.', person.name.first, person.name.last, person.occupation) // Space Ghost is a talk show host.\n                })\n            });\n            return dfd.promise();\n        };\n\n        \n        MongooseStuff.prototype.MakeUserTemplate = function(data) {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n            \tself.models.UserTemplate.findOneAndUpdate( { customTemplate : data.customTemplate },data,{ upsert : true }, function(){\n            \t\tdfd.resolve.apply(null, arguments);\n            \t});\n            });\n            return dfd.promise();\n        };\n\n\n        MongooseStuff.prototype.UpdateComplexImage = function(data) {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n            \tself.models.ComplexImage.findOneAndUpdate( { idX : data.idX },data,{ upsert : true }, function(){\n            \t\tdfd.resolve.apply(null, arguments);\n            \t});\n            });\n            return dfd.promise();\n        };\n\n        MongooseStuff.prototype.ComplexImage = function(data) {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n                var newRecord = new self.models.ComplexImage(data);\n\n                newRecord.save(function() {\n                    dfd.resolve.apply(null, arguments);\n                })\n            });\n            return dfd.promise();\n        };\n\n        MongooseStuff.prototype.simpleimage = function(url, idX) {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n                var newRecord = new self.models.SimpleImage({\n                    url: url,\n                    idX: idX\n                });\n\n                newRecord.save(function() {\n                    dfd.resolve.apply(null, arguments);\n                })\n            });\n            return dfd.promise();\n        };\n\n        MongooseStuff.prototype.getImages = function(url, idX) {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n                self.models.SimpleImage.find({}, 'url idX', function(err, simpleimage) {\n                    dfd.resolve(simpleimage);\n                })\n            });\n            return dfd.promise();\n        };\n\n        MongooseStuff.prototype.nuke = function() {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n                mongoose.connection.db.collection('usertemplates').drop(function(err) {//compleximages\n                    if (err) throw err;\n\n                    // Only close the connection when your app is terminating\n                    mongoose.connection.db.close(function(err) {\n                        dfd.resolve();\n                        if (err) throw err;\n                    });\n                });\n                return dfd.promise();\n            });\n        };\n\n\n\n        return new MongooseStuff();\n    })();\n\n\n    exports.x = mongooseStuff;\n\n\t// mongooseStuff.nuke();\n\n\t// mongooseStuff.connect().then(function(){\n\t// \tmongoose.connection.db.listCollections().toArray(function(err, names) {\n\t// \t    if (err) {\n\t// \t        console.log(err);\n\t// \t    }\n\t// \t    else {\n\t// \t        names.forEach(function(e,i,a) {\n\t// \t            mongoose.connection.db.dropCollection(e.name);\n\t// \t            console.log(\"collection --->>\", e.name);\n\t// \t        });\n\t// \t    }\n\t// \t});\n //    });\n\n\n})(typeof exports === 'undefined' ? this[mymoduleName] = {} : exports);\n\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/mongooseStuff.js","var jD = require('jquery-deferred');\nvar aws = require('aws-sdk');\nmodule.exports = function(s){\n  s = Object.assign({},s);\n  var dfd = jD.Deferred();\n  aws.config.update({accessKeyId: s.accessKeyId , secretAccessKey: s.secretAccessKey });\n  var s3 = new aws.S3(); \n  s3.getObject(\n    {\n        Bucket: s.Bucket,\n        Key: s.Key\n    },\n    function(err, data) {\n      var output;\n      if(err && err.statusCode === 404 && s.resolveNullOn404){\n        output = s.outputParser ? s.outputParser(null) : null;\n        dfd.resolve(output);\n      } else if (err){\n        dfd.reject(err);\n      } else {\n        output = s.outputParser ? s.outputParser(data) : data;\n        dfd.resolve(output);\n      }\n    }\n  );\n  return dfd.promise();\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/getS3ObjectData.js","/* eslint-disable no-console */\nimport webpack from 'webpack';\nimport { argv } from 'yargs';\nimport shellCommand from './core/shellCommand';\nimport jestSpawnProcess from './jest/jestSpawnProcess';\nimport webpackRunCompiler from './core/webpackRunCompiler';\nimport webpackBuildCommandLine from './core/webpackBuildCommandLine';\nimport serveWebpack from './webpackExpressServer.js';\nimport webpackConfig from './webpackConfig'; \n// import isWithinMonoRepo from './core/isWithinMonoRepo');\n \nconst env = argv.env;\nconst item = argv.item;\n\nif (item) {\n  shellCommand(`(cd ./packages/${item} && npm run start)`);\n} else if (env === 'test') {\n  jestSpawnProcess(argv.testdevenv, argv.watch, argv.testPathPattern);\n} else if (argv.entry) {\n  webpackBuildCommandLine();\n} else if (env === 'build') {\n  webpackRunCompiler(webpack(webpackConfig()));  \n} else {\n  serveWebpack();\n}\nconst serve = function ()   {\n  serveWebpack.apply(this,arguments);\n}\nexport { serve };\n\n\n// WEBPACK FOOTER //\n// ./dev_env.js","/* eslint-disable global-require */\nmodule.exports = (commandToRun, options = { stdio: 'inherit' }, killParentOnExit = true) => {\n  const command = 'sh';\n  const args = [\n    '-c',\n    // commandToRun.replace('node $TMPFILE','node --inspect=9223 $TMPFILE'),\n    commandToRun.replace('node $TMPFILE','node --trace-warnings $TMPFILE'),\n    // commandToRun,\n  ];\n  //\n  // kexec doesn't work in windows, so fallback to child_process.spawn\n  // this logic copied from babel-cli/lib/babel-node.js\n  // try {\n  //   const kexec = require('kexec');\n  //   kexec(command, args);\n  // } catch (err) {\n    // if (err.code !== 'MODULE_NOT_FOUND') throw err;\n\n  const childProcess = require('child_process');\n  const proc = childProcess.spawn(command, args, options || {});\n  proc.on('exit', (code, signal) => {\n    if (killParentOnExit) {\n      process.on('exit', () => {\n        if (signal) {\n          process.kill(process.pid, signal);\n        } else {\n          process.exit(code);\n        }\n      });\n    }\n  });\n  return proc;\n  // }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./core/shellCommand.js","/* eslint-disable camelcase */\nimport child_process from 'child_process';\nimport path from 'path';\n\n// import jestConfig from './jestConfig';\n// const config = `'${JSON.stringify(jestConfig).replace(/'/g, \"\\\\'\")}'`;\n\nconst configPath = `${__dirname}/jestConfig.js`;\n// const configBasePath = `${__dirname}/jestConfigBase.js`;\n// qwer();\n\nexport default (testdevenv, watch = true, testPathPattern) => {\n  const command = 'sh';\n  // Why `CI=true `? ----- https://github.com/facebook/jest/issues/2959\n  let commandBody = `CI=true ${process.cwd()}/node_modules/.bin/jest --watch=${watch && watch !== 'false' ? 'true' : 'false'} --config=${configPath}${testPathPattern ? [\" --testPathPattern='\",testPathPattern,\"'\"].join('') : ''}`;\n  if (testdevenv) {\n    // commandBody = `CI=true ${process.cwd()}/node_modules/.bin/jest -t testdevenv --config=${configBasePath}`;\n    // commandBody = `CI=true ${process.cwd()}/node_modules/.bin/jest ${__dirname}/testdevenv.js  --config=${configBasePath}`;\n    commandBody = `CI=true ${process.cwd()}/node_modules/.bin/mocha-webpack --colors --require babel-core/register --webpack-config ${path.resolve(__dirname, '../core/webpackConfigMocha.js')} \\\"${path.resolve(__dirname, './testdevenv2.js')}\\\" --require source-map-support/register`;\n  }\n  const args = [\n    '-c',\n    commandBody,\n  ];\n  const proc = child_process.spawn(command, args, { stdio: 'inherit' });\n  proc.on('exit', (code, signal) => {\n    process.on('exit', () => {\n      if (signal) {\n        process.kill(process.pid, signal);\n      } else {\n        process.exit(code);\n      }\n    });\n  });\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jest/jestSpawnProcess.js","import webpack from 'webpack';\nimport webpackRunCompiler from './webpackRunCompiler';\nimport webpackConfig from '../webpackConfig';\n\nexport default () => {\n  webpackRunCompiler(webpack(webpackConfig({isCommandLine: true})));\n};\n\n\n\n// WEBPACK FOOTER //\n// ./core/webpackBuildCommandLine.js","module.exports = require(\"globby\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"globby\"\n// module id = 25\n// module chunks = 0","module.exports = require(\"webpack-node-externals\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"webpack-node-externals\"\n// module id = 26\n// module chunks = 0","module.exports = require(\"find-node-modules\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"find-node-modules\"\n// module id = 27\n// module chunks = 0","module.exports = require(\"extract-css-chunks-webpack-plugin\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"extract-css-chunks-webpack-plugin\"\n// module id = 28\n// module chunks = 0","module.exports = require(\"autodll-webpack-plugin\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"autodll-webpack-plugin\"\n// module id = 29\n// module chunks = 0","module.exports = require(\"stats-webpack-plugin\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"stats-webpack-plugin\"\n// module id = 30\n// module chunks = 0","module.exports = require(\"webpack/lib/ProgressPlugin\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"webpack/lib/ProgressPlugin\"\n// module id = 31\n// module chunks = 0","module.exports = require(\"node-sass-json-importer\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"node-sass-json-importer\"\n// module id = 32\n// module chunks = 0","module.exports = require(\"write-file-webpack-plugin\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"write-file-webpack-plugin\"\n// module id = 33\n// module chunks = 0","const DirectoryNamedWebpackPlugin = require('directory-named-webpack-plugin');\nconst parseRequestResolvePlugin = require('./parseRequestResolvePlugin');\nconst path = require('path');\n\nvar basename = path.basename;\nvar inNodeModulesRE = /\\/node_modules\\/|\\\\node_modules\\\\/;\n\nfunction DirectoryDefaultFilePlugin() {\n  return {\n    apply(resolver) {\n      // I don't know why 'module' or 'resolve' are those values.\n      // Something to do with the the way they are used in this file:\n      // https://github.com/webpack/enhanced-resolve/blob/master/lib/ResolverFactory.js\n      // So they can be other values as seen in that file.\n      resolver.plugin('directory', function (req, done) {\n        // printProgress(`${request.request}`);\n        // console.log('request.request',request.request)\n        // const newRequestStr = parseRequest(req.request);\n        // if (newRequestStr && newRequestStr !== req.request) {\n        //   const obj = Object.assign({}, req, {\n        //     request: newRequestStr,\n        //   });\n        //   this.doResolve('resolve', obj, 'blah blah', done);\n        // } else {\n        //   // process.stdout.write(`\\n`);\n        //   done();\n        // }\n        \n\n        var directory = resolver.join(req.path, req.request);\n        if (directory.match(inNodeModulesRE)) {\n          return done();\n        }\n\n\n        resolver.fileSystem.stat(directory, function (err, stat) {\n          if (err || !stat || !stat.isDirectory()) {\n            return done();\n          }\n\n          var index = resolver.join(directory, 'index.js');          \n\n          resolver.fileSystem.stat(index, function (err, stat) {\n            // console.log('index',index);\n            \n            if (!err && stat && stat.isFile()) {\n              // ignore directories containing index.js files\n              return done();\n            }\n            // console.log(req)\n            // done();\n            // console.log('new request',resolver.join(directory, basename(directory)));\n            const obj = Object.assign({}, req, {\n              request: resolver.join(directory, basename(directory)),\n            });\n            resolver.doResolve('resolve', obj, 'blah blah', done);\n\n            // resolver.doResolve('file', {\n            //   path: req.path,\n            //   query: req.query,\n            //   request: resolver.join(directory, basename(directory))\n            // }, function (err, result) {\n            //   return done(undefined, result || undefined);\n            // });\n          });\n        });\n      });\n    },\n  };\n}\n\nmodule.exports = {\n  resolve: {\n    modules: [\n      // '/Users/brianephraim/Sites/monorepo/node_modules',\n      path.resolve('./src/library'),\n      path.resolve(process.cwd(), 'packages'),\n      path.resolve(process.cwd(), '../../packages'),\n      'node_modules',\n      // path.resolve(process.cwd(), '../monorepo/node_modules'),\n      // '../monorepo/node_modules',\n    ],\n    extensions: [\n      '.js',\n      '.css',\n\n      // Why is this here? : https://github.com/npm/normalize-package-data/issues/88\n      // Issue only appeard when webpack run on command line for Node bundle\n      '.json',\n    ],\n    plugins: [\n      parseRequestResolvePlugin((requestStr) => {\n        // console.log('requestStr', requestStr);\n        if (requestStr.indexOf('@') === 0 && requestStr.indexOf('/') !== -1) {\n          const split = requestStr.split('/');\n          split.shift();\n          split.join('/');\n          // console.log('Afindme',split.join('/'),requestStr.split('/')[1]);\n          // console.log('Bfindme',requestStr.split('/')[1]);\n          return split.join('/');\n          return requestStr.split('/')[1];\n        }\n        return false;\n      }),\n      new DirectoryDefaultFilePlugin(),\n      // new DirectoryNamedWebpackPlugin(true),\n    ],\n  },\n};\n\n\n\n// WEBPACK FOOTER //\n// ./core/webpack-config-resolve.js","module.exports = require(\"directory-named-webpack-plugin\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"directory-named-webpack-plugin\"\n// module id = 35\n// module chunks = 0","/* eslint-disable func-names */\nconst singleLineLog = require('single-line-log').stdout;\n\nfunction printProgress(progress) {\n  if (!process || !process.stdout || !process.stdout.clearLine) {\n    return;\n  }\n  singleLineLog(`Resolving: ${progress}\\n`);\n  // process.stdout.clearLine();\n  // process.stdout.cursorTo(0);\n  // process.stdout.write(progress + `-xxxxxx`);\n}\nfunction parseRequestResolvePlugin(parseRequest = () => {}) {\n  return {\n    apply(resolver) {\n      // I don't know why 'module' or 'resolve' are those values.\n      // Something to do with the the way they are used in this file:\n      // https://github.com/webpack/enhanced-resolve/blob/master/lib/ResolverFactory.js\n      // So they can be other values as seen in that file.\n      resolver.plugin(/* 'modules'*/ 'resolve', function (request, callback) {\n        // printProgress(`${request.request}`);\n        // console.log('request.request',request.request)\n        const newRequestStr = parseRequest(request.request);\n        if (newRequestStr && newRequestStr !== request.request) {\n          const obj = Object.assign({}, request, {\n            request: newRequestStr,\n          });\n          this.doResolve('resolve', obj, 'blah blah', callback);\n        } else {\n          // process.stdout.write(`\\n`);\n          callback();\n        }\n      });\n    },\n  };\n}\n\nmodule.exports = parseRequestResolvePlugin;\n\n\n\n// WEBPACK FOOTER //\n// ./core/parseRequestResolvePlugin.js","module.exports = require(\"single-line-log\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"single-line-log\"\n// module id = 37\n// module chunks = 0","/* eslint-disable no-console */\n\nimport express from 'express';\nimport { argv } from 'yargs';\nimport path from 'path';\nimport demoEndpoints from './universal/server/demoEndpoints';\nimport startUniversalExpress from './startUniversalExpress';\nimport bernieServer from '@defualt/bernieserver/bernieserver.express';\nimport junkServer from '@defualt/junk-express/junk-express.express';\n\nconst extraServers = {\n  bernieserver: bernieServer,\n  'junk-express': junkServer,\n};\n\nfunction startWebpack(app) {\n  console.log('SERVE');\n  // This module either extends an existing express app\n  // or creates a new express app\n\n\n  demoEndpoints({app})\n  startUniversalExpress({app});\n\n  app.use('/images', express.static('packages/images'));\n  app.use('/fonts', express.static('packages/fonts'));\n\n  const port = 3000;\n  app.listen(port, (error) => {\n    if (error) {\n      console.error(error);\n    } else {\n      console.info(\n        '🌎 Listening on port %s. Open up http://localhost:%s/ in your browser.',\n        port,\n        port,\n      );\n    }\n  });\n\n  return app;\n}\n\n\nfunction asyncRecurseStartApps(app,serverNamespaces) {\n  return new Promise((resolve, reject) => {\n    let i = 0;\n    function recurse(backendAppNamespace) {\n      const someBackendApp = extraServers[backendAppNamespace];\n      // const someBackendApp = __non_webpack_require__(path.resolve(__dirname, `../../packages/${backendAppNamespace}/${backendAppNamespace}.express`));\n      // import(`../../packages/${backendAppNamespace}/${backendAppNamespace}.express`).then((someBackendApp) => {\n      const serveBackendApp = someBackendApp.default || someBackendApp;\n      const backendAppSettings = {\n        nameSpace: backendAppNamespace,\n      };\n      backendAppSettings.app = app;\n      serveBackendApp(backendAppSettings);\n      const nextNamespace = serverNamespaces[++i];\n      if (nextNamespace) {\n        recurse(nextNamespace);\n      } else {\n        resolve(app);\n      }\n      // });\n    }\n    recurse(serverNamespaces[i]);\n  });  \n}\n\nexport default function () {\n  const serverNamespaces = argv.servers && argv.servers.split(',');\n  const app = express();\n  if (serverNamespaces) {\n    asyncRecurseStartApps(app,serverNamespaces).then(startWebpack);\n  } else {\n    startWebpack(app)\n  }\n}\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./webpackExpressServer.js","import 'babel-polyfill'\nimport express from 'express'\nimport cookieParser from 'cookie-parser'\nimport { findVideos, findVideo } from './api'\n// import startUniversalExpress from '../../startUniversalExpress';\n\nexport default function demoExpress({app = express()}) {\n  // JWTOKEN COOKIE - in a real app obviously you set this after signup/login:\n\n  app.use(cookieParser())\n\n  app.use((req, res, next) => {\n    const cookie = req.cookies.jwToken\n    const jwToken = 'fake' // TRY: set to 'real' to authenticate ADMIN route\n\n    if (cookie !== jwToken) {\n      res.cookie('jwToken', jwToken, { maxAge: 900000 })\n      req.cookies.jwToken = jwToken\n    }\n\n    next()\n  })\n\n  // API\n\n  app.get('/api/videos/:category', async (req, res) => {\n    const jwToken = req.headers.authorization.split(' ')[1]\n    const data = await findVideos(req.params.category, jwToken)\n    res.json(data)\n  })\n\n  app.get('/api/video/:slug', async (req, res) => {\n    const jwToken = req.headers.authorization.split(' ')[1]\n    const data = await findVideo(req.params.slug, jwToken)\n    res.json(data)\n  })\n}\n\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./universal/server/demoEndpoints.js","module.exports = require(\"cookie-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"cookie-parser\"\n// module id = 40\n// module chunks = 0","export const findVideos = async (category, jwToken) => {\n  await fakeDelay(1000)\n  if (!jwToken) return [] // in a real app, you'd authenticate\n\n  switch (category) {\n    case 'fp':\n      return fpVideos\n    case 'react-redux':\n      return reactReduxVideos\n    case 'db-graphql':\n      return dbGraphqlVideos\n    default:\n      return []\n  }\n}\n\nexport const findVideo = async (slug, jwToken) => {\n  await fakeDelay(500)\n  if (!jwToken) return null // TRY: set the cookie === ''\n\n  return allVideos.find(video => video.slug === slug)\n}\n\nconst fakeDelay = (ms = 1000) => new Promise(res => setTimeout(res, ms))\n\nconst fpVideos = [\n  {\n    youtubeId: '6mTbuzafcII',\n    slug: 'transducers',\n    title: 'Transducers',\n    by: 'Rich Hickey',\n    category: 'Functional Programming',\n    color: 'blue',\n    tip: `Redux-First Router does not require you to embed actual links into the page \n            to get the benefit of a synced address bar. Regular actions if matched\n            will change the URL. That makes it easy to apply to an existing SPA Redux\n            lacking in routing/URLs!`\n  },\n  {\n    youtubeId: 'zBHB9i8e3Kc',\n    slug: 'introduction-to-elm',\n    title: 'Introduction to Elm',\n    by: 'Richard Feldman',\n    category: 'Functional Programming',\n    color: 'blue',\n    tip: `Redux reducers programmatically allow you to produce any state you need.\n          So logically Route Matching components such as in React Reacter only\n          allow you to do LESS, but with a MORE complicated API.`\n  },\n  {\n    youtubeId: 'mty0RwkPmE8',\n    slug: 'next-five-years-of-clojurescript',\n    title: 'The Next Five Years of ClojureScript ',\n    by: 'David Nolen',\n    category: 'Functional Programming',\n    color: 'blue',\n    tip: `In your actions.meta.location key passed to your reducers you have all sorts\n          of information: the previous route, its type and payload, history, whether\n          the browser back/next buttons were used and if the action was dispatched on load.\n          Check the \"kind\" key.`\n  }\n]\n\nconst reactReduxVideos = [\n  {\n    youtubeId: 'qa72q70gAb4',\n    slug: 'unraveling-navigation-in-react-native',\n    title: 'Unraveling Navigation in React Native',\n    by: 'Adam Miskiewicz',\n    category: 'React & Redux',\n    color: 'red',\n    tip: `Redux-First Router tries in all cases to mirror the Redux API. There is no need\n          to pass your thunk :params such as in an express request or the like. Just grab it\n          from the payload stored in the location state.`\n  },\n  {\n    youtubeId: 'zD_judE-bXk',\n    slug: 'recomposing-your-react-application',\n    title: 'Recomposing your React application at react-europe ',\n    by: 'Andrew Clark',\n    category: 'React & Redux',\n    color: 'red',\n    tip: `Redux-First Router requires your payload to be objects, as its keys are directionally extracted\n          and from your URLs and passed from payloads to URL path segments. Your free\n          to use whatever payload you like for redux actions not connected to your routes. Not all\n          actions need to be connected to routes.`\n  },\n  {\n    youtubeId: 'uvAXVMwHJXU',\n    slug: 'the-redux-journey',\n    title: 'The Redux Journey',\n    by: 'Dan Abramov',\n    category: 'React & Redux',\n    color: 'red',\n    tip: `The <Link /> component embeds paths in hrefs for SEO, but you don't need to use it\n          to get the benefits of a changing address bar. Actions that match routes will\n          trigger the corresponding URL even if you dispatch them directly.`\n  }\n]\n\nconst dbGraphqlVideos = [\n  {\n    youtubeId: 'fU9hR3kiOK0',\n    slug: 'turning-the-db-inside-out',\n    title: 'Turning the database inside out',\n    by: 'Martin Kleppmann',\n    category: 'Database & GraphQL',\n    color: 'orange',\n    tip: `The 'thunk' feature is optional, but very useful. Using our 'thunk' feature allows you\n          to define it in one place while linking to the route from many places without\n          worrying about getting the data first. It's also very easy to handle server-side.`\n  },\n  {\n    youtubeId: '_5VShOmnfQ0',\n    slug: 'normalized-caching-in-apollo-ios',\n    title: 'Normalized Caching in Apollo iOS',\n    by: 'Martijn Walraven',\n    category: 'Database & GraphQL',\n    color: 'orange',\n    tip: `Structure your reducers so that less actions are used to trigger the same state. \n          Your actions will become more 'page-like'. As a result your reducers\n          will need to do more \"tear down\" work when leaving corresponding pages. It's also\n          recommended to set action types as the capitalized noun name of the page.`\n  },\n  {\n    youtubeId: 'm-hre1tt9C4',\n    slug: 'first-thoughts-on-apollo-and-graphql',\n    title: 'First Thoughts On Apollo and GraphQL',\n    by: 'Sacha Greif',\n    category: 'Database & GraphQL',\n    color: 'orange',\n    tip: `Using a hash of slugs within one of your reducers is the recommended approach to \n          maintain a normalized set of entities to get the benefits of SEO. This is as opposed\n          to using IDs. Refrain from using normalizr or Apollo until your app justifies it.`\n  }\n]\n\nconst allVideos = reactReduxVideos.concat(dbGraphqlVideos, fpVideos)\n\n\n\n// WEBPACK FOOTER //\n// ./universal/server/api.js","import 'babel-polyfill'\nimport webpack from 'webpack'\nimport webpackDevMiddleware from 'webpack-dev-middleware'\n\nimport express from 'express'\nimport fs from 'fs-extra';\n\nimport webpackHotMiddleware from 'webpack-hot-middleware'\nimport webpackHotServerMiddleware from 'webpack-hot-server-middleware'\nimport { argv } from 'yargs';\nimport path from 'path';\nimport deleteFiles from 'rimraf';\n// import universalWebpackConfig from './universal/webpack/universalWebpackConfig';\nimport webpackConfig from './webpackConfig';\nimport webpackRunCompiler from './core/webpackRunCompiler';\nimport webpackParseStatsForDepProblems from './webpackParseStatsForDepProblems';\n\n\nconst res = p => path.resolve(__dirname, p)\n\nexport default function startUniversal({app = express()}) {\n  \n\n  // UNIVERSAL HMR + STATS HANDLING GOODNESS:\n\n  if (argv.isDev === 'true') {\n    const clientDevConfig = webpackConfig({isReact:true,isClient:true,isDev:true,isUniversal:true,'xxx':116});\n    const serverDevConfig = webpackConfig({isReact:true,isClient:false,isDev:true,isUniversal:true,'xxx':115});\n    const serverNonUniversalConfig = webpackConfig({isReact:true,isClient:false,isDev:true,isUniversal:false,'xxx':114});\n    const publicPath = clientDevConfig.output.publicPath\n    const outputPath = clientDevConfig.output.path\n    console.log('66666')\n    function invalidHandler(fileName, changeTime) {\n      console.log('==== INVALIDATED ====')\n      console.log('stats', fs.statSync(fileName));\n      console.log(`FileName: ${fileName}`);\n      console.log(`ChangeTimex: ${changeTime}`);\n    }\n    const options = {\n      publicPath,\n      stats: {\n        colors: true,\n      },\n    };\n    const isUniversal = argv.isUniversal === 'true';\n    const multiCompiler = webpack([clientDevConfig, isUniversal ? serverDevConfig : serverNonUniversalConfig])\n    const clientCompiler = multiCompiler.compilers[0]\n    console.info('🔷 Starting webpack ...');\n\n    clientCompiler.plugin('invalid', invalidHandler);\n    const activeWebpackDevMiddleware = webpackDevMiddleware(multiCompiler, options);\n    activeWebpackDevMiddleware.waitUntilValid((stats) => {\n      // function censor(censor) {\n      //   var i = 0;\n\n      //   return function(key, value) {\n      //     if(i !== 0 && typeof(censor) === 'object' && typeof(value) == 'object' && censor == value) \n      //       return '[Circular]'; \n\n      //     if(i >= 29) // seems to be a harded maximum of 30 serialized objects?\n      //       return '[Unknown]';\n\n      //     ++i; // so we know we aren't using the original object anymore\n\n      //     return value;  \n      //   }\n      // }\n      // fs.writeFileSync('./activeWebpackDevMiddlewareStats.json', JSON.stringify(stats, censor(stats), 2));\n      webpackParseStatsForDepProblems(stats);\n    });\n\n    app.use(activeWebpackDevMiddleware)\n    app.use(webpackHotMiddleware(clientCompiler))\n    app.use(\n      // keeps serverRender updated with arg: { clientStats, outputPath }\n      webpackHotServerMiddleware(multiCompiler, {\n        serverRendererOptions: { outputPath }\n      })\n    )\n\n  } else if (argv.isDeploy === 'true') {\n    console.log('77777')\n    const serverRender = __non_webpack_require__(res('./universal/buildServer/main.js')).default\n    const clientStats = __non_webpack_require__(res('./universal/buildClient/stats.json'))    \n    const clientProdConfig = webpackConfig({isReact:true,isClient:true,isDev:false,isUniversal:true,'xxx':113});\n    const publicPath = clientProdConfig.output.publicPath\n    const outputPath = clientProdConfig.output.path    \n    app.use(publicPath, express.static(outputPath))\n    app.use(serverRender({ clientStats, outputPath }))\n  } else {\n    console.log('8888')\n    const clientProdConfig = webpackConfig({isReact:true,isClient:true,isDev:false,isUniversal:true,'xxx':113});\n    const serverProdConfig = webpackConfig({isReact:true,isClient:false,isDev:false,isUniversal:true,'xxx':112});\n    deleteFiles(`{${clientProdConfig.output.path},${serverProdConfig.output.path}}`, () => {\n      // webpackRunCompiler(webpack(clientProdConfig)).then(() => {\n        // deleteFiles(serverProdConfig.output.path, () => {\n          const multiCompiler = webpack([clientProdConfig,serverProdConfig]);\n          const clientCompiler = multiCompiler.compilers[0];\n          const serverCompiler = multiCompiler.compilers[1];\n          webpackRunCompiler(multiCompiler).then(() => {\n            // const clientConfig = webpackConfig({isReact:true,isClient:true,isDev:true,isUniversal:true,'xxx':111});\n            const publicPath = clientProdConfig.output.publicPath\n            const outputPath = clientProdConfig.output.path\n            const serverRender = __non_webpack_require__(res('./universal/buildServer/main.js')).default\n            const clientStats = __non_webpack_require__(res('./universal/buildClient/stats.json'))            \n            app.use(publicPath, express.static(outputPath))\n            app.use(serverRender({ clientStats, outputPath }))\n          });\n        // });\n      // });\n    });\n  }\n\n  return app;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./startUniversalExpress.js","module.exports = require(\"webpack-dev-middleware\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"webpack-dev-middleware\"\n// module id = 43\n// module chunks = 0","module.exports = require(\"webpack-hot-middleware\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"webpack-hot-middleware\"\n// module id = 44\n// module chunks = 0","module.exports = require(\"webpack-hot-server-middleware\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"webpack-hot-server-middleware\"\n// module id = 45\n// module chunks = 0","module.exports = require(\"rimraf\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"rimraf\"\n// module id = 46\n// module chunks = 0","/* eslint-disable no-console */\nimport fs from 'fs-extra';\nimport validateNpmPackageName from 'validate-npm-package-name';\n\nfunction ensureTrailingSlash(str) {\n  return str.replace(/\\/?$/, '/');\n}\n\nfunction ensureReadJsonSync(packageDotJsonPath) {\n  let packageDotJsonContent;\n  try {\n    packageDotJsonContent = fs.readJsonSync(packageDotJsonPath);\n  } catch (e) {\n    packageDotJsonContent = {};\n  }\n  return packageDotJsonContent;\n}\n\nfunction showProblemsInConsole(problems) {\n  if (Object.keys(problems).length) {\n    console.info('\\x1b[1m', '\\nProblems with dependencies', '\\x1b[0m');\n  }\n  Object.keys(problems).forEach((moduleResource) => {\n    console.info('\\x1b[36m', '\\nProblem in module with `import` statement:', '\\x1b[0m');\n    console.info('\\x1b[37m', ` ${moduleResource}`, '\\x1b[0m');\n    Object.keys(problems[moduleResource]).forEach((depName) => {\n      const problemMsg = problems[moduleResource][depName].msg;\n      console.info('\\x1b[33m', 'Dependency requested as:', '\\x1b[0m');\n      console.info('\\x1b[37m', ` ${depName}`, '\\x1b[0m');\n      console.info('\\x1b[33m', `Message: ${problemMsg}`, '\\x1b[0m');\n      const problemInfo = problems[moduleResource][depName].info;\n      if (problemInfo) {\n        console.info('\\x1b[37m', `- ${problemInfo.join('\\n - ')}`, '\\x1b[0m');\n      }\n    });\n  });\n}\n\nfunction findDependenciesProblems(dependencies, packageDotJsonContent) {\n  const problems = {};\n\n  dependencies.forEach((dep) => {\n    if (dep.module) {\n      const rawRequest = dep.module.rawRequest;\n      // if (rawRequest.indexOf('/Users/brianephraim/Sites/monorepo/packages') === 0) {\n      //   console.info('\\x1b[33m', 'depWTF', rawRequest, '\\x1b[0m');\n      //   console.log('depWTF', dep);\n      // } else {\n      //   console.info('\\x1b[33m', 'depGGG', rawRequest, '\\x1b[0m');\n      //   console.log('depGGG', dep);\n      // }\n\n      // not a relative dependency\n      // not an absolut dependency\n      // we are only concerned with depenencies referenced like\n      // `import asdf from 'asdf';`\n      // or\n      // `import qwer from 'asdf/qwer';``\n      // or\n      // `import asdf from '@defualt/asdf';``\n      // These dependencies will be either in /node_modules/ or /packages/,\n      // the latter for only monorepo use.\n      if (rawRequest && rawRequest.indexOf('.') !== 0 && rawRequest.indexOf('/') !== 0) {\n        const validationResult = validateNpmPackageName(rawRequest);\n        if (validationResult.validForNewPackages) {\n          if (\n            !packageDotJsonContent ||\n            (\n              (\n                !packageDotJsonContent.dependencies ||\n                !packageDotJsonContent.dependencies[rawRequest]\n              ) &&\n              (\n                !packageDotJsonContent.devDependencies ||\n                !packageDotJsonContent.devDependencies[rawRequest]\n              )\n            )\n          ) {\n            problems[rawRequest] = { msg: 'MISSING FROM PACKAGE.JSON' };\n          }\n        } else {\n          const info = [\n            ...validationResult.warnings || [], ...validationResult.errors || [],\n          ].filter((msg) => {\n            return msg !== 'name can only contain URL-friendly characters';\n          });\n          // console.log(validationResult);\n          if (info.length) {\n            problems[rawRequest] = {\n              msg: 'BAD FORMATTING',\n              info: [...validationResult.warnings || [], ...validationResult.errors || []],\n            };\n          }\n        }\n      }\n    }\n  });\n\n  return Object.keys(problems).length ? problems : null;\n}\n\nfunction webpackParseStatsForDepProblems(stats, shouldShowProblemsInConsole = true) {\n  const isMonorepo = fs.existsSync(`${process.cwd()}/packages`);\n\n  const packageDotJsonCache = {};\n  const problems = {};\n  const compilation = stats.compilation ? stats.compilation : stats.stats[0].compilation\n  compilation.modules.forEach((module) => {\n    // only concerned with module entries from /packages/ folder (not node_modules)\n    if (\n      module.resource &&\n      module.resource.indexOf('node_modules') === -1\n    ) {\n      let packageDotJsonPath;\n      if (isMonorepo) {\n        let packagesDir = `${process.cwd()}/packages`;\n        packagesDir = ensureTrailingSlash(packagesDir);\n        // get substring from first trailing slash after whatever packagesDir is\n        // console.log(module.resource);\n        const packageFolderName = module.resource.split(packagesDir)[1].split('/')[0];\n        packageDotJsonPath = `${packagesDir}${packageFolderName}/package.json`;\n      } else {\n        packageDotJsonPath = `${process.cwd()}/package.json`;\n      }\n\n      const packageDotJsonContent = (\n        packageDotJsonCache[packageDotJsonPath] || ensureReadJsonSync(packageDotJsonPath)\n      );\n      packageDotJsonCache[packageDotJsonPath] = packageDotJsonContent;\n\n      const packageSomehowPublic = (\n        !packageDotJsonContent.private ||\n        !packageDotJsonContent.privateFromGithub\n      );\n\n      // only concerned if module's package.json is not empty,\n      // and if it is public on either NPM or Girhub\n      if (Object.keys(packageDotJsonContent).length && packageSomehowPublic) {\n        const depProblems = findDependenciesProblems(module.dependencies, packageDotJsonContent);\n        if (depProblems) {\n          problems[module.resource] = depProblems;\n        }\n      }\n    }\n  });\n  if (Object.keys(problems).length > 0 && shouldShowProblemsInConsole) {\n    showProblemsInConsole(problems);\n  }\n\n  return problems;\n}\n\nexport default webpackParseStatsForDepProblems;\n\n\n\n// WEBPACK FOOTER //\n// ./webpackParseStatsForDepProblems.js","module.exports = require(\"validate-npm-package-name\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"validate-npm-package-name\"\n// module id = 48\n// module chunks = 0","import serve from './bernieExpressServer';\n\nexport default serve;\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/bernieserver.express.js","import mymodule from './public/js/mymodule';\nimport express from 'express';\nimport ejs from 'ejs';\nimport path from 'path';\nimport url from 'url';\nimport fs from 'fs';\nimport { x as mongooseStuff } from './js/mongooseStuff';\nimport endpointCompositeImage from './js/endpointCompositeImage';\nimport endpointGetNormalizedImageInfo from './js/endpointGetNormalizedImageInfo';\nimport endpointGetS3SignedUploadUrl from './js/endpointGetS3SignedUploadUrl';\nimport endpointIframeUpload from './js/endpointIframeUpload';\nimport generateUrlRegexNamespace from './js/generateUrlRegexNamespace';\nimport respondWithJson from './js/respondWithJson';\nimport ensureLeadingSlash from '@defualt/ensure-leading-slash';\n// var mymodule = require('./public/js/mymodule');\n// var express = require('express');\n// var ejs = require('ejs');\n// var path = require('path');\n// var url = require('url');\n// var mongooseStuff = require('./js/mongooseStuff').x;\n// var endpointCompositeImage = require('./js/endpointCompositeImage');\n\n// var endpointGetNormalizedImageInfo = require('./js/endpointGetNormalizedImageInfo');\n\n// var endpointGetS3SignedUploadUrl = require('./js/endpointGetS3SignedUploadUrl');\n\n// var endpointIframeUpload = require('./js/endpointIframeUpload');\n// var fs = require('fs');\n\n/*\n * Set-up the Express app.\n */\n\nexport default function ({app, nameSpace})  {\n  app.set('views', __dirname + '/views');\n  app.engine('html', ejs.renderFile);\n\n  app.use(express.static(path.join(__dirname, 'public')));\n\n  /*\n   * Load the S3 information from the environment variables.\n   */\n  var AWS_ACCESS_KEY = process.env.AWS_ACCESS_KEY;\n  var AWS_SECRET_KEY = process.env.AWS_SECRET_KEY;\n  var S3_BUCKET = process.env.S3_BUCKET\n\n  //===========================\n  //HTML PAGES\n  //____________________________\n\n  app.get(ensureLeadingSlash(`${nameSpace}/privacy`), function(req, res){\n      res.render('privacy.html',{\n          pageName:'privacy',\n          urlInfo:mymodule.deriveUrlInfo({nameSpace}),\n          userTemplates:userTemplates\n      });\n  });\n\n  app.get(ensureLeadingSlash(`${nameSpace}/terms`), function(req, res){\n      res.render('terms.html',{\n          pageName:'terms',\n          urlInfo:mymodule.deriveUrlInfo({nameSpace}),\n          userTemplates:userTemplates\n      });\n  });\n\n  app.get(ensureLeadingSlash(`${nameSpace}/iframeuploadbutton`), function(req, res){\n      res.render('iframeuploadbutton.html',{\n          pageName:'iframeuploadbutton',\n          urlInfo:null,\n          buttonText:req.query.buttonText\n      });\n  });\n\n\n\n  var standardRouteHtmlHandler = function(req, res){\n    var urlToUse = req.url;  \n    urlToUse = url.parse(urlToUse).pathname === '/' ? null : urlToUse;\n    var offline = typeof req.query.offline !== 'undefined';\n    var iframebutton = typeof req.query.iframebutton !== 'undefined';\n    var urlInfo = mymodule.deriveUrlInfo({pathname: urlToUse,offline,nameSpace});\n    \n    mongooseStuff.UpdateComplexImage(urlInfo).then(function(result){});\n\n    res.render('redesign'+'.html',{\n        userTemplates:userTemplates,\n        req:req,\n        urlInfo:urlInfo,\n        mymodule:mymodule,\n        offline:offline,\n        iframebutton:iframebutton\n        // pretty:stringify(req, null, 2)\n    });\n  };\n  app.get(mymodule.getStandardModesRegex(nameSpace), standardRouteHtmlHandler);\n\n  app.get(ensureLeadingSlash(`${nameSpace}/`), standardRouteHtmlHandler);\n\n  app.get(ensureLeadingSlash(`${nameSpace}/redesign`), standardRouteHtmlHandler);\n\n\n\n  app.get(ensureLeadingSlash(`${nameSpace}/list`), function(req, res){\n      var offline = typeof req.query.offline !== 'undefined';\n      mongooseStuff.GetComplexImageAll().then(function(images){\n      // mongooseStuff.getImages().then(function(images){\n        res.render('list.html', { \n            images:images,\n            offline:offline\n        });\n      });\n  });\n\n\n  var userTemplates = []; \n  //===========================\n  //ENDPOINTS\n  //____________________________\n\n  endpointCompositeImage({\n    app:app,\n    accessKeyId:AWS_ACCESS_KEY,\n    secretAccessKey:AWS_SECRET_KEY,\n    Bucket: S3_BUCKET,\n    urlPattern: generateUrlRegexNamespace('image\\/')\n  });\n\n  endpointGetNormalizedImageInfo({\n    app:app,\n    accessKeyId:AWS_ACCESS_KEY,\n    secretAccessKey:AWS_SECRET_KEY,\n    Bucket: S3_BUCKET,\n    userTemplates:userTemplates,\n    urlPattern: ensureLeadingSlash(`${nameSpace}/get_normalized_image_info`)\n  });\n  endpointGetS3SignedUploadUrl({\n    app:app,\n    accessKeyId:AWS_ACCESS_KEY,\n    secretAccessKey:AWS_SECRET_KEY,\n    Bucket: S3_BUCKET,\n    urlPattern: ensureLeadingSlash(`${nameSpace}/get_s3_signed_upload_url`)\n  });\n\n  endpointIframeUpload({\n    app:app,\n    accessKeyId:AWS_ACCESS_KEY,\n    secretAccessKey:AWS_SECRET_KEY,\n    Bucket: S3_BUCKET,\n    urlPattern: ensureLeadingSlash(`${nameSpace}/uploadsimple`)\n  });\n\n  app.get(ensureLeadingSlash(`${nameSpace}/get_template_list`), (req, res) => {\n    respondWithJson({\n      res,\n      userTemplates,\n    });\n  });\n\n\n\n\n  // require('./js/passportStuff')({\n  //   app:app\n  // });\n  // app.listen(3000);\n\n\n\n\n\n\n\n\n\n\n  app.post(ensureLeadingSlash(`${nameSpace}/SimpleImage`),function(req, res){\n    var data = req.body;\n    mongooseStuff.simpleimage(data.url, data.idX).then(function() {\n      res.send({\n          status:\"success\"\n      })\n    })\n  })\n\n  app.post(ensureLeadingSlash(`${nameSpace}/ComplexImage`), function(req, res){\n      var data = req.body;\n\n      mongooseStuff.ComplexImage(data).then(function(result){\n        res.send({\n            status:\"success\",\n            result:result,\n            payload:data\n        })\n      });\n  });\n\n  app.post(ensureLeadingSlash(`${nameSpace}/GetComplexImage`), function(req, res){\n      var data = req.body.data;\n      mongooseStuff.GetComplexImage('asdf').then(function(result){\n        res.send({\n            status:\"success\",\n            result:result\n        })\n      });\n  });\n\n  app.post(ensureLeadingSlash(`${nameSpace}/UpdateComplexImage`), function(req, res){\n      var data = req.body;\n      mongooseStuff.UpdateComplexImage(data).then(function(result){\n        res.send({\n            status:\"success\",\n            result:result\n        })\n      });\n  });\n\n\n\n\n  // GetComplexImage\n  // mongooseStuff.ComplexImage({url:'asdf'}).always(function(arguments){\n  //    console.log('ComplexImage',arguments)\n  //  })\n\n  // mongooseStuff.GetComplexImageAll().always(function(arguments){\n  //   console.log('ComplexImage',arguments)\n  // })\n   \n  mongooseStuff.GetUserTemplatesAll().always(function(data){\n    // console.log('GetUserTemplatesAll',data);\n    userTemplates = data;\n    // console.log('userTemplates',userTemplates)\n  })\n\n  return app;\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/bernieExpressServer.js",";var mymoduleName = 'mymodule';\n\n\nvar templateBaseUrl = 'http://s3-us-west-1.amazonaws.com/bernieapp/decorations/';\n\nvar rawImagePrefix = 'http://s3-us-west-1.amazonaws.com/bernieapp/selfies/';\n\n\nvar isNode= (function(){\n\tvar isNode = false;    \n\tif (typeof process === 'object') {\n\t  if (typeof process.versions === 'object') {\n\t    if (typeof process.versions.node !== 'undefined') {\n\t      isNode = true;\n\t    }\n\t  }\n\t}\n\treturn isNode;\n})();\n\n;(function(exports){\n\n\tvar standardModes = [\n\t\t{\n\t\t\tmode:'f',\n\t\t\tfeatured:false,\n\t\t\told:true\n\t\t},\n\t\t{\n\t\t\tmode:'ut',\n\t\t\tfeatured:false\n\t\t},\n\t\t{\n\t\t\tmode:'b',\n\t\t\tfeatured:false,\n\t\t\told:true\n\t\t},\n\t\t{\n\t\t\tmode:'h',\n\t\t\tfeatured:false,\n\t\t\told:true\n\t\t},\n\t\t{\n\t\t\tmode:'selfie',\n\t\t\tfeatured:false,\n\t\t\told:true\n\t\t},\n\t\t{\n\t\t\tmode:'h3',\n\t\t\tfeatured:true\n\t\t},\n\t\t{\n\t\t\tmode:'h4',\n\t\t\tfeatured:true\n\t\t},\n\t\t{\n\t\t\tmode:'wg',\n\t\t\tfeatured:true\n\t\t}\n\t];\n\texports.standardModes = standardModes;\n\texports.getStandardModesRegex = function(nameSpace){\n\t\tvar pipedString = ''\n\t\tfor(var i =0,l=exports.standardModes.length;i<l;i++){\n\t\t\tvar mode = exports.standardModes[i].mode;\n\t\t\tmode = nameSpace ? (nameSpace + '\\/' + mode) : mode;\n\t\t\tpipedString += i > 0 ? ('|' + mode) : mode;\n\n\t\t}\n\t\treturn new RegExp('^[/]('+pipedString+')[/](.+)');\n\t};\n\n\texports.oldModes = (function(){\n\t\tvar a = []\n\t\tfor(var i =0,l=exports.standardModes.length;i<l;i++){\n\t\t\tif(!!exports.standardModes[i].old){\n\t\t\t\ta.push(exports.standardModes[i]);\n\t\t\t}\n\t\t}\n\t\treturn a;\n\t})();\n\n\texports.isOldMode = function(toCompare){\n\t\tvar is = false;\n\t\tfor(var i =0,l=exports.oldModes.length;i<l;i++){\n\t\t\tis = is || toCompare === exports.oldModes[i].mode;\n\t\t}\n\t\treturn is;\n\t};\n\n\tvar containsStardardModeCache = {};\n\texports.containsStardardMode = function(url){\n\t\tvar contains = false;\n\t\tif(typeof containsStardardModeCache[url] === 'undefined'){\n\t\t\tfor(var i =0,l=exports.standardModes.length;i<l;i++){\n\t\t\t\tvar mode = exports.standardModes[i].mode;\n\t\t\t\tcontains = contains || url.indexOf(mode) !== -1;\n\t\t\t}\n\t\t\tcontainsStardardModeCache[url] = contains;\n\t\t}\n\t\treturn containsStardardModeCache[url];\n\t};\n\n\t\n\n\tvar DeriveUrlInfo = function({pathname,offline,nameSpace}){\n\t\tthis.init({pathname,offline,nameSpace})\n\t\t\n\t\t\n\t};\n\tDeriveUrlInfo.prototype.init = function({pathname,offline,nameSpace}){\n\t\tthis.nameSpace = nameSpace;\n\t\tthis.nameSpaceWithLeadingSlash = nameSpace ? `/${nameSpace}` : '';\n\t\tvar nameSpaceWithLeadingSlash = this.nameSpaceWithLeadingSlash;\n\t\tthis.offline = offline;\n\t\tvar defaultPathname = '/h3/zephyr1476401787491/180_3_218_218_553_553/';\n\t\tpathname = !!pathname !== 0 ? pathname : defaultPathname;\n\t\tpathname = pathname === nameSpaceWithLeadingSlash || pathname === nameSpaceWithLeadingSlash + '/' ? defaultPathname : pathname;\n\t\tif (pathname && pathname.indexOf(this.nameSpaceWithLeadingSlash) === 0) {\n\t\t\tpathname = pathname.replace(this.nameSpaceWithLeadingSlash, '');\n\t\t}\n\t\tpathname = pathname ? pathname : defaultPathname;\n\n\t\tthis.slashSplit = pathname.split('/');\n\t\tif(pathname.indexOf('/f/') === 0){\n\t\t\tthis.idX = this.slashSplit[4];\n\t\t\tthis.customTemplate = this.slashSplit[2];\n\t\t} else if(pathname.indexOf('/selfie/') === 0){\n\t\t\tpathname = '/selfie/v1438476536/bernie/' + this.slashSplit[4];\n\t\t\tthis.slashSplit = pathname.split('/');\n\t\t\tthis.idX = this.slashSplit[4];\n\t\t\tthis.customTemplate = 'i4hiodnsy2yaqavpowm1';\n\t\t} else {\n\t\t\t//pathname.indexOf('/h/') === 0\n\t\t\t//pathname.indexOf('/h3/') === 0\n\t\t\tthis.idX = this.slashSplit[2];\n\t\t}\n\n\t\tif(pathname.indexOf('/ut/') === 0){\n\t\t\tthis.customTemplate = this.slashSplit[4];\n\t\t}\n\n\t\tif(pathname.indexOf('/h/') === 0){\n\t\t\tthis.customTemplate = 'hairglasses';\n\t\t}\n\n\t\tthis.pathname = this.nameSpaceWithLeadingSlash + pathname;\n\t\tconsole.log('this.slashSplit',this.slashSplit);\n\t\tthis.coords = this.slashSplit[3].split('_');\n\n\t\tfor(var i=0,l=this.coords.length;i<l;i++){\n\t\t\tthis.coords[i] = +this.coords[i];\n\t\t}\n\n\t\tthis.dims = this.coords.splice(4,2);\n\t\tthis.width = +this.dims[0];\n\t\tthis.height = +this.dims[1];\n\t\tthis.x = this.coords[0];\n\t\tthis.y = +this.coords[1];\n\t\tthis.cropWidth = this.coords[2];\n\t\tthis.cropHeight = this.coords[3];\n\t\t\n\t\tthis.format = '.jpg';\n\n\t\tthis.customUrl = '';\n\t\tthis.customUrlQueryString = '';\n\t\tthis.makeCustomUrl({\n\n\t\t});\n\t};\n\tDeriveUrlInfo.prototype.normalize = function(val,def){\n\t\tdef = typeof def !== 'undefined' ? def : true;\n\t\tval = typeof val !== 'undefined' ? val : def;\n\t\tif(typeof def === 'number'){\n\t\t\tval = typeof val === 'string' ? +val : val;\n\t\t\tval = !isNaN(val) ? val : def;\n\t\t\tval = Math.round(val);\n\t\t}\n\t\t\n\t\treturn val;\n\t}\n\tDeriveUrlInfo.prototype.doubleNormalize = function(val,prexisting,def){\n\t\tvar def = this.normalize(prexisting,def);\n\t\treturn this.normalize(val,def);\n\t}\n\tDeriveUrlInfo.prototype.doubleNormalizeInterface = function(dest,options,defaults){\n\t\tfor(var name in defaults){\n\t\t\tvar def = defaults[name];\n\t\t\tdest[name] = this.doubleNormalize(options[name],dest[name],def);\n\t\t}\n\t};\n\n\tDeriveUrlInfo.prototype.makeCustomUrl = function(settings){\n\t\tvar mode = this.slashSplit[1].toLowerCase();\n\t\t\n\t\tvar toNormalize = {\n\t\t\t'x':mode !== 'selfie' ? 0 : 142,\n\t\t\t'y':mode !== 'selfie' ? 0 : 98,\n\t\t\t'cropWidth':mode !== 'selfie' ? 1200 : 305,\n\t\t\t'cropHeight':mode !== 'selfie' ? 1200 : 305,\n\t\t\t'width':1200,\n\t\t\t'height':1200,\n\t\t\t'idX':'zephyr1476401787491.png',\n\t\t\t'mode':mode\n\t\t};\n\t\tif(!!settings.customTemplate){\n\t\t\ttoNormalize.customTemplate = settings.customTemplate;\n\t\t}\n\t\tthis.doubleNormalizeInterface(this,settings,toNormalize);\n\t\tthis.idX = this.idX.split('.');\n\t\tif(this.idX.length > 1){\n\t\t\tthis.idX.pop();\n\t\t}\n\t\tthis.idX = this.idX.join('.');\n\t\tthis.rawImage = rawImagePrefix + this.idX;\n\t\tthis.rawImage = !!this.offline ? '/images/mock-selfie-raw.jpg' : this.rawImage;\n\t\tif(this.rawImage.indexOf('.') === -1){\n\t\t\tthis.rawImage += '.png';\n\t\t}\n\t\tif(this.mode === 'f' || this.mode === 'selfie'){\n\t\t\tthis.customTemplate = 'wg';\n\t\t\tthis.doStandardSquare();\n\t\t}else{\n\t\t\tthis.doStandardSquare()\n\t\t}\n\t};\n\tDeriveUrlInfo.prototype.serialize = function(obj, prefix) {\n\t\tif(typeof obj !== 'object'){\n\t\t\tobj = {whatever:obj};\n\t\t}\n\t    var str = [];\n\t    for (var p in obj) {\n\t        if (obj.hasOwnProperty(p)) {\n\t            var k = prefix ? prefix + \"[\" + p + \"]\" : p,\n\t                v = obj[p];\n\t            str.push(typeof v == \"object\" ?\n\t                serialize(v, k) :\n\t                encodeURIComponent(k) + \"=\" + encodeURIComponent(v));\n\t        }\n\t    }\n\t    str = str.join(\"&\");\n\t    str = str.replace('whatever=','')\n\t    return str;\n\t};\n\n\tDeriveUrlInfo.prototype.doStandardSquare = function(){\n\t\tthis.pathname = '/'+this.mode+'/'+this.idX+'/'+this.x+'_'+this.y+'_'+this.cropWidth+'_'+this.cropHeight+'_'+this.width+'_'+this.height+'/'\n\t\tif(!!this.customTemplate && this.mode !== 'h'){\n\t\t\tthis.pathname += this.customTemplate + '/';\n\t\t}\n\t\t\n\t\tvar userPhotoKey = this.idX;\n\t\tuserPhotoKey = userPhotoKey.split('.');\n\t\tif(userPhotoKey.length > 1){\n\t\t\tuserPhotoKey.pop();\n\t\t}\n\t\tuserPhotoKey = userPhotoKey.join('.');\n\t\tuserPhotoKey = userPhotoKey;\n\t\t\n\t\tvar customUrlSettings = {\n\t\t\tcropWidth: this.cropWidth,\n\t\t\tcropHeight: this.cropHeight,\n\t\t\tx: this.x,\n\t\t\ty: this.y,\n\t\t\ttemplate:(!!this.customTemplate ? this.customTemplate : this.mode),\n\t\t\tuserPhotoKey: userPhotoKey\n\t\t};\n\t\tvar s = customUrlSettings;\n\n\t\tthis.customUrl = ('' +\n\t\t\t'/image/' + \n\t\t\ts.template +\n\t\t\t'/' +\n\t\t\ts.userPhotoKey +\n\t\t\t'_' + s.cropWidth + '_' + s.cropHeight + '_' + s.x + '_' + s.y + '.jpg' +\n\t\t'');\n\t\tthis.customUrl = !!this.offline ? '/images/mock-selfie.png' : this.customUrl;\n\t\tthis.customUrlQueryString = this.serialize(this.customUrl);\n\n\t\treturn this.customUrl;\n\t};\n\n\texports.generateTemplateImgListHtml = function(userTemplates,offline){\n\t\tvar imgsHtml = '';\n\t\tif(offline){\n\t\t\t;(function(){\n\t\t\t\tvar offlineTemplates = [\n                    {customTemplate:'/images/h3.png'},\n                    {customTemplate:'/images/h4.png'},\n                    {customTemplate:'/images/h3.png'}\n                ];\n\t            for(var i=0,l=offlineTemplates.length;i<l;i++){\n\t            \timgsHtml += '<div class=\"designFrame\">';\n\t            \t\timgsHtml += '<div class=\"designFrame_innerWrap\">';\n\t                \t\timgsHtml += '<img class=\"designFrame_design userTemplate\" src=\"'+offlineTemplates[i].customTemplate+'\">'\n\t            \t\timgsHtml += '</div>';\n\t            \timgsHtml += '</div>';\n\t            }\n\t            \n\t        })();\n\t\t}else{\n\t\t\t;(function(){\n\t            for(var i=0,l=standardModes.length;i<l;i++){\n\t                if(!!standardModes[i].featured){\n\t                \timgsHtml += '<div class=\"designFrame\">';\n\t\t                \timgsHtml += '<div class=\"designFrame_innerWrap\">';\n\t\t                    \timgsHtml += '<img class=\"designFrame_design standardTemplate\" src=\"' + templateBaseUrl +standardModes[i].mode+'.png\">';\n\t\t                \timgsHtml += '</div>';\n\t                \timgsHtml += '</div>';\n\t                }\n\t            }\n\t        })();\n\t        ;(function(){\n\t            for(var i=0,l=userTemplates.length;i<l;i++){\n\t            \timgsHtml += '<div class=\"designFrame\">';\n\t\t            \timgsHtml += '<div class=\"designFrame_innerWrap\">';\n\t\t                \timgsHtml += '<img class=\"designFrame_design userTemplate\" src=\"' + templateBaseUrl +userTemplates[i].customTemplate+'.png\">'\n\t\t            \timgsHtml += '</div>';\n\t            \timgsHtml += '</div>';\n\t            }\n\t            \n\t        })();\n        }\n        return imgsHtml;\n\t};\n\texports.deriveUrlInfo = function({pathname,offline,nameSpace}){\n\t\treturn new DeriveUrlInfo({pathname,offline,nameSpace});\n\t};\n\n})(typeof exports === 'undefined'? this[mymoduleName]={}: exports);\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/public/js/mymodule.js","module.exports = require(\"ejs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"ejs\"\n// module id = 52\n// module chunks = 0","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 53\n// module chunks = 0","module.exports = require(\"mongoose\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongoose\"\n// module id = 54\n// module chunks = 0","module.exports = require(\"mongodb-uri\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongodb-uri\"\n// module id = 55\n// module chunks = 0","/* eslint-disable */\nimport aws from 'aws-sdk';\nimport path from 'path';\nimport {parse as parseUrl} from 'url';\nimport ensureLeadingSlash from '@defualt/ensure-leading-slash';\nimport getAllS3Objects from './getAllS3Objects';\nimport getS3ObjectData from './getS3ObjectData';\nimport meldAndCropImages from './meldAndCropImages';\nimport respondWithJson from './respondWithJson';\n\nvar parseClientCompositeImageUrl = function(url){\n  var pathnameSplit = parseUrl(url).pathname.split('/').splice(2,2);\n  var compositeS3Key = 'consolidated/' + pathnameSplit.join('/');\n  var templateFilename = pathnameSplit[0];\n  var userImageAndScalePos = pathnameSplit[1];\n  userImageAndScalePos = userImageAndScalePos.split('_');\n  var userImageFilename = userImageAndScalePos;\n  var scalePos = userImageFilename.splice(-4,4);\n  scalePos[3] = scalePos[3].split('.');\n  scalePos[3].pop();\n  scalePos[3] = scalePos[3].join('.');\n  var overlaySettings = {\n    width: +scalePos[0] == scalePos[0] ? +scalePos[0] : 100,\n    height: +scalePos[1] == scalePos[1] ? +scalePos[1] : 100,\n    left: +scalePos[2] == scalePos[2]? +scalePos[2] : 0,\n    top: +scalePos[3] == scalePos[3]? +scalePos[3] : 0,\n  };\n  console.log('overlaySettings',overlaySettings);\n  userImageFilename = userImageFilename.join('_');\n  return {\n    userImageFilename: userImageFilename,\n    templateFilename: templateFilename,\n    overlaySettings: overlaySettings,\n    compositeS3Key:compositeS3Key\n  };\n};\n// Generate composite images.\n// Requests are either .png, .jpg, or .json.\n// If .json, the composite image is generated, uploaded to S3,\n// and the S3 item key is sent to the client in json.\nexport default ({app,accessKeyId,secretAccessKey,Bucket,urlPattern}) => {\n  app.get(urlPattern, function(req, res) {\n    console.log('EXTNSSION', )\n    var extension = path.extname(req.url);\n    var fileTypes = {\n      '.json': 'png',\n      '.png': 'png',\n      '.jpg': 'jpeg',\n      '.jpeg': 'jpeg'\n    };\n    var fileType = fileTypes[extension] ? fileTypes[extension] : 'jpeg';\n    console.log('fileType',fileType);\n    var compositeImageInstructions = parseClientCompositeImageUrl(req.url);\n    var s = compositeImageInstructions;\n    console.log('s.compositeS3Key',s.compositeS3Key);\n    getS3ObjectData({\n      Key:s.compositeS3Key,\n      resolveNullOn404:true,\n      accessKeyId:accessKeyId,\n      secretAccessKey:secretAccessKey,\n      Bucket: Bucket\n    }).then(function(data){\n      if(!data){\n        console.log('COMPOSITE IMAGE DOES NOT EXIST!');\n\n        var templateCreateMode = !s.templateFilename || s.templateFilename === 'undefined';\n\n        const getAllS3ObjectsSettingsDict = {\n          userPhoto:{\n              Key:'selfies/' + s.userImageFilename + '.png',\n              retrySearchCriteria:{\n                Prefix:'res/dthvwwocq/image/upload/bernie/'+s.userImageFilename,\n                Bucket: 'cloudinary-bernie-backup'\n              }\n            }\n        };\n        if (!templateCreateMode) {\n          getAllS3ObjectsSettingsDict.template = {\n            Key:'decorations/' + s.templateFilename + '.png'\n          };\n        }\n        \n        getAllS3Objects({\n          dict:getAllS3ObjectsSettingsDict,\n          Bucket:Bucket,\n          accessKeyId: accessKeyId,\n          secretAccessKey: secretAccessKey\n        })\n        .then(meldAndCropImages.bind(null,s.overlaySettings))\n        .then(function(bufferData){\n          \n          var Key = s.compositeS3Key;\n          if (templateCreateMode) {\n            Key = 'decorations/' + s.userImageFilename + '.png'\n          } else {\n            res.setHeader('content-type', 'image/'+fileType);\n            res.write(bufferData.Body,'binary');\n            res.end(null, 'binary');\n          }\n\n          aws.config.update({accessKeyId: accessKeyId , secretAccessKey: secretAccessKey });\n          var s3 = new aws.S3(); \n          s3.putObject(\n            {\n                Bucket: Bucket,\n                Key: Key,\n                Body: bufferData.Body,\n                ContentType: 'image/'+fileType,\n                ACL: 'public-read'\n            },\n            function(err, data) {\n                if (err) {\n                    // Failed saving to S3\n                    log.error('Failed saving to S3', err);\n                } else {\n                  if (templateCreateMode) {\n                    respondWithJson({\n                      Key:Key,\n                      res:res,\n                      isSuccess:true\n                    });\n                  }\n                }\n            }\n          );\n        });\n      } else {\n        console.log('COMPOSITE IMAGE DOES IN FACT EXIST !!!!');\n        res.setHeader('content-type', data.ContentType);\n        res.write(data.Body,'binary');\n        res.end(null, 'binary');\n      }\n    });\n  });\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/endpointCompositeImage.js","var aws = require('aws-sdk');\nvar jD = require('jquery-deferred');\nvar getS3ObjectData = require('./getS3ObjectData');\nmodule.exports = function(s){\n  var dfdMain = jD.Deferred();\n  var promises = [];\n  aws.config.update({accessKeyId: s.accessKeyId , secretAccessKey: s.secretAccessKey });\n  var s3 = new aws.S3();\n  for(var entryName in s.dict){\n    var entry = s.dict[entryName];\n    var filename = entry.Key;\n    (function(entryName,filename,entry){\n      var entryDfd = jD.Deferred();\n      getS3ObjectData({\n        Key:filename,\n        outputParser:function(data){\n          return {\n            entryName:entryName,\n            filename:filename,\n            data:data,\n          };\n        },\n        accessKeyId:s.accessKeyId,\n        secretAccessKey:s.secretAccessKey,\n        Bucket: s.Bucket\n      })\n      .then(entryDfd.resolve)\n      .fail(function(originalErr){\n        if(entry.retrySearchCriteria){\n          var retryBucket = entry.retrySearchCriteria.Bucket ? entry.retrySearchCriteria.Bucket : s.Bucket\n          var aws = require('aws-sdk');\n          aws.config.update({accessKeyId: s.accessKeyId , secretAccessKey: s.secretAccessKey });\n          var s3 = new aws.S3(); \n          var params = {\n            Bucket: retryBucket,\n            Prefix: entry.retrySearchCriteria.Prefix\n          };\n          s3.listObjectsV2(params, function(err, data) {\n            if(err){\n              entryDfd.reject(err);\n            } else {\n              if(data.Contents && data.Contents[0]){\n                getS3ObjectData({\n                  Key:data.Contents[0].Key,\n                  outputParser:function(data){\n                    return {\n                      entryName:entryName,\n                      filename:filename,\n                      data:data,\n                    };\n                  },\n                  accessKeyId:s.accessKeyId,\n                  secretAccessKey:s.secretAccessKey,\n                  Bucket:retryBucket\n                })\n                .then(function(){\n                  var args = arguments;\n                  var normalizeImageFileData = require('./normalizeImageFileData')({\n                    prepareModuleWithDefaults: true,\n                    filename: filename,\n                    parseSettings: function(s){\n                      s.Body = s.data.Body;\n                      return s;\n                    }\n                  });\n                  var uploadToS3 = require('./uploadToS3')({\n                    prepareModuleWithDefaults: true,\n                    accessKeyId:s.accessKeyId,\n                    secretAccessKey:s.secretAccessKey,\n                    Bucket:s.Bucket,\n                  });\n                  this.then(normalizeImageFileData).then(uploadToS3).always(function(){\n                    entryDfd.resolve.apply(null,args);\n                  });\n                  return this;\n                })\n                .fail(entryDfd.reject);\n              } else {\n                entryDfd.reject(originalErr);\n              }\n            }\n          });\n        } else {\n          entryDfd.reject(originalErr);\n        }\n      });\n      promises.push(entryDfd.promise());\n    })(entryName,filename,entry);\n  }\n\n  jD.when.apply(null,promises).done(function ( templateFetchResponse, userPhotoFetchResponse) {\n    var args = Array.prototype.slice.call(arguments);\n    var output = {};\n    for(var i=0,l=args.length;i<l;i++){\n      var entryName = args[i].entryName;\n      delete args[i].Key;\n      output[entryName] = args[i];\n    }\n    dfdMain.resolve(output);\n  }).then(null,function(err){\n    dfdMain.reject(err);\n  });\n  return dfdMain.promise();\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/getAllS3Objects.js","module.exports = require(\"mime-types\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mime-types\"\n// module id = 58\n// module chunks = 0","/* eslint-disable */\nvar sharp = require('sharp');\nvar jD = require('jquery-deferred');\nvar calcOverlayAndTemplateProcessingSettings = require('./calcOverlayAndTemplateProcessingSettings');\n\n// Normally, this will meld a foreground and a background image together,\n// and crop them to a square, as a new image jpeg.\n// But when templateCroppingMode is true,\n// only the foreground image is used,\n// and it alone gets cropped as a new image png.\nmodule.exports = function(overlaySettings,responses){\n  var dfd = jD.Deferred();\n  var templateFetchResponse = responses.template;\n  var templateCroppingMode = !templateFetchResponse;\n  var userPhotoFetchResponse = responses.userPhoto;\n  var args = Array.prototype.slice.call(arguments);  \n  var userPhoto = sharp(userPhotoFetchResponse.data.Body);\n  var bgColor = templateCroppingMode ? {r: 0, g: 0, b: 0, alpha: 0} : 'white';\n  var fileType = templateCroppingMode ? 'png' : 'jpeg';\n  userPhoto.metadata().then(function(metadata) {\n    var imageProcessingSettings = calcOverlayAndTemplateProcessingSettings(overlaySettings,metadata);\n    var s = imageProcessingSettings;\n    if(s.completelyOutOfBound){\n      var responseToProcess = templateCroppingMode ? userPhotoFetchResponse : templateFetchResponse;\n      var template = sharp(responseToProcess.data.Body);\n      template.resize(s.limit, s.limit).min().max();\n      template = template.background(bgColor);\n      if (!templateCroppingMode) {\n        template = template.flatten()\n      }\n      template[fileType]().toBuffer().then(function(templateBuffer){\n        dfd.resolve({\n          Body: templateBuffer,\n        });\n      });\n    } else {\n      if(s.extract){\n        userPhoto.extract(s.extract);\n      }\n      if(s.extend){\n        userPhoto.extend(s.extend);\n      }\n      userPhoto = userPhoto.background(bgColor);\n      if (!templateCroppingMode) {\n        userPhoto = userPhoto.flatten();\n      }\n      userPhoto.toBuffer().then(function(userPhotoBuffer){\n        var userPhoto = sharp(userPhotoBuffer);\n        userPhoto.resize(1200,1200);\n        if  (templateCroppingMode) {\n          userPhoto.png().toBuffer().then(function(userPhotoBuffer){\n            dfd.resolve({\n              Body: userPhotoBuffer,\n            });\n          });\n        } else {\n          var template = sharp(templateFetchResponse.data.Body);\n          template.resize(1200, 1200).min().max();\n          template.toBuffer().then(function(templateBuffer){\n            userPhoto.overlayWith(templateBuffer, {\n              top: 0,\n              left: 0\n            });\n            userPhoto.jpeg().toBuffer().then(function(userPhotoBuffer){\n              dfd.resolve({\n                Body: userPhotoBuffer,\n              });\n            });\n          });\n        }\n      })       \n    }    \n    return userPhoto\n  });\n  return dfd.promise();\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/meldAndCropImages.js","module.exports = function(cropSettings,userPhotoWidthHeight){\n  var limit = 1200;\n  // var scale = overlaySettings.scale;\n  var cropWidth = cropSettings.width;\n  var cropHeight = cropSettings.height;\n  var cropTop = cropSettings.top;\n  var cropLeft = cropSettings.left;\n  var cropRight = cropLeft + cropWidth;\n  var cropBottom = cropTop + cropHeight;\n  var rawWidth = userPhotoWidthHeight.width;\n  var rawHeight = userPhotoWidthHeight.height;\n  var rawRight = rawWidth;\n  var rawBottom = rawHeight;\n  var rawTop = 0;\n  var rawLeft = 0;\n\n  var s = {};\n\n  \n  s.extract = {\n    left: cropLeft > 0 ? cropLeft : 0,\n    top: cropTop > 0 ? cropTop : 0,\n  };\n  s.extract.width = cropRight < rawRight ? cropRight : rawRight;\n  s.extract.width =  s.extract.width - s.extract.left;\n  s.extract.width = s.extract.width > 0 ? s.extract.width : 0;\n  s.extract.height = cropBottom < rawBottom ? cropBottom : rawBottom;\n  s.extract.height =  s.extract.height - s.extract.top;\n  s.extract.height = s.extract.height > 0 ? s.extract.height : 0;\n\n\n\n  s.extend = {\n    left: cropLeft < 0 ? -cropLeft : 0,\n    top: cropTop < 0 ? -cropTop : 0,\n    right: cropRight > rawRight ? cropRight - rawRight : 0,\n    bottom: cropBottom > rawBottom ? cropBottom - rawBottom : 0\n  };\n  \n  s.resize = {\n    width:1200,\n    height:1200\n  }\n\n  s.completelyOutOfBound = false;\n  if(\n    (\n      s.extract.left >= rawRight ||\n      s.extract.top >= rawBottom ||\n      s.extend.left >= cropWidth ||\n      s.extend.top >= cropHeight\n    )\n  ){\n    s.completelyOutOfBound = true;\n  }\n  s.extract = s.extract.width && s.extract.height ? s.extract : null;\n  s.extend = s.extend.left || s.extend.top || s.extend.bottom || s.extend.right ? s.extend : null;\n  s.limit = limit;\n  return s;\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/calcOverlayAndTemplateProcessingSettings.js","/*\n * Respond to GET requests to /get_normalized_image_info.\n * changes size of image if it is too big\n * also rotates exif\n * responds with a new image url\n*/\nimport aws from 'aws-sdk';\nimport jD from 'jquery-deferred';\nimport { x as mongooseStuff } from './mongooseStuff';\n\nexport default ({accessKeyId,secretAccessKey,Bucket,app,userTemplates, urlPattern}) => {\n  var urlToFileData = require('./urlToFileData');\n  var uploadToS3 = require('./uploadToS3')({\n    prepareModuleWithDefaults: true,\n    accessKeyId:accessKeyId,\n    secretAccessKey:secretAccessKey,\n    Bucket:Bucket\n  });\n\n  var parseUrl = require('url').parse;\n\n  var normalizeImageFileData = require('./normalizeImageFileData')({\n    prepareModuleWithDefaults: true,\n    parseSettings: function(s){\n      var filename;\n      var originalFilename;\n      var url;\n      if(s.originalUrl.indexOf('amazonaws.com/') !== -1){\n        var host = s.originalUrl.split('amazonaws.com/');\n        host = host[0] + 'amazonaws.com/';\n        filename = s.originalUrl.split('amazonaws.com/');\n        originalFilename = filename[filename.length - 1];\n        filename = originalFilename.replace('_temp','');\n        filename = filename.split('.');\n        filename = filename[filename.length - 2];\n        filename = filename + '.png';\n        url = host + filename;\n      } else {\n        filename = parseUrl(s.originalUrl).pathname.split('/');\n        filename = filename[filename.length - 1];\n        filename = filename.split('.');\n        filename.pop();\n        filename = filename.join('.');\n        filename = filename + Date.now() + '.png';\n        filename = 'selfies/' + filename;\n        originalFilename = null;\n        url = '//s3-us-west-1.amazonaws.com/bernieapp/' + filename;\n      }\n      s.filename = filename;\n      s.url = url;\n      s.originalFilename = originalFilename;\n      return s;\n    }\n  });\n  var deep = require('deep-get-set');\n  var deleteS3Object = require('./deleteS3Object')({\n    prepareModuleWithDefaults: true,\n    parseSettings: function(s){\n      s.Key = deep(s,'originalFilename');\n      return s;\n    },\n    accessKeyId: accessKeyId,\n    secretAccessKey: secretAccessKey,\n    Bucket: Bucket\n  });\n\n  app.get(urlPattern, function(req, res){  \n    var originalUrl = decodeURIComponent(req.query.image_url);\n    var mustBeSquare = req.query.must_be_square === 'true';\n\n    var respondWithJsonSuccess = require('./respondWithJson')({\n      prepareModuleWithDefaults: true,\n      res:res,\n      isSuccess:true\n    });\n    var respondWithJsonFail = require('./respondWithJson')({\n      prepareModuleWithDefaults: true,\n      res:res,\n      isSuccess:false\n    });\n    var promise = urlToFileData(originalUrl).then(normalizeImageFileData);\n    var promises = [\n      promise,\n      promise.then(deleteS3Object),\n      promise.then(function(fileData){\n        if(mustBeSquare && (Math.abs(fileData.width - fileData.height) > 1)){\n          var dfd = jD.Deferred();\n          dfd.resolve({\n            failingSquare:true\n          });\n          return dfd.promise();\n        } else {          \n          var uploadToS3Promise = this.then(uploadToS3);\n          console.log('uploadToS3');\n          uploadToS3Promise.then(function(){\n            if(mustBeSquare){\n              var userTemplateModel = {\n                created: new Date(),\n                customTemplate: fileData.Key.replace('selfies/','').replace('.png',''),\n                templateHeight: fileData.height,\n                templateWidth: fileData.width\n              };\n              userTemplates.push(userTemplateModel);\n              mongooseStuff.MakeUserTemplate(userTemplateModel);\n            }\n          });\n          return uploadToS3Promise;\n        }\n      }).then(respondWithJsonSuccess)\n\n    ];\n    jD.when.apply(null,promises).then(null,function(err){\n      respondWithJsonFail({error:err})\n    });\n  });\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/endpointGetNormalizedImageInfo.js","var jD = require('jquery-deferred');\nmodule.exports = function(originalUrl){\n  var isHttps = originalUrl.indexOf('https://') !== -1;\n  var url = require('url');\n  \n  var dfd = jD.Deferred();\n  var options = url.parse(originalUrl);\n  var http;\n  if(isHttps){\n    http = require('https');\n  } else {\n    http = require('http');\n  }\n  console.log('http get');\n  http.get(options, function (response) {\n    console.log('GOTTEN');\n    var chunks = [];\n    response.on('data', function (chunk) {\n      chunks.push(chunk);\n    }).on('end', function() {\n      var buffer = Buffer.concat(chunks);\n      var contentType = response.headers['content-type'];\n      dfd.resolve({\n        Body: buffer,\n        ContentType: contentType,\n        originalUrl: originalUrl\n      })\n    }).on('error', (e) => {\n      dfd.reject(e);\n    });\n  }).on('error', (e) => {\n    console.error('urlFileToData http error!!!', e);\n    dfd.reject(e);\n  });;\n\n  return dfd.promise();\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/urlToFileData.js","module.exports = require(\"https\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"https\"\n// module id = 63\n// module chunks = 0","module.exports = require(\"http\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"http\"\n// module id = 64\n// module chunks = 0","module.exports = require(\"deep-get-set\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"deep-get-set\"\n// module id = 65\n// module chunks = 0","var jD = require('jquery-deferred');\nvar aws = require('aws-sdk');\nvar prepareModuleWithDefaults = require('./prepareModuleWithDefaults');\n\n\n\nmodule.exports = prepareModuleWithDefaults(function(s){\n  var dfd = jD.Deferred();\n  s = Object.assign({},s);\n  aws.config.update({accessKeyId: s.accessKeyId , secretAccessKey: s.secretAccessKey });\n  var s3 = new aws.S3();\n  \n  //toPass.uploadRequestSettings.originalFilename\n  if(s.Key){\n    s3.deleteObjects(\n      {\n        Bucket: s.Bucket,\n        Delete: {\n            Objects: [\n                 { Key: s.Key }\n            ]\n        }\n      }, function(err, data) {\n          if (err){\n            dfd.reject(err);\n          } else {\n            dfd.resolve(data);\n          }\n      }\n    );\n  } else {\n    console.log('NOTHING TO DELETE');\n    dfd.resolve({msg:'Missing key, nothing deleted.'});\n  }\n  return dfd.promise();\n});\n\n\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/deleteS3Object.js","/*\n * Respond to GET requests to /get_normalized_image_info.\n * changes size of image if it is too big\n * also rotates exif\n * responds with a new image url\n*/\nimport aws from 'aws-sdk';\nimport ensureLeadingSlash from '@defualt/ensure-leading-slash';\nimport respondWithJson from './respondWithJson';\n\nexport default ({\n  app,\n  accessKeyId,\n  secretAccessKey,\n  Bucket,\n  urlPattern\n}) => {\n  // Generates a unique aws url that the client uploads an image to.  Neat.\n  app.get(urlPattern, function(req, res){\n    aws.config.update({accessKeyId: accessKeyId , secretAccessKey: secretAccessKey });\n    var s3 = new aws.S3(); \n    var filename = req.query.file_name;\n    filename = filename.split('.');\n    var secondToLast = filename[filename.length - 2];\n    filename[filename.length - 2] = secondToLast + Date.now()+'_temp';\n    filename = filename.join('.');\n    var s3_params = { \n        Bucket: Bucket, \n        Key: filename, \n        Expires: 60, \n        ContentType: req.query.file_type, \n        ACL: 'public-read'\n    }; \n\n    s3.getSignedUrl('putObject', s3_params, function(err, data){ \n      respondWithJson({\n        res:res,\n        signed_request: err || data,\n        url: 'https://'+Bucket+'.s3.amazonaws.com/'+filename \n      });\n    });\n  });\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/endpointGetS3SignedUploadUrl.js","import ensureLeadingSlash from '@defualt/ensure-leading-slash';\nexport default ({app,accessKeyId,secretAccessKey,Bucket, urlPattern}) => {\n  app.post(urlPattern, function(req, res, next) {\n    var parseUrl = require('url').parse;\n    var normalizeImageFileData = require('./normalizeImageFileData')({\n      prepareModuleWithDefaults: true,\n      parseSettings: function(s){\n        var filename = s.filename;\n        // filename = parseUrl(s.originalUrl).pathname.split('/');\n        // filename = filename[filename.length - 1];\n        filename = filename.split('.');\n        filename.pop();\n        filename = filename.join('.');\n        filename = filename + Date.now() + '.png';\n        filename = 'selfies/' + filename;\n        s.url = '//s3-us-west-1.amazonaws.com/bernieapp/' + filename;\n        s.filename = filename;\n        return s;\n      }\n    });\n    var uploadToS3 = require('./uploadToS3')({\n      prepareModuleWithDefaults: true,\n      accessKeyId:accessKeyId,\n      secretAccessKey:secretAccessKey,\n      Bucket: Bucket\n    });\n    var apiRequestIntoBufferData = require('./apiRequestIntoBufferData');\n    apiRequestIntoBufferData(req).then(normalizeImageFileData).then(uploadToS3).then(function(r){\n      var details = {\n        url:r.url\n      };\n      app.render('iframeuploadbutton.html',{\n        lastData:{\n            width: r.width,\n            height: r.height,\n            public_id:r.Key.replace('selfies/',''),\n            url:r.url\n        },\n        buttonText:decodeURIComponent(req.query.buttonText)\n      },function(err, html){\n        res.end(html);\n      });\n    });\n  });\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/endpointIframeUpload.js","var jD = require('jquery-deferred');\nvar prepareModuleWithDefaults = require('./prepareModuleWithDefaults');\nvar Busboy = require('busboy');\n\nmodule.exports = prepareModuleWithDefaults(function(req){\n  var dfd = jD.Deferred();\n\n  var filenameDfd = jD.Deferred();\n  var busboy = new Busboy({ headers: req.headers });\n  var busboy = new Busboy({ headers: req.headers });\n  var bufferArray = [];\n  var filenamex;\n  var toResolve = {\n    Body: []\n  };\n  busboy.on('file', function(fieldname, file, filename, encoding, mimetype) {\n    // console.log('File [' + fieldname + ']: filename: ' + filename + ', encoding: ' + encoding + ', mimetype: ' + mimetype);\n    toResolve.filename = filename;\n\n    file.on('data', function(data) {\n      // console.log('File [' + fieldname + '] got ' + data.length + ' bytes',data);\n      toResolve.Body.push(data);\n\n    });\n    // file.on('end', function() {\n    //   console.log('File [' + fieldname + '] Finished');\n    // });\n  });\n  // busboy.on('field', function(fieldname, val, fieldnameTruncated, valTruncated, encoding, mimetype) {\n  //   console.log('Field [' + fieldname + ']: value: ' + inspect(val));\n  // });\n  busboy.on('finish', function() {\n    toResolve.Body = Buffer.concat(toResolve.Body);\n    // console.log('Done parsing form!',Body);\n    dfd.resolve(toResolve);\n  });\n  req.pipe(busboy);\n  \n  return dfd.promise();\n\n  /*\n  var data = [];\n  req.on('data', function(chunk) {\n      data.push(chunk);\n  });\n  var endDfd = jD.Deferred();\n  req.on('end', function(x) {\n      var Body = Buffer.concat(data);\n      // console.log(Body)\n      endDfd.resolve({\n        body: data\n      });\n  });\n  req.on('error', function(err) {\n      endDfd.reject(err);\n  });\n  */\n});\n\n\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/apiRequestIntoBufferData.js","module.exports = require(\"busboy\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"busboy\"\n// module id = 70\n// module chunks = 0","module.exports = function(standardModes){\n  if(typeof standardModes === 'string'){\n    standardModes = [standardModes];\n  }\n  var pipedString = ''\n  for(var i =0,l=standardModes.length;i<l;i++){\n    var mode = standardModes[i];\n    pipedString += i > 0 ? '|' + mode : mode;\n\n  }\n  var regx = new RegExp('^/('+pipedString+')(.+)');;\n  return regx;\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/generateUrlRegexNamespace.js","import ensureLeadingSlash from '@defualt/ensure-leading-slash';\n\n\nexport default function({app, nameSpace})  {\n  app.get(ensureLeadingSlash(`${nameSpace}/junk-express`),(req, res) => {\n      res.send({\n          status:\"success\",\n      })\n  });\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ../junk-express/junk-express.express.js"],"sourceRoot":""}