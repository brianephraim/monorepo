{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 6c659ce1f0757a0a9e27","webpack:///external \"webpack\"","webpack:///external \"path\"","webpack:///external \"yargs\"","webpack:///./core/webpackRunCompiler.js","webpack:///./webpackConfig.js","webpack:///external \"fs-extra\"","webpack:///external \"child_process\"","webpack:///./dev_env.js","webpack:///./core/shellCommand.js","webpack:///./jest/jestSpawnProcess.js","webpack:///./core/webpackBuildCommandLine.js","webpack:///external \"globby\"","webpack:///external \"webpack-node-externals\"","webpack:///external \"find-node-modules\"","webpack:///external \"extract-css-chunks-webpack-plugin\"","webpack:///external \"autodll-webpack-plugin\"","webpack:///external \"stats-webpack-plugin\"","webpack:///external \"webpack/lib/ProgressPlugin\"","webpack:///external \"node-sass-json-importer\"","webpack:///external \"write-file-webpack-plugin\"","webpack:///./core/webpack-config-resolve.js","webpack:///external \"directory-named-webpack-plugin\"","webpack:///./core/parseRequestResolvePlugin.js","webpack:///external \"single-line-log\"","webpack:///./serveUniversalExpress.js","webpack:///external \"babel-polyfill\"","webpack:///external \"webpack-dev-middleware\"","webpack:///external \"express\"","webpack:///external \"eval\"","webpack:///external \"webpack-hot-middleware\"","webpack:///external \"webpack-hot-server-middleware\"","webpack:///external \"rimraf\"","webpack:///./webpackParseStatsForDepProblems.js","webpack:///external \"validate-npm-package-name\""],"names":["processed","Promise","resolve","reject","toUse","activeWebpackDevMiddleware","run","err","stats","console","log","error","stack","details","info","toJson","hasErrors","errors","forEach","e","hasWarnings","warnings","w","warn","makeProgressPlugin","percentage","msg","current","active","modulepath","process","stdout","isTTY","cursorTo","substr","length","write","toFixed","clearLine","res","p","__xdirname","__dirname","removeKeysWithEmptyVals","obj","Object","keys","reduce","accum","key","makeOutputSettingsFromFilePath","filePath","output","split","filename","pop","path","join","makeOutputFiles","libraryNameReduced","isBuild","outputFiles","library","libraryMin","demo","makeEntry","libraryName","dirRoot","MainApp","sync","nodeModulesLocationsArray","relative","nodeModulesLocation","indexOf","externalsOld","readdirSync","filter","x","test","externals","mod","generateConfigJson","options","isCommandLine","entry","isMocha","isReact","isClient","isDev","isUniversal","env","dirroot","cwd","packageJson","readJsonSync","name","trace","config","target","devtool","publicPath","chunkFilename","libraryTarget","umdNamedDefine","modulesDir","module","rules","use","loader","exclude","extract","modules","localIdentName","importer","plugins","optimize","CommonsChunkPlugin","names","minChunks","Infinity","HotModuleReplacementPlugin","NoEmitOnErrorsPlugin","DefinePlugin","NODE_ENV","JSON","stringify","UglifyJsPlugin","compress","screw_ie8","mangle","comments","sourceMap","HashedModuleIdsPlugin","context","vendor","BannerPlugin","banner","raw","entryOnly","LimitChunkCountPlugin","maxChunks","apply","compiler","setModuleConstant","expressionName","fn","plugin","compilation","data","normalModuleFactory","parser","compilerParserPlugin","state","addVariable","resource","item","testdevenv","watch","testPathPattern","exports","commandToRun","stdio","killParentOnExit","command","args","replace","childProcess","require","proc","spawn","on","code","signal","kill","pid","exit","configPath","commandBody","DirectoryNamedWebpackPlugin","parseRequestResolvePlugin","basename","inNodeModulesRE","DirectoryDefaultFilePlugin","resolver","req","done","directory","request","match","fileSystem","stat","isDirectory","index","isFile","assign","doResolve","extensions","requestStr","shift","singleLineLog","printProgress","progress","parseRequest","callback","newRequestStr","startUniversal","app","clientDevConfig","serverDevConfig","serverNonUniversalConfig","outputPath","multiCompiler","clientCompiler","compilers","fileName","changeTime","statSync","colors","waitUntilValid","serverRendererOptions","isDeploy","buildServerMainContent","readFileSync","serverRender","default","clientStats","clientProdConfig","static","serverProdConfig","then","__non_webpack_require__","ensureTrailingSlash","str","ensureReadJsonSync","packageDotJsonPath","packageDotJsonContent","showProblemsInConsole","problems","moduleResource","depName","problemMsg","problemInfo","findDependenciesProblems","dependencies","dep","rawRequest","validationResult","validForNewPackages","devDependencies","webpackParseStatsForDepProblems","shouldShowProblemsInConsole","isMonorepo","existsSync","packageDotJsonCache","packagesDir","packageFolderName","packageSomehowPublic","private","privateFromGithub","depProblems"],"mappings":"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","file":"dist/dev_env.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"webpack\"), require(\"path\"), require(\"yargs\"), require(\"fs-extra\"), require(\"child_process\"), require(\"globby\"), require(\"webpack-node-externals\"), require(\"find-node-modules\"), require(\"extract-css-chunks-webpack-plugin\"), require(\"autodll-webpack-plugin\"), require(\"stats-webpack-plugin\"), require(\"webpack/lib/ProgressPlugin\"), require(\"node-sass-json-importer\"), require(\"write-file-webpack-plugin\"), require(\"directory-named-webpack-plugin\"), require(\"single-line-log\"), require(\"babel-polyfill\"), require(\"webpack-dev-middleware\"), require(\"express\"), require(\"eval\"), require(\"webpack-hot-middleware\"), require(\"webpack-hot-server-middleware\"), require(\"rimraf\"), require(\"validate-npm-package-name\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"@defualt/dev_env\", [\"webpack\", \"path\", \"yargs\", \"fs-extra\", \"child_process\", \"globby\", \"webpack-node-externals\", \"find-node-modules\", \"extract-css-chunks-webpack-plugin\", \"autodll-webpack-plugin\", \"stats-webpack-plugin\", \"webpack/lib/ProgressPlugin\", \"node-sass-json-importer\", \"write-file-webpack-plugin\", \"directory-named-webpack-plugin\", \"single-line-log\", \"babel-polyfill\", \"webpack-dev-middleware\", \"express\", \"eval\", \"webpack-hot-middleware\", \"webpack-hot-server-middleware\", \"rimraf\", \"validate-npm-package-name\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"@defualt/dev_env\"] = factory(require(\"webpack\"), require(\"path\"), require(\"yargs\"), require(\"fs-extra\"), require(\"child_process\"), require(\"globby\"), require(\"webpack-node-externals\"), require(\"find-node-modules\"), require(\"extract-css-chunks-webpack-plugin\"), require(\"autodll-webpack-plugin\"), require(\"stats-webpack-plugin\"), require(\"webpack/lib/ProgressPlugin\"), require(\"node-sass-json-importer\"), require(\"write-file-webpack-plugin\"), require(\"directory-named-webpack-plugin\"), require(\"single-line-log\"), require(\"babel-polyfill\"), require(\"webpack-dev-middleware\"), require(\"express\"), require(\"eval\"), require(\"webpack-hot-middleware\"), require(\"webpack-hot-server-middleware\"), require(\"rimraf\"), require(\"validate-npm-package-name\"));\n\telse\n\t\troot[\"@defualt/dev_env\"] = factory(root[\"webpack\"], root[\"path\"], root[\"yargs\"], root[\"fs-extra\"], root[\"child_process\"], root[\"globby\"], root[\"webpack-node-externals\"], root[\"find-node-modules\"], root[\"extract-css-chunks-webpack-plugin\"], root[\"autodll-webpack-plugin\"], root[\"stats-webpack-plugin\"], root[\"webpack/lib/ProgressPlugin\"], root[\"node-sass-json-importer\"], root[\"write-file-webpack-plugin\"], root[\"directory-named-webpack-plugin\"], root[\"single-line-log\"], root[\"babel-polyfill\"], root[\"webpack-dev-middleware\"], root[\"express\"], root[\"eval\"], root[\"webpack-hot-middleware\"], root[\"webpack-hot-server-middleware\"], root[\"rimraf\"], root[\"validate-npm-package-name\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_0__, __WEBPACK_EXTERNAL_MODULE_1__, __WEBPACK_EXTERNAL_MODULE_2__, __WEBPACK_EXTERNAL_MODULE_5__, __WEBPACK_EXTERNAL_MODULE_6__, __WEBPACK_EXTERNAL_MODULE_12__, __WEBPACK_EXTERNAL_MODULE_13__, __WEBPACK_EXTERNAL_MODULE_14__, __WEBPACK_EXTERNAL_MODULE_15__, __WEBPACK_EXTERNAL_MODULE_16__, __WEBPACK_EXTERNAL_MODULE_17__, __WEBPACK_EXTERNAL_MODULE_18__, __WEBPACK_EXTERNAL_MODULE_19__, __WEBPACK_EXTERNAL_MODULE_20__, __WEBPACK_EXTERNAL_MODULE_22__, __WEBPACK_EXTERNAL_MODULE_24__, __WEBPACK_EXTERNAL_MODULE_26__, __WEBPACK_EXTERNAL_MODULE_27__, __WEBPACK_EXTERNAL_MODULE_28__, __WEBPACK_EXTERNAL_MODULE_29__, __WEBPACK_EXTERNAL_MODULE_30__, __WEBPACK_EXTERNAL_MODULE_31__, __WEBPACK_EXTERNAL_MODULE_32__, __WEBPACK_EXTERNAL_MODULE_34__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 7);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 6c659ce1f0757a0a9e27","module.exports = require(\"webpack\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"webpack\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"yargs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"yargs\"\n// module id = 2\n// module chunks = 0","export default (processed) => {\n  return new Promise((resolve, reject) => {\n    const toUse = processed.activeWebpackDevMiddleware ? processed.activeWebpackDevMiddleware : processed;\n    toUse.run((err, stats) => {\n      console.log('RUN COMPILER');\n      if (err) {\n        console.error(err.stack || err);\n        if (err.details) {\n          console.error(err.details);\n        }\n        // return reject(err);\n      }\n\n      const info = stats.toJson();\n\n      if (stats.hasErrors()) {\n        info.errors.forEach((e) => {\n          console.error('\\x1b[31m', e, '\\x1b[0m');\n        });\n      }\n\n      if (stats.hasWarnings()) {\n        info.warnings.forEach((w) => {\n          console.warn('\\x1b[33m', w, '\\x1b[0m');\n        });\n      }\n      resolve(err, stats)\n    });\n  });\n};\n\n\n\n\n// WEBPACK FOOTER //\n// ./core/webpackRunCompiler.js","import webpack from 'webpack';\nimport { argv } from 'yargs';\nimport fs from 'fs-extra';\nimport globby from 'globby';\nimport nodeExternals from 'webpack-node-externals';\nimport path from 'path';\n\nimport findNodeModules from 'find-node-modules';\n\n\n\n// from universal\n// import path from 'path';\n// import webpack from 'webpack';\nimport ExtractCssChunks from 'extract-css-chunks-webpack-plugin';\nimport AutoDllPlugin from 'autodll-webpack-plugin';\nimport StatsPlugin from 'stats-webpack-plugin';\nimport ProgressPlugin from 'webpack/lib/ProgressPlugin';\nimport jsonImporter from 'node-sass-json-importer';\nimport WriteFilePlugin from 'write-file-webpack-plugin';\n\nimport webpackConfigResolve from './core/webpack-config-resolve';\n\n// from universal\nconst makeProgressPlugin = () => {\n  return new ProgressPlugin((percentage, msg, current, active, modulepath) => {\n    if (process.stdout.isTTY && percentage < 1) {\n      process.stdout.cursorTo(0);\n      modulepath = modulepath ? ` â€¦${modulepath.substr(modulepath.length - 30)}` : '';\n      current = current ? ` ${current}` : '';\n      active = active ? ` ${active}` : '';\n      process.stdout.write(`${(percentage * 100).toFixed(0)}% ${msg}${current}${active}${modulepath} `)\n      process.stdout.clearLine(1)\n    } else if (percentage === 1) {\n      process.stdout.write('\\n')\n      console.log('webpack: done.')\n    }\n  })\n};\nconst res = (p) => {\n  console.log('typeof __xdirname',typeof __xdirname,'/Users/brianephraim/Sites/monorepo/packages/dev_env/webpackConfig.js')\n  return path.resolve(typeof __xdirname !== 'undefined' ? __xdirname : __dirname, p);\n};\n\n\n\nfunction removeKeysWithEmptyVals(obj){\n  return Object.keys(obj).reduce((accum, key) => {\n    if (obj[key].length) {\n      accum[key] = obj[key];\n    }\n    return accum;\n  }, {})\n}\n\nfunction makeOutputSettingsFromFilePath(filePath) {\n  let output = filePath;\n  output = output.split('/');\n\n  output = {\n    filename: output.pop(),\n    path: output.join('/'),\n  };\n  return output;\n}\n\nfunction makeOutputFiles({libraryNameReduced,isBuild}) {\n  const outputFiles = {};\n  if (isBuild) {\n    outputFiles.library = `dist/${libraryNameReduced}`;\n    outputFiles.libraryMin = `dist/${libraryNameReduced}.min`;\n    outputFiles.demo = 'dist/demo/index';\n  } else {\n    outputFiles.demo = 'boot';\n    outputFiles.library = `${libraryNameReduced}`;\n  }\n  return outputFiles;\n}\n\nfunction makeEntry({libraryName,isBuild,dirRoot}) {\n  const libraryNameReduced = libraryName.split('/')[1] || libraryName.split('/')[0];\n  const outputFiles = makeOutputFiles({libraryNameReduced,isBuild});\n  return removeKeysWithEmptyVals(\n    argv['demo-entry']\n    ?\n    {\n      [outputFiles.demo]: [argv['demo-entry']],\n    }\n    :\n    {\n      MainApp: globby.sync([`${dirRoot}/packages/MainApp/demo.js`]),\n      [outputFiles.library]: globby.sync([\n        `${dirRoot}/${libraryNameReduced}.js`,\n        `${dirRoot}/src/library/index.js`,\n      ]),\n      ...(\n        outputFiles.libraryMin ? {\n          [outputFiles.libraryMin]: globby.sync([`${dirRoot}/src/library/index.js`]),\n        } : {}\n      ),\n      [outputFiles.demo]: globby.sync([\n        `${dirRoot}/*.demo.js`,\n        `${dirRoot}/demo.js`,\n        `${dirRoot}/**/*/*.demo.js`,\n        `${dirRoot}/**/*/demo.js`,\n        `!${dirRoot}/packages/**/*`,\n        `${dirRoot}/packages/MainApp/demo.js`,\n        `!${dirRoot}/node_modules/**/*`,\n      ]),\n    }\n  )\n}\n// /Users/brianephraim/Sites/monorepo/packages/dev_env/universal/webpack/universalWebpackConfig.js\n// /Users/brianephraim/Sites/monorepo/packages/dev_env/         /       /webpackConfig.js\nconst nodeModulesLocationsArray = findNodeModules({ relative: false });\nlet nodeModulesLocation = nodeModulesLocationsArray[0];\nif (nodeModulesLocation.indexOf('packages/dev_env') !== -1){\n  nodeModulesLocation = nodeModulesLocation.split('packages/dev_env')[0];\n  nodeModulesLocation = `${nodeModulesLocation}node_modules`\n}\n\n\nconst externalsOld = fs\n  .readdirSync(res(nodeModulesLocation))\n  .filter((x) => {\n    return !/\\.bin|react-universal-component|require-universal-module|webpack-flush-chunks/.test(x);      \n  })\n  .reduce((externals, mod) => {\n    externals[mod] = `commonjs ${mod}`\n    return externals\n  }, {});\n\n\n/* eslint-disable no-nested-ternary */\nfunction generateConfigJson(options = {}) {\n  const isCommandLine = options.isCommandLine || argv.entry;\n  const isMocha = options.isMocha;\n  const {isReact = false, isClient = false, isDev = false, isUniversal = false} = options;\n\n  const isBuild = argv.env === 'build';\n  const dirRoot = argv.dirroot || process.cwd();\n  const packageJson = fs.readJsonSync(`${dirRoot}/package.json`);\n  const libraryName = packageJson.name;\n  if (isClient && isDev ) {\n    console.log(options);\n    console.trace();\n    console.log('RRRR')\n    console.log('RRRR')\n    console.log('RRRR')\n    console.log('RRRR')\n    console.log('RRRR')\n    console.log('RRRR')\n    console.log('RRRR')\n    console.log('RRRR')\n  }\n  console.log('typeof __xdirname',typeof __xdirname,'/Users/brianephraim/Sites/monorepo/packages/dev_env/webpackConfig.js 222')\n  const config = {\n    ...(isReact ? {\n        name: isClient ? 'client' : 'server'\n    }: {}),\n    target: isReact && isClient ? 'web' : 'node',\n    devtool: 'sourcemap',\n    ...(\n      !isMocha\n      ?\n      (\n        isReact\n        ?\n        {\n          entry: [\n            ...(!isClient && !isDev ? [] : ['babel-polyfill']), // not sure why non babel-polyfill when server-prod\n            'fetch-everywhere',\n            ...(\n              isClient && isDev ? [\n              'webpack-hot-middleware/client?path=/__webpack_hmr&timeout=20000&reload=false&quiet=false&noInfo=false',\n              'react-hot-loader/patch',\n              ] : []\n            ),\n            path.resolve(typeof __xdirname !== 'undefined' ? __xdirname : __dirname,\n              isClient\n              ?\n              './universal/src/clientRender.js'\n              :\n              (\n                isUniversal\n                ?\n                './universal/server/render.js'\n                :\n                './universal/server/nonUniversalRender.js'\n              )\n            )\n          ],\n          output: {\n            path: res(isClient ? './universal/buildClient' : './universal/buildServer'),\n            filename: isClient && !isDev ? '[name].[chunkhash].js' : '[name].js',\n            publicPath: '/staticx/',\n            ...(\n              isClient\n              ?\n              {chunkFilename: isDev ? '[name].js' : '[name].[chunkhash].js'}\n              :\n              {libraryTarget: 'commonjs2'}\n            ),      \n          },\n        }\n        :\n        {\n          entry: isCommandLine ? argv.entry : makeEntry({libraryName,isBuild,dirRoot}),\n          output: isCommandLine ? makeOutputSettingsFromFilePath(argv.output) : {\n            path: `${dirRoot}`,\n            filename: '[name].js',\n            library: libraryName,\n            libraryTarget: 'umd',\n            umdNamedDefine: true,\n            publicPath: '/',\n          }\n        }\n      )\n      :\n      {}\n    ),\n\n    // for node start\n    // ...(\n    //   !isReact\n    //   ?\n    //   {\n    //     node: {\n    //       __xdirname: false,\n    //       __filename: false,\n    //     }\n    //   }\n    //   :\n    //   {}\n    // ),\n    ...(\n      isReact\n      ?\n      (!isClient ? {externals:externalsOld} : {})\n      :\n      {\n        externals: [\n          nodeExternals({\n            // modulesFromFile: true,\n            modulesDir: path.resolve((typeof __xdirname !== 'undefined' ? __xdirname : __dirname).split('/packages/dev_env')[0], './node_modules'),\n          }),\n        ],\n      }\n    ),\n    // ...(\n    //   !isReact || (isReact && !isClient)\n    //   ?\n    //   {\n    //     externals: [\n    //       nodeExternals({\n    //         // modulesFromFile: true,\n    //         modulesDir: path.resolve(__xdirname.split('/packages/dev_env')[0], './node_modules'),\n    //         ...(\n    //           isReact ?\n    //           {\n    //             whitelist: (x) => {\n    //               return !/\\.bin|react-universal-component|require-universal-module|webpack-flush-chunks/.test(x);\n    //             }\n    //             // [\n    //             //   '.bin','react-universal-component','require-universal-module','webpack-flush-chunks',\n    //             // ]\n    //           }\n    //           :\n    //           {}\n    //         )\n    //       }),\n    //     ],\n    //   }\n    //   :\n    //   {}\n    // ),\n        \n    // for node end\n\n    module: {\n      rules: [\n        // for node start\n        ...(\n          !isReact\n          ?\n          [\n            { test: /rx\\.lite\\.aggregates\\.js/, use: 'imports-loader?define=>false' },\n            { test: /async\\.js/, use: 'imports-loader?define=>false' },\n          ]\n          :\n          []\n        ),\n        // for node end\n\n        {\n          test: /\\.(js)?$/,\n          loader: 'babel-loader',\n          exclude: /(node_modules|\\.tmp)/,\n        },\n        ...(\n          isReact\n          ?\n          (\n            isClient\n            ?\n            [\n              {\n                test: /\\.css$/,\n                use: ExtractCssChunks.extract({\n                  use: {\n                    loader: 'css-loader',\n                    options: {\n                      modules: true,\n                      localIdentName: '[name]__[local]--[hash:base64:5]'\n                    }\n                  }\n                })\n              },\n              {\n                test: /\\.scss$/,\n                use: ExtractCssChunks.extract({\n                  use: [\n                    'css-loader?sourceMap',\n                    {\n                      loader: 'sass-loader?sourceMap',\n                      options: {\n                        importer: jsonImporter,\n                        modules: true,\n                        localIdentName: '[name]__[local]--[hash:base64:5]'\n                      }\n                    }\n                  ]\n                })\n              },\n            ]\n            :\n            [\n              {\n                test: /\\.css$/,\n                exclude: /node_modules/,\n                use: {\n                  loader: 'css-loader/locals',\n                  options: {\n                    modules: true,\n                    localIdentName: '[name]__[local]--[hash:base64:5]'\n                  }\n                }\n              },\n              {\n                test: /\\.scss$/,\n                exclude: /node_modules/,\n                use: [\n                  'css-loader?sourceMap',\n                  {\n                    loader: 'sass-loader?sourceMap',\n                    options: {\n                      importer: jsonImporter,\n                      modules: true,\n                      localIdentName: '[name]__[local]--[hash:base64:5]'\n                    }\n                  }\n                ]\n              }\n            ]\n          )\n          :\n          []\n        ),\n      ],\n    },\n    resolve: webpackConfigResolve.resolve,\n    plugins: [\n      ...(\n        isReact\n        ?\n        (\n          isClient\n          ?\n          [\n            (\n              isDev \n                ?\n                new WriteFilePlugin() // used so you can see what chunks are produced in dev\n                :\n                new StatsPlugin('stats.json')\n            ), \n            new ExtractCssChunks(),\n            new webpack.optimize.CommonsChunkPlugin({\n              names: ['bootstrap'], // needed to put webpack bootstrap code before chunks\n              filename: isDev ? '[name].js' : '[name].[chunkhash].js',\n              minChunks: Infinity\n            }),\n            ...(\n              isDev\n                ?\n                [\n                  new webpack.HotModuleReplacementPlugin(),\n                  new webpack.NoEmitOnErrorsPlugin(),\n                ]\n                :\n                []\n            ),\n            new webpack.DefinePlugin({\n              'process.env': {\n                NODE_ENV: JSON.stringify(isDev ? 'development' : 'production')\n              }\n            }),\n            ...(\n              !isDev\n                ?\n                [\n                  new webpack.optimize.UglifyJsPlugin({\n                    compress: {\n                      screw_ie8: true,\n                      warnings: false\n                    },\n                    mangle: {\n                      screw_ie8: true\n                    },\n                    output: {\n                      screw_ie8: true,\n                      comments: false\n                    },\n                    sourceMap: true\n                  }),\n                  new webpack.HashedModuleIdsPlugin(), // not needed for strategy to work (just good practice)\n                ]\n                :\n                []\n            ),\n            new AutoDllPlugin({\n              context: path.join(__xdirname, '..'),\n              filename: '[name].js',\n              entry: {\n                vendor: [\n                  'react',\n                  'react-dom',\n                  'react-redux',\n                  'redux',\n                  'history/createBrowserHistory',\n                  'transition-group',\n                  'redux-first-router',\n                  'redux-first-router-link',\n                  'fetch-everywhere',\n                  'babel-polyfill',\n                  'redux-devtools-extension/logOnlyInProduction'\n                ]\n              }\n            }),\n            makeProgressPlugin(),\n          ]\n          :\n          // IS SERVER\n          [\n            new webpack.BannerPlugin({\n              banner: 'require(\"source-map-support\").install();',\n              raw: true,\n              entryOnly: false,\n            }),\n            new webpack.optimize.LimitChunkCountPlugin({\n              maxChunks: 1\n            }),\n\n            new webpack.DefinePlugin({\n              'process.env': {\n                NODE_ENV: JSON.stringify(isDev ? 'development' : 'production')\n              }\n            }),\n            makeProgressPlugin(),\n          ]\n        )\n        :\n        [\n          // for node start\n          new webpack.BannerPlugin({\n            banner: 'require(\"source-map-support\").install();',\n            raw: true,\n            entryOnly: false,\n          }),\n          ...(\n            isCommandLine || isMocha || isBuild\n            ?\n            [\n              // I needed __xdirname hardcoded as the original dirname\n              // https://github.com/webpack/webpack/issues/1599#issuecomment-266588898\n              {\n                apply(compiler) {\n                  function setModuleConstant(expressionName, fn) {\n                    compiler.plugin('compilation', (compilation, data) => {\n                      data.normalModuleFactory.plugin('parser', (parser) => {\n                        parser.plugin(`expression ${expressionName}`, function compilerParserPlugin() {\n                          this.state.current.addVariable(expressionName, JSON.stringify(fn(this.state.module)));\n                          return true;\n                        });\n                      });\n                    });\n                  }\n\n                  setModuleConstant('__filename', (module) => {\n                    return module.resource;\n                  });\n\n                  setModuleConstant('__xdirname', (module) => {\n                    return module.context;\n                  });\n                },\n              },\n            ]\n            :\n            []\n          ),\n          makeProgressPlugin(),\n        ]\n      ),\n          \n      // for node end\n    ]\n  };\n\n  // fs.writeFileSync('./_webpack-config-preview.json', JSON.stringify(config, null, 2));\n  return config;\n}\n\nexport default generateConfigJson;\n\n\n\n// WEBPACK FOOTER //\n// ./webpackConfig.js","module.exports = require(\"fs-extra\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs-extra\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"child_process\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"child_process\"\n// module id = 6\n// module chunks = 0","/* eslint-disable no-console */\nimport webpack from 'webpack';\nimport { argv } from 'yargs';\nimport shellCommand from './core/shellCommand';\nimport jestSpawnProcess from './jest/jestSpawnProcess';\nimport webpackRunCompiler from './core/webpackRunCompiler';\nimport webpackBuildCommandLine from './core/webpackBuildCommandLine';\nimport serveUniversalExpress from './serveUniversalExpress.js';\nimport webpackConfig from './webpackConfig'; \n// import isWithinMonoRepo from './core/isWithinMonoRepo');\nconsole.log('__dirname packages/dev_env/dev_env.js',__dirname)\nconst env = argv.env;\nconst item = argv.item;\n\nif (item) {\n  shellCommand(`(cd ./packages/${item} && npm run start)`);\n} else if (env === 'test') {\n  jestSpawnProcess(argv.testdevenv, argv.watch, argv.testPathPattern);\n} else if (argv.entry) {\n  webpackBuildCommandLine();\n} else if (env === 'build') {\n  webpackRunCompiler(webpack(webpackConfig()));  \n} else {\n  serveUniversalExpress();\n}\n// export { serveUniversalExpress };\n\n\n// WEBPACK FOOTER //\n// ./dev_env.js","/* eslint-disable global-require */\nmodule.exports = (commandToRun, options = { stdio: 'inherit' }, killParentOnExit = true) => {\n  const command = 'sh';\n  const args = [\n    '-c',\n    // commandToRun.replace('node $TMPFILE','node --inspect=9223 $TMPFILE'),\n    commandToRun.replace('node $TMPFILE','node --trace-warnings $TMPFILE'),\n    // commandToRun,\n  ];\n  //\n  // kexec doesn't work in windows, so fallback to child_process.spawn\n  // this logic copied from babel-cli/lib/babel-node.js\n  // try {\n  //   const kexec = require('kexec');\n  //   kexec(command, args);\n  // } catch (err) {\n    // if (err.code !== 'MODULE_NOT_FOUND') throw err;\n\n  const childProcess = require('child_process');\n  const proc = childProcess.spawn(command, args, options || {});\n  proc.on('exit', (code, signal) => {\n    if (killParentOnExit) {\n      process.on('exit', () => {\n        if (signal) {\n          process.kill(process.pid, signal);\n        } else {\n          process.exit(code);\n        }\n      });\n    }\n  });\n  return proc;\n  // }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./core/shellCommand.js","/* eslint-disable camelcase */\nimport child_process from 'child_process';\nimport path from 'path';\n\n// import jestConfig from './jestConfig';\n// const config = `'${JSON.stringify(jestConfig).replace(/'/g, \"\\\\'\")}'`;\n\nconst configPath = `${__xdirname}/jestConfig.js`;\n// const configBasePath = `${__xdirname}/jestConfigBase.js`;\n// qwer();\n\nexport default (testdevenv, watch = true, testPathPattern) => {\n  const command = 'sh';\n  // Why `CI=true `? ----- https://github.com/facebook/jest/issues/2959\n  let commandBody = `CI=true ${process.cwd()}/node_modules/.bin/jest --watch=${watch && watch !== 'false' ? 'true' : 'false'} --config=${configPath}${testPathPattern ? [\" --testPathPattern='\",testPathPattern,\"'\"].join('') : ''}`;\n  if (testdevenv) {\n    // commandBody = `CI=true ${process.cwd()}/node_modules/.bin/jest -t testdevenv --config=${configBasePath}`;\n    // commandBody = `CI=true ${process.cwd()}/node_modules/.bin/jest ${__xdirname}/testdevenv.js  --config=${configBasePath}`;\n    commandBody = `CI=true ${process.cwd()}/node_modules/.bin/mocha-webpack --colors --require babel-core/register --webpack-config ${path.resolve(__xdirname, '../core/webpackConfigMocha.js')} \\\"${path.resolve(__xdirname, './testdevenv2.js')}\\\" --require source-map-support/register`;\n  }\n  const args = [\n    '-c',\n    commandBody,\n  ];\n  const proc = child_process.spawn(command, args, { stdio: 'inherit' });\n  proc.on('exit', (code, signal) => {\n    process.on('exit', () => {\n      if (signal) {\n        process.kill(process.pid, signal);\n      } else {\n        process.exit(code);\n      }\n    });\n  });\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jest/jestSpawnProcess.js","import webpack from 'webpack';\nimport webpackRunCompiler from './webpackRunCompiler';\nimport webpackConfig from '../webpackConfig';\n\nexport default () => {\n  webpackRunCompiler(webpack(webpackConfig({isCommandLine: true})));\n};\n\n\n\n// WEBPACK FOOTER //\n// ./core/webpackBuildCommandLine.js","module.exports = require(\"globby\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"globby\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"webpack-node-externals\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"webpack-node-externals\"\n// module id = 13\n// module chunks = 0","module.exports = require(\"find-node-modules\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"find-node-modules\"\n// module id = 14\n// module chunks = 0","module.exports = require(\"extract-css-chunks-webpack-plugin\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"extract-css-chunks-webpack-plugin\"\n// module id = 15\n// module chunks = 0","module.exports = require(\"autodll-webpack-plugin\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"autodll-webpack-plugin\"\n// module id = 16\n// module chunks = 0","module.exports = require(\"stats-webpack-plugin\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"stats-webpack-plugin\"\n// module id = 17\n// module chunks = 0","module.exports = require(\"webpack/lib/ProgressPlugin\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"webpack/lib/ProgressPlugin\"\n// module id = 18\n// module chunks = 0","module.exports = require(\"node-sass-json-importer\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"node-sass-json-importer\"\n// module id = 19\n// module chunks = 0","module.exports = require(\"write-file-webpack-plugin\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"write-file-webpack-plugin\"\n// module id = 20\n// module chunks = 0","const DirectoryNamedWebpackPlugin = require('directory-named-webpack-plugin');\nconst parseRequestResolvePlugin = require('./parseRequestResolvePlugin');\nconst path = require('path');\n\nvar basename = path.basename;\nvar inNodeModulesRE = /\\/node_modules\\/|\\\\node_modules\\\\/;\n\nfunction DirectoryDefaultFilePlugin() {\n  return {\n    apply(resolver) {\n      // I don't know why 'module' or 'resolve' are those values.\n      // Something to do with the the way they are used in this file:\n      // https://github.com/webpack/enhanced-resolve/blob/master/lib/ResolverFactory.js\n      // So they can be other values as seen in that file.\n      resolver.plugin('directory', function (req, done) {\n        // printProgress(`${request.request}`);\n        // console.log('request.request',request.request)\n        // const newRequestStr = parseRequest(req.request);\n        // if (newRequestStr && newRequestStr !== req.request) {\n        //   const obj = Object.assign({}, req, {\n        //     request: newRequestStr,\n        //   });\n        //   this.doResolve('resolve', obj, 'blah blah', done);\n        // } else {\n        //   // process.stdout.write(`\\n`);\n        //   done();\n        // }\n        \n\n        var directory = resolver.join(req.path, req.request);\n        if (directory.match(inNodeModulesRE)) {\n          return done();\n        }\n\n\n        resolver.fileSystem.stat(directory, function (err, stat) {\n          if (err || !stat || !stat.isDirectory()) {\n            return done();\n          }\n\n          var index = resolver.join(directory, 'index.js');          \n\n          resolver.fileSystem.stat(index, function (err, stat) {\n            // console.log('index',index);\n            \n            if (!err && stat && stat.isFile()) {\n              // ignore directories containing index.js files\n              return done();\n            }\n            // console.log(req)\n            // done();\n            // console.log('new request',resolver.join(directory, basename(directory)));\n            const obj = Object.assign({}, req, {\n              request: resolver.join(directory, basename(directory)),\n            });\n            resolver.doResolve('resolve', obj, 'blah blah', done);\n\n            // resolver.doResolve('file', {\n            //   path: req.path,\n            //   query: req.query,\n            //   request: resolver.join(directory, basename(directory))\n            // }, function (err, result) {\n            //   return done(undefined, result || undefined);\n            // });\n          });\n        });\n      });\n    },\n  };\n}\n\nmodule.exports = {\n  resolve: {\n    modules: [\n      // '/Users/brianephraim/Sites/monorepo/node_modules',\n      path.resolve('./src/library'),\n      path.resolve(process.cwd(), 'packages'),\n      path.resolve(process.cwd(), '../../packages'),\n      'node_modules',\n      // path.resolve(process.cwd(), '../monorepo/node_modules'),\n      // '../monorepo/node_modules',\n    ],\n    extensions: [\n      '.js',\n      '.css',\n\n      // Why is this here? : https://github.com/npm/normalize-package-data/issues/88\n      // Issue only appeard when webpack run on command line for Node bundle\n      '.json',\n    ],\n    plugins: [\n      parseRequestResolvePlugin((requestStr) => {\n        // console.log('requestStr', requestStr);\n        if (requestStr.indexOf('@') === 0 && requestStr.indexOf('/') !== -1) {\n          const split = requestStr.split('/');\n          split.shift();\n          split.join('/');\n          // console.log('Afindme',split.join('/'),requestStr.split('/')[1]);\n          // console.log('Bfindme',requestStr.split('/')[1]);\n          return split.join('/');\n          return requestStr.split('/')[1];\n        }\n        return false;\n      }),\n      new DirectoryDefaultFilePlugin(),\n      // new DirectoryNamedWebpackPlugin(true),\n    ],\n  },\n};\n\n\n\n// WEBPACK FOOTER //\n// ./core/webpack-config-resolve.js","module.exports = require(\"directory-named-webpack-plugin\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"directory-named-webpack-plugin\"\n// module id = 22\n// module chunks = 0","/* eslint-disable func-names */\nconst singleLineLog = require('single-line-log').stdout;\n\nfunction printProgress(progress) {\n  if (!process || !process.stdout || !process.stdout.clearLine) {\n    return;\n  }\n  singleLineLog(`Resolving: ${progress}\\n`);\n  // process.stdout.clearLine();\n  // process.stdout.cursorTo(0);\n  // process.stdout.write(progress + `-xxxxxx`);\n}\nfunction parseRequestResolvePlugin(parseRequest = () => {}) {\n  return {\n    apply(resolver) {\n      // I don't know why 'module' or 'resolve' are those values.\n      // Something to do with the the way they are used in this file:\n      // https://github.com/webpack/enhanced-resolve/blob/master/lib/ResolverFactory.js\n      // So they can be other values as seen in that file.\n      resolver.plugin(/* 'modules'*/ 'resolve', function (request, callback) {\n        // printProgress(`${request.request}`);\n        // console.log('request.request',request.request)\n        const newRequestStr = parseRequest(request.request);\n        if (newRequestStr && newRequestStr !== request.request) {\n          const obj = Object.assign({}, request, {\n            request: newRequestStr,\n          });\n          this.doResolve('resolve', obj, 'blah blah', callback);\n        } else {\n          // process.stdout.write(`\\n`);\n          callback();\n        }\n      });\n    },\n  };\n}\n\nmodule.exports = parseRequestResolvePlugin;\n\n\n\n// WEBPACK FOOTER //\n// ./core/parseRequestResolvePlugin.js","module.exports = require(\"single-line-log\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"single-line-log\"\n// module id = 24\n// module chunks = 0","import 'babel-polyfill'\nimport webpack from 'webpack'\nimport webpackDevMiddleware from 'webpack-dev-middleware'\n\nimport express from 'express'\nimport fs from 'fs-extra';\nimport _eval from 'eval';\nimport webpackHotMiddleware from 'webpack-hot-middleware'\nimport webpackHotServerMiddleware from 'webpack-hot-server-middleware'\nimport { argv } from 'yargs';\nimport path from 'path';\nimport deleteFiles from 'rimraf';\n// import universalWebpackConfig from './universal/webpack/universalWebpackConfig';\nimport webpackConfig from './webpackConfig';\nimport webpackRunCompiler from './core/webpackRunCompiler';\nimport webpackParseStatsForDepProblems from './webpackParseStatsForDepProblems';\n\n\n\nconst res = (p) => {\n  return path.resolve(typeof __xdirname !== 'undefined' ? __xdirname : __dirname, p)\n};\n\nexport default function startUniversal(app = express()) {\n\n  if (argv.isDev === 'true') {\n    // `npm run bern1` or `npm run bern2`\n    const clientDevConfig = webpackConfig({isReact:true,isClient:true,isDev:true,isUniversal:true,'xxx':116});\n    const serverDevConfig = webpackConfig({isReact:true,isClient:false,isDev:true,isUniversal:true,'xxx':115});\n    const serverNonUniversalConfig = webpackConfig({isReact:true,isClient:false,isDev:true,isUniversal:false,'xxx':114});\n    const publicPath = clientDevConfig.output.publicPath\n    const outputPath = clientDevConfig.output.path\n    const isUniversal = argv.isUniversal === 'true';\n    const multiCompiler = webpack([clientDevConfig, isUniversal ? serverDevConfig : serverNonUniversalConfig])\n    const clientCompiler = multiCompiler.compilers[0]\n    /* eslint-disable no-console */\n    console.info('ðŸ”· Starting webpack ...');\n    /* eslint-enable no-console */\n    clientCompiler.plugin('invalid', (fileName, changeTime) => {\n      /* eslint-disable no-console */\n      console.log('==== INVALIDATED ====')\n      console.log('stats', fs.statSync(fileName));\n      console.log(`FileName: ${fileName}`);\n      console.log(`ChangeTimex: ${changeTime}`);\n      /* eslint-enable no-console */\n    });\n    const activeWebpackDevMiddleware = webpackDevMiddleware(multiCompiler, {\n      publicPath,\n      stats: {\n        colors: true,\n      },\n    });\n    activeWebpackDevMiddleware.waitUntilValid((stats) => {\n      webpackParseStatsForDepProblems(stats);\n    });\n    app.use(activeWebpackDevMiddleware)\n    app.use(webpackHotMiddleware(clientCompiler))\n    app.use(\n      // keeps serverRender updated with arg: { clientStats, outputPath }\n      webpackHotServerMiddleware(multiCompiler, {\n        serverRendererOptions: { outputPath }\n      })\n    )\n  } else if (argv.isDeploy === 'true') {\n    // `npm run bern4`\n\n    // instead of `require` or `__non_webpack_require__` or `import (...)`\n    // using `fs.readFileSync` + `_eval`.\n    // why\n    // -  not `require` because we don't want to bundle what we are importing here\n    //    because what we are importing is itself a bundle\n    //    - which might not exist yet\n    //    - which will itself be ES5 safe\n    //    - which is itself huge so we don't want to bundle it here.\n    // -  `__non_webpack_require__` and `import (...)` don't work or too complicated.\n    const buildServerMainContent = fs.readFileSync(path.resolve(process.cwd(),'./packages/dev_env/universal/buildServer/main.js'));\n    const serverRender = _eval(buildServerMainContent,true).default;\n    const clientStats = fs.readJsonSync(path.resolve(process.cwd(),'./packages/dev_env/universal/buildClient/stats.json'));\n    const clientProdConfig = webpackConfig({isReact:true,isClient:true,isDev:false,isUniversal:true,'xxx':113});\n    const publicPath = clientProdConfig.output.publicPath\n    const outputPath = 'packages/dev_env/universal/buildClient';\n    app.use(publicPath, express.static(outputPath))\n    app.use(serverRender({ clientStats, outputPath }))    \n  } else {\n    // `npm run bern3`\n    const clientProdConfig = webpackConfig({isReact:true,isClient:true,isDev:false,isUniversal:true,'xxx':113});\n    const serverProdConfig = webpackConfig({isReact:true,isClient:false,isDev:false,isUniversal:true,'xxx':112});\n    deleteFiles(`{${clientProdConfig.output.path},${serverProdConfig.output.path}}`, () => {\n      const multiCompiler = webpack([clientProdConfig,serverProdConfig]);\n      webpackRunCompiler(multiCompiler).then(() => {\n        const publicPath = clientProdConfig.output.publicPath\n        const outputPath = clientProdConfig.output.path\n        const serverRender = __non_webpack_require__(res('./universal/buildServer/main.js')).default\n        const clientStats = __non_webpack_require__(res('./universal/buildClient/stats.json')) \n        app.use(publicPath, express.static(outputPath))\n        app.use(serverRender({ clientStats, outputPath }))\n      });\n    });\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./serveUniversalExpress.js","module.exports = require(\"babel-polyfill\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-polyfill\"\n// module id = 26\n// module chunks = 0","module.exports = require(\"webpack-dev-middleware\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"webpack-dev-middleware\"\n// module id = 27\n// module chunks = 0","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 28\n// module chunks = 0","module.exports = require(\"eval\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"eval\"\n// module id = 29\n// module chunks = 0","module.exports = require(\"webpack-hot-middleware\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"webpack-hot-middleware\"\n// module id = 30\n// module chunks = 0","module.exports = require(\"webpack-hot-server-middleware\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"webpack-hot-server-middleware\"\n// module id = 31\n// module chunks = 0","module.exports = require(\"rimraf\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"rimraf\"\n// module id = 32\n// module chunks = 0","/* eslint-disable no-console */\nimport fs from 'fs-extra';\nimport validateNpmPackageName from 'validate-npm-package-name';\n\nfunction ensureTrailingSlash(str) {\n  return str.replace(/\\/?$/, '/');\n}\n\nfunction ensureReadJsonSync(packageDotJsonPath) {\n  let packageDotJsonContent;\n  try {\n    packageDotJsonContent = fs.readJsonSync(packageDotJsonPath);\n  } catch (e) {\n    packageDotJsonContent = {};\n  }\n  return packageDotJsonContent;\n}\n\nfunction showProblemsInConsole(problems) {\n  if (Object.keys(problems).length) {\n    console.info('\\x1b[1m', '\\nProblems with dependencies', '\\x1b[0m');\n  }\n  Object.keys(problems).forEach((moduleResource) => {\n    console.info('\\x1b[36m', '\\nProblem in module with `import` statement:', '\\x1b[0m');\n    console.info('\\x1b[37m', ` ${moduleResource}`, '\\x1b[0m');\n    Object.keys(problems[moduleResource]).forEach((depName) => {\n      const problemMsg = problems[moduleResource][depName].msg;\n      console.info('\\x1b[33m', 'Dependency requested as:', '\\x1b[0m');\n      console.info('\\x1b[37m', ` ${depName}`, '\\x1b[0m');\n      console.info('\\x1b[33m', `Message: ${problemMsg}`, '\\x1b[0m');\n      const problemInfo = problems[moduleResource][depName].info;\n      if (problemInfo) {\n        console.info('\\x1b[37m', `- ${problemInfo.join('\\n - ')}`, '\\x1b[0m');\n      }\n    });\n  });\n}\n\nfunction findDependenciesProblems(dependencies, packageDotJsonContent) {\n  const problems = {};\n\n  dependencies.forEach((dep) => {\n    if (dep.module) {\n      const rawRequest = dep.module.rawRequest;\n      // if (rawRequest.indexOf('/Users/brianephraim/Sites/monorepo/packages') === 0) {\n      //   console.info('\\x1b[33m', 'depWTF', rawRequest, '\\x1b[0m');\n      //   console.log('depWTF', dep);\n      // } else {\n      //   console.info('\\x1b[33m', 'depGGG', rawRequest, '\\x1b[0m');\n      //   console.log('depGGG', dep);\n      // }\n\n      // not a relative dependency\n      // not an absolut dependency\n      // we are only concerned with depenencies referenced like\n      // `import asdf from 'asdf';`\n      // or\n      // `import qwer from 'asdf/qwer';``\n      // or\n      // `import asdf from '@defualt/asdf';``\n      // These dependencies will be either in /node_modules/ or /packages/,\n      // the latter for only monorepo use.\n      if (rawRequest && rawRequest.indexOf('.') !== 0 && rawRequest.indexOf('/') !== 0) {\n        const validationResult = validateNpmPackageName(rawRequest);\n        if (validationResult.validForNewPackages) {\n          if (\n            !packageDotJsonContent ||\n            (\n              (\n                !packageDotJsonContent.dependencies ||\n                !packageDotJsonContent.dependencies[rawRequest]\n              ) &&\n              (\n                !packageDotJsonContent.devDependencies ||\n                !packageDotJsonContent.devDependencies[rawRequest]\n              )\n            )\n          ) {\n            problems[rawRequest] = { msg: 'MISSING FROM PACKAGE.JSON' };\n          }\n        } else {\n          const info = [\n            ...validationResult.warnings || [], ...validationResult.errors || [],\n          ].filter((msg) => {\n            return msg !== 'name can only contain URL-friendly characters';\n          });\n          // console.log(validationResult);\n          if (info.length) {\n            problems[rawRequest] = {\n              msg: 'BAD FORMATTING',\n              info: [...validationResult.warnings || [], ...validationResult.errors || []],\n            };\n          }\n        }\n      }\n    }\n  });\n\n  return Object.keys(problems).length ? problems : null;\n}\n\nfunction webpackParseStatsForDepProblems(stats, shouldShowProblemsInConsole = true) {\n  const isMonorepo = fs.existsSync(`${process.cwd()}/packages`);\n\n  const packageDotJsonCache = {};\n  const problems = {};\n  const compilation = stats.compilation ? stats.compilation : stats.stats[0].compilation\n  compilation.modules.forEach((module) => {\n    // only concerned with module entries from /packages/ folder (not node_modules)\n    if (\n      module.resource &&\n      module.resource.indexOf('node_modules') === -1\n    ) {\n      let packageDotJsonPath;\n      if (isMonorepo) {\n        let packagesDir = `${process.cwd()}/packages`;\n        packagesDir = ensureTrailingSlash(packagesDir);\n        // get substring from first trailing slash after whatever packagesDir is\n        // console.log(module.resource);\n        const packageFolderName = module.resource.split(packagesDir)[1].split('/')[0];\n        packageDotJsonPath = `${packagesDir}${packageFolderName}/package.json`;\n      } else {\n        packageDotJsonPath = `${process.cwd()}/package.json`;\n      }\n\n      const packageDotJsonContent = (\n        packageDotJsonCache[packageDotJsonPath] || ensureReadJsonSync(packageDotJsonPath)\n      );\n      packageDotJsonCache[packageDotJsonPath] = packageDotJsonContent;\n\n      const packageSomehowPublic = (\n        !packageDotJsonContent.private ||\n        !packageDotJsonContent.privateFromGithub\n      );\n\n      // only concerned if module's package.json is not empty,\n      // and if it is public on either NPM or Girhub\n      if (Object.keys(packageDotJsonContent).length && packageSomehowPublic) {\n        const depProblems = findDependenciesProblems(module.dependencies, packageDotJsonContent);\n        if (depProblems) {\n          problems[module.resource] = depProblems;\n        }\n      }\n    }\n  });\n  if (Object.keys(problems).length > 0 && shouldShowProblemsInConsole) {\n    showProblemsInConsole(problems);\n  }\n\n  return problems;\n}\n\nexport default webpackParseStatsForDepProblems;\n\n\n\n// WEBPACK FOOTER //\n// ./webpackParseStatsForDepProblems.js","module.exports = require(\"validate-npm-package-name\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"validate-npm-package-name\"\n// module id = 34\n// module chunks = 0"],"sourceRoot":""}