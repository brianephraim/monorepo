{"version":3,"sources":["webpack:///../bernieserver/bernieserver.express.js","webpack:///../ensure-leading-slash/ensure-leading-slash.js","webpack:///../bernieserver/js/prepareModuleWithDefaults.js","webpack:///../bernieserver/js/respondWithJson.js","webpack:///../bernieserver/js/normalizeImageFileData.js","webpack:///../bernieserver/js/uploadToS3.js","webpack:///../make-serve-chainable-express/make-serve-chainable-express.js","webpack:///../bernieserver/js/getS3ObjectData.js","webpack:///../bernieserver/js/mongooseStuff.js","webpack:///../bernieserver/bernieExpressServer.js","webpack:///../bernieserver/js/apiRequestIntoBufferData.js","webpack:///../bernieserver/js/calcOverlayAndTemplateProcessingSettings.js","webpack:///../bernieserver/js/createCompositeBuffer.js","webpack:///../bernieserver/js/deleteS3Object.js","webpack:///../bernieserver/js/endpointCompositeImage.js","webpack:///../bernieserver/js/endpointGetNormalizedImageInfo.js","webpack:///../bernieserver/js/endpointGetS3SignedUploadUrl.js","webpack:///../bernieserver/js/endpointIframeUpload.js","webpack:///../bernieserver/js/generateUrlRegexNamespace.js","webpack:///../bernieserver/js/getAllS3Objects.js","webpack:///../bernieserver/js/urlToFileData.js","webpack:///../bernieserver/public/js/mymodule.js"],"names":["console","log","ensureLeadingSlash","str","replace","module","exports","fun","c","prepareModuleWithDefaults","Object","assign","parseSettings","r","Array","isArray","require","s","res","isSuccess","accessKeyId","secretAccessKey","status","statusCode","error","json","message","write","JSON","stringify","end","jD","sharp","parseUrl","parse","dfd","Deferred","buffer","Body","image","metadata","err","meta","reject","smallestDim","Math","min","width","height","largestDim","max","limit","multiplier","floor","resize","withoutEnlargement","rotate","toBuffer","outputBuffer","info","manipulatedImageFileData","Key","filename","ContentType","url","originalFilename","resolve","promise","aws","mime","extension","split","pop","lookup","config","update","s3","S3","s3Params","Bucket","ACL","putObject","data","uploadResponse","makeServeChainableExpress","serverLogic","app","port","nameSpace","appIsBrandNew","listen","getObject","output","resolveNullOn404","outputParser","mymoduleName","mongoose","uriUtil","mongooseStuff","MongooseStuff","self","mongodbUri","process","env","MONGOLAB_URI","ENVNAME","DATABASE_NAME","mongooseUri","formatMongoose","db","connection","models","SimpleImage","model","Schema","String","ComplexImage","Date","Number","UserTemplate","created","customTemplate","templateHeight","templateWidth","prototype","connect","readyState","options","server","socketOptions","keepAlive","connectTimeoutMS","replset","once","on","bind","checkUrl","idX","then","findOne","simpleimage","GetComplexImage","GetUserTemplatesAll","find","GetComplexImageAll","MakeUserTemplate","findOneAndUpdate","upsert","apply","arguments","UpdateComplexImage","newRecord","save","getImages","nuke","collection","drop","close","x","set","__dirname","engine","renderFile","use","static","join","AWS_ACCESS_KEY","AWS_SECRET_KEY","S3_BUCKET","get","req","render","pageName","urlInfo","deriveUrlInfo","userTemplates","buttonText","query","standardRouteHtmlHandler","urlToUse","pathname","offline","iframebutton","result","mymodule","getStandardModesRegex","images","urlPattern","post","body","send","payload","always","Busboy","filenameDfd","busboy","headers","bufferArray","filenamex","toResolve","fieldname","file","encoding","mimetype","push","Buffer","concat","pipe","cropSettings","userPhotoWidthHeight","cropWidth","cropHeight","cropTop","top","cropLeft","left","cropRight","cropBottom","rawWidth","rawHeight","rawRight","rawBottom","rawTop","rawLeft","extract","extend","right","bottom","completelyOutOfBound","calcOverlayAndTemplateProcessingSettings","overlaySettings","responses","templateFetchResponse","template","userPhotoFetchResponse","userPhoto","args","slice","call","imageProcessingSettings","background","flatten","jpeg","templateBuffer","userPhotoBuffer","overlayWith","deleteObjects","Delete","Objects","msg","parseClientCompositeImageUrl","pathnameSplit","splice","compositeS3Key","templateFilename","userImageAndScalePos","userImageFilename","scalePos","compositeImageInstructions","dict","retrySearchCriteria","Prefix","bufferData","setHeader","urlToFileData","uploadToS3","normalizeImageFileData","originalUrl","indexOf","host","length","now","deep","deleteS3Object","decodeURIComponent","image_url","mustBeSquare","must_be_square","respondWithJsonSuccess","respondWithJsonFail","promises","fileData","abs","failingSquare","uploadToS3Promise","userTemplateModel","when","file_name","secondToLast","s3_params","Expires","file_type","getSignedUrl","signed_request","next","apiRequestIntoBufferData","details","lastData","public_id","html","standardModes","pipedString","i","l","mode","regx","RegExp","getS3ObjectData","dfdMain","entryName","entry","entryDfd","fail","originalErr","retryBucket","params","listObjectsV2","Contents","done","isHttps","http","response","chunks","chunk","contentType","e","templateBaseUrl","rawImagePrefix","isNode","versions","node","featured","old","oldModes","a","isOldMode","toCompare","is","containsStardardModeCache","containsStardardMode","contains","DeriveUrlInfo","init","nameSpaceWithLeadingSlash","defaultPathname","slashSplit","coords","dims","y","format","customUrl","customUrlQueryString","makeCustomUrl","normalize","val","def","isNaN","round","doubleNormalize","prexisting","doubleNormalizeInterface","dest","defaults","name","settings","toLowerCase","toNormalize","rawImage","doStandardSquare","serialize","obj","prefix","whatever","p","hasOwnProperty","k","v","encodeURIComponent","userPhotoKey","customUrlSettings","generateTemplateImgListHtml","imgsHtml","offlineTemplates"],"mappings":"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","file":"0.js","sourcesContent":["console.log('BERNIE SERVER EXPRESS HERE!!!');\n\nimport serve from './bernieExpressServer';\n\nexport default serve;\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/bernieserver.express.js","function ensureLeadingSlash(str) {\n  return str.replace(/^\\/?/, '/');\n}\nexport default ensureLeadingSlash;\n\n\n\n// WEBPACK FOOTER //\n// ../ensure-leading-slash/ensure-leading-slash.js","module.exports = function(fun){\n  return function(c){\n    if(c.prepareModuleWithDefaults){\n      c = Object.assign({},c);\n      var parseSettings = null;\n      if(c.parseSettings){\n        parseSettings = c.parseSettings;\n        delete c.parseSettings;\n      }\n      delete c.prepareModuleWithDefaults;\n      return function(r){\n        if(typeof r === 'object' && !Array.isArray(r)){\n          r = Object.assign({},c,r);\n        }\n        \n        if(parseSettings){\n          r = parseSettings(r);\n        }\n        return fun(r);\n      };\n    } else {\n      return fun(c);\n    }\n  };\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/prepareModuleWithDefaults.js","var prepareModuleWithDefaults = require('./prepareModuleWithDefaults');\nmodule.exports = prepareModuleWithDefaults(function(s){\n\tvar res = s.res;\n\tvar isSuccess = typeof s.isSuccess === 'undefined' || !!s.isSuccess;\n\tdelete s.res;\n\tdelete s.isSuccess;\n\tdelete s.accessKeyId;\n\tdelete s.secretAccessKey;\n\tvar status = 200;//ok\n\tif(s.statusCode){\n\t\tstatus = s.statusCode;\n\t} else if(!isSuccess){\n\t\tstatus = 500;\n\t}\n\tstatus = status === 0 ? 500 : status;\n\t\n\tif(s.error){\n\t\t// res.write(s.error);\n\t\t// res.render('error', s.error);\n\t\tres.status(status).json({\n\t\t\tmessage:s.error.message,\n\t\t\terror:s.error.error\n\t\t})\n\t\t// res.json('error', {\n\t //        message: s.error.message,\n\t //        error: s.error\n\t //    });\n\t} else {\n\t\tres.status(status);\n\t\tres.write(JSON.stringify(s));\n\t}\n\t\n\tres.end();\n});\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/respondWithJson.js","var jD = require('jquery-deferred');\nvar sharp = require('sharp');\nvar prepareModuleWithDefaults = require('./prepareModuleWithDefaults');\nvar parseUrl = require('url').parse;\nmodule.exports = prepareModuleWithDefaults(function(s){\n  var dfd = jD.Deferred();\n  var buffer = s.Body;\n  var sharp = require('sharp');\n  var image = sharp(buffer);\n  image.metadata(function(err, meta){\n      if(err){\n        dfd.reject(err);\n      } else {\n        var smallestDim = Math.min(meta.width, meta.height);\n        var largestDim = Math.max(meta.width, meta.height);\n        var limit = 1200;\n\n        var multiplier = limit/smallestDim;\n        multiplier = multiplier < 1 ? multiplier : 1;\n        if(multiplier !== 1){\n          limit = Math.floor(largestDim * multiplier);\n          image.resize(limit,limit).max().withoutEnlargement()\n        }\n        image.rotate().toBuffer(function(err, outputBuffer, info) {\n          if(err){\n            dfd.reject(err);\n          } else {\n            var manipulatedImageFileData = {\n              Key: s.filename,\n              ContentType: 'image/png',\n              Body: outputBuffer,\n              width: info.width,\n              height: info.height,\n              url: s.url,\n              originalFilename: s.originalFilename\n            };\n          }\n          dfd.resolve(manipulatedImageFileData);\n        });\n      }\n  });\n  return dfd.promise();\n});\n\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/normalizeImageFileData.js","var jD = require('jquery-deferred');\nvar aws = require('aws-sdk');\nvar prepareModuleWithDefaults = require('./prepareModuleWithDefaults');\nmodule.exports = prepareModuleWithDefaults(function(s){\n  s = Object.assign({},s);\n  if(!s.ContentType){\n    var mime = require('mime-types');\n    var extension = s.Key.split('.').pop();\n    s.ContentType = mime.lookup(extension);\n  }\n  var dfd = jD.Deferred();\n\n  aws.config.update({accessKeyId: s.accessKeyId , secretAccessKey: s.secretAccessKey });\n  var s3 = new aws.S3(); \n  var s3Params = {\n      Bucket: s.Bucket,\n      Key: s.Key,\n      Body: s.Body,\n      ContentType: s.ContentType,\n      ACL: 'public-read'\n  };\n\n  s3.putObject(\n    s3Params,\n    function(err, data) {\n        if (err) {\n          dfd.reject(err);\n        } else {\n          s.uploadResponse = data;\n          dfd.resolve(s);\n        }\n    }\n  );\n  return dfd.promise();\n});\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/uploadToS3.js","import express from 'express';\n\nfunction makeServeChainableExpress(serverLogic) {\n  return ({app, port = 3000, nameSpace = ''}) => {\n    let appIsBrandNew = false;\n    if (!app) {\n      appIsBrandNew = true;\n      app = express();\n    }\n    // nameSpace = 'bernieserver';\n\n    serverLogic(app, nameSpace);\n    \n\n    if (appIsBrandNew) {\n      app.listen(port, (error) => {\n        if (error) {\n          console.error(error);\n        } else {\n          console.info(\n            '🌎 Listening on port %s. Open up http://localhost:%s/ in your browser.',\n            port,\n            port,\n          );\n        }\n      });\n    }\n\n    return app;\n  };\n}\n\nexport default makeServeChainableExpress;\n\n\n// WEBPACK FOOTER //\n// ../make-serve-chainable-express/make-serve-chainable-express.js","var jD = require('jquery-deferred');\nvar aws = require('aws-sdk');\nmodule.exports = function(s){\n  s = Object.assign({},s);\n  var dfd = jD.Deferred();\n  aws.config.update({accessKeyId: s.accessKeyId , secretAccessKey: s.secretAccessKey });\n  var s3 = new aws.S3(); \n  s3.getObject(\n    {\n        Bucket: s.Bucket,\n        Key: s.Key\n    },\n    function(err, data) {\n      var output;\n      if(err && err.statusCode === 404 && s.resolveNullOn404){\n        output = s.outputParser ? s.outputParser(null) : null;\n        dfd.resolve(output);\n      } else if (err){\n        dfd.reject(err);\n      } else {\n        output = s.outputParser ? s.outputParser(data) : data;\n        dfd.resolve(output);\n      }\n    }\n  );\n  return dfd.promise();\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/getS3ObjectData.js",";\nvar mymoduleName = 'mongooseStuff';;\n(function(exports) {\n\n    var jD = require('jquery-deferred');\n\n\n    var mongoose = require('mongoose');\n    var uriUtil = require('mongodb-uri');\n\n    var mongooseStuff = (function() {\n        var MongooseStuff = function() {\n            var self = this;\n            var mongodbUri = process.env.MONGOLAB_URI;\n            if(process.env.ENVNAME === 'foremanLocal'){\n                mongodbUri = \"mongodb://localhost:27017/\"+process.env.DATABASE_NAME;\n            }\n            \n            this.mongooseUri = uriUtil.formatMongoose(mongodbUri);\n            this.db = mongoose.connection;\n            this.models = {};\n            self.models.SimpleImage = mongoose.model('simpleimage', mongoose.Schema({\n                \"url\": String,\n                \"idX\": String,\n                // \"date\": {\n                //     type: Date,\n                //     default: Date.now\n                // },\n                // \"width\": Number,\n                // \"height\": Number,\n            }));\n\n            self.models.ComplexImage = mongoose.model('ComplexImage', mongoose.Schema({\n                \"url\": String,\n                \"idX\": String,\n                \"date\":Date,\n                \"width\":Number,\n                \"height\":Number,\n                \"cropWidth\":Number,\n                \"cropHeight\":Number,\n                \"x\":Number,\n                \"y\":Number,\n                \"mode\":String,\n                \"customTemplate\":String,\n                \"idX\":String,\n                \"customUrl\":String,\n                \"pathname\":String,\n                \"good\":Number\n                // \"date\": {\n                //     type: Date,\n                //     default: Date.now\n                // },\n                // \"width\": Number,\n                // \"height\": Number,\n            }));\n\n            self.models.UserTemplate = mongoose.model('UserTemplate', mongoose.Schema({\n\t\t\t\tcreated: Date,\n\t\t\t\tcustomTemplate:String,\n\t\t\t\ttemplateHeight: Number,\n\t\t\t\ttemplateWidth:Number\n            }));\n        };\n        MongooseStuff.prototype.connect = function() {\n            var self = this;\n            var dfd = jD.Deferred();\n            if (mongoose.connection.readyState === 0) {\n                var options = {\n                    server: {\n                        socketOptions: {\n                            keepAlive: 1,\n                            connectTimeoutMS: 30000\n                        }\n                    },\n                    replset: {\n                        socketOptions: {\n                            keepAlive: 1,\n                            connectTimeoutMS: 30000\n                        }\n                    }\n                };\n                mongoose.connect(self.mongooseUri, options);\n                self.db.once('open', dfd.resolve);\n                self.db.on('error', console.error.bind(console, 'connection error:'));\n\n            } else {\n                dfd.resolve();\n            }\n\n            return dfd.promise();\n        };\n\n        MongooseStuff.prototype.checkUrl = function(idX) {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n                self.models.SimpleImage.findOne({\n                    'idX': idX\n                }, 'url idX', function(err, simpleimage) {\n\n                    if (simpleimage !== null) {\n                        dfd.resolve(true)\n                    } else {\n                        dfd.resolve(false)\n                    }\n\n                    // if (err) return handleError(err);\n                    // console.log('%s %s is a %s.', person.name.first, person.name.last, person.occupation) // Space Ghost is a talk show host.\n                })\n            });\n            return dfd.promise();\n        };\n\n        MongooseStuff.prototype.GetComplexImage = function(idX) {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n                self.models.ComplexImage.findOne({\n                    'idX': idX\n                }, function(err, data) {\n\n                    if (data !== null) {\n                        dfd.resolve(data)\n                    } else {\n                        dfd.resolve(data)\n                    }\n\n                    // if (err) return handleError(err);\n                    // console.log('%s %s is a %s.', person.name.first, person.name.last, person.occupation) // Space Ghost is a talk show host.\n                })\n            });\n            return dfd.promise();\n        };\n\n        MongooseStuff.prototype.GetUserTemplatesAll = function() {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n                self.models.UserTemplate.find({\n                }, function(err, data) {\n\n                    if (data !== null) {\n                        dfd.resolve(data)\n                    } else {\n                        dfd.resolve(data)\n                    }\n\n                    // if (err) return handleError(err);\n                    // console.log('%s %s is a %s.', person.name.first, person.name.last, person.occupation) // Space Ghost is a talk show host.\n                })\n            });\n            return dfd.promise();\n        };\n\n        MongooseStuff.prototype.GetComplexImageAll = function() {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n                self.models.ComplexImage.find({\n                }, function(err, data) {\n\n                    if (data !== null) {\n                        dfd.resolve(data)\n                    } else {\n                        dfd.resolve(data)\n                    }\n\n                    // if (err) return handleError(err);\n                    // console.log('%s %s is a %s.', person.name.first, person.name.last, person.occupation) // Space Ghost is a talk show host.\n                })\n            });\n            return dfd.promise();\n        };\n\n        \n        MongooseStuff.prototype.MakeUserTemplate = function(data) {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n            \tself.models.UserTemplate.findOneAndUpdate( { customTemplate : data.customTemplate },data,{ upsert : true }, function(){\n            \t\tdfd.resolve.apply(null, arguments);\n            \t});\n            });\n            return dfd.promise();\n        };\n\n\n        MongooseStuff.prototype.UpdateComplexImage = function(data) {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n            \tself.models.ComplexImage.findOneAndUpdate( { idX : data.idX },data,{ upsert : true }, function(){\n            \t\tdfd.resolve.apply(null, arguments);\n            \t});\n            });\n            return dfd.promise();\n        };\n\n        MongooseStuff.prototype.ComplexImage = function(data) {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n                var newRecord = new self.models.ComplexImage(data);\n\n                newRecord.save(function() {\n                    dfd.resolve.apply(null, arguments);\n                })\n            });\n            return dfd.promise();\n        };\n\n        MongooseStuff.prototype.simpleimage = function(url, idX) {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n                var newRecord = new self.models.SimpleImage({\n                    url: url,\n                    idX: idX\n                });\n\n                newRecord.save(function() {\n                    dfd.resolve.apply(null, arguments);\n                })\n            });\n            return dfd.promise();\n        };\n\n        MongooseStuff.prototype.getImages = function(url, idX) {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n                self.models.SimpleImage.find({}, 'url idX', function(err, simpleimage) {\n                    dfd.resolve(simpleimage);\n                })\n            });\n            return dfd.promise();\n        };\n\n        MongooseStuff.prototype.nuke = function() {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n                mongoose.connection.db.collection('usertemplates').drop(function(err) {//compleximages\n                    if (err) throw err;\n\n                    // Only close the connection when your app is terminating\n                    mongoose.connection.db.close(function(err) {\n                        dfd.resolve();\n                        if (err) throw err;\n                    });\n                });\n                return dfd.promise();\n            });\n        };\n\n\n\n        return new MongooseStuff();\n    })();\n\n\n    exports.x = mongooseStuff;\n\n\t// mongooseStuff.nuke();\n\n\t// mongooseStuff.connect().then(function(){\n\t// \tmongoose.connection.db.listCollections().toArray(function(err, names) {\n\t// \t    if (err) {\n\t// \t        console.log(err);\n\t// \t    }\n\t// \t    else {\n\t// \t        names.forEach(function(e,i,a) {\n\t// \t            mongoose.connection.db.dropCollection(e.name);\n\t// \t            console.log(\"collection --->>\", e.name);\n\t// \t        });\n\t// \t    }\n\t// \t});\n //    });\n\n\n})(typeof exports === 'undefined' ? this[mymoduleName] = {} : exports);\n\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/mongooseStuff.js","console.log('APP.js');\nimport mymodule from './public/js/mymodule';\nimport express from 'express';\nimport ejs from 'ejs';\nimport path from 'path';\nimport url from 'url';\nimport fs from 'fs';\nimport { x as mongooseStuff } from './js/mongooseStuff';\nimport endpointCompositeImage from './js/endpointCompositeImage';\nimport endpointGetNormalizedImageInfo from './js/endpointGetNormalizedImageInfo';\nimport endpointGetS3SignedUploadUrl from './js/endpointGetS3SignedUploadUrl';\nimport endpointIframeUpload from './js/endpointIframeUpload';\nimport generateUrlRegexNamespace from './js/generateUrlRegexNamespace';\nimport respondWithJson from './js/respondWithJson';\nimport ensureLeadingSlash from '@defualt/ensure-leading-slash';\nimport makeServeChainableExpress from '@defualt/make-serve-chainable-express';\n// var mymodule = require('./public/js/mymodule');\n// var express = require('express');\n// var ejs = require('ejs');\n// var path = require('path');\n// var url = require('url');\n// var mongooseStuff = require('./js/mongooseStuff').x;\n// var endpointCompositeImage = require('./js/endpointCompositeImage');\n\n// var endpointGetNormalizedImageInfo = require('./js/endpointGetNormalizedImageInfo');\n\n// var endpointGetS3SignedUploadUrl = require('./js/endpointGetS3SignedUploadUrl');\n\n// var endpointIframeUpload = require('./js/endpointIframeUpload');\n// var fs = require('fs');\n\n/*\n * Set-up the Express app.\n */\n\nexport default makeServeChainableExpress((app, nameSpace) => {\n  app.set('views', __dirname + '/views');\n  app.engine('html', ejs.renderFile);\n\n  app.use(express.static(path.join(__dirname, 'public')));\n\n  /*\n   * Load the S3 information from the environment variables.\n   */\n  var AWS_ACCESS_KEY = process.env.AWS_ACCESS_KEY;\n  var AWS_SECRET_KEY = process.env.AWS_SECRET_KEY;\n  var S3_BUCKET = process.env.S3_BUCKET\n\n  //===========================\n  //HTML PAGES\n  //____________________________\n\n  app.get(ensureLeadingSlash(`${nameSpace}/privacy`), function(req, res){\n      res.render('privacy.html',{\n          pageName:'privacy',\n          urlInfo:mymodule.deriveUrlInfo({nameSpace}),\n          userTemplates:userTemplates\n      });\n  });\n\n  app.get(ensureLeadingSlash(`${nameSpace}/terms`), function(req, res){\n      res.render('terms.html',{\n          pageName:'terms',\n          urlInfo:mymodule.deriveUrlInfo({nameSpace}),\n          userTemplates:userTemplates\n      });\n  });\n\n  app.get(ensureLeadingSlash(`${nameSpace}/iframeuploadbutton`), function(req, res){\n      res.render('iframeuploadbutton.html',{\n          pageName:'iframeuploadbutton',\n          urlInfo:null,\n          buttonText:req.query.buttonText\n      });\n  });\n\n\n\n  var standardRouteHtmlHandler = function(req, res){\n    var urlToUse = req.url;  \n    urlToUse = url.parse(urlToUse).pathname === '/' ? null : urlToUse;\n    var offline = typeof req.query.offline !== 'undefined';\n    var iframebutton = typeof req.query.iframebutton !== 'undefined';\n    var urlInfo = mymodule.deriveUrlInfo({pathname: urlToUse,offline,nameSpace});\n    \n    mongooseStuff.UpdateComplexImage(urlInfo).then(function(result){});\n\n    res.render('redesign'+'.html',{\n        userTemplates:userTemplates,\n        req:req,\n        urlInfo:urlInfo,\n        mymodule:mymodule,\n        offline:offline,\n        iframebutton:iframebutton\n        // pretty:stringify(req, null, 2)\n    });\n  };\n  app.get(mymodule.getStandardModesRegex(nameSpace), standardRouteHtmlHandler);\n\n  app.get(ensureLeadingSlash(`${nameSpace}/`), standardRouteHtmlHandler);\n\n  app.get(ensureLeadingSlash(`${nameSpace}/redesign`), standardRouteHtmlHandler);\n\n\n\n  app.get(ensureLeadingSlash(`${nameSpace}/list`), function(req, res){\n      var offline = typeof req.query.offline !== 'undefined';\n      mongooseStuff.GetComplexImageAll().then(function(images){\n      // mongooseStuff.getImages().then(function(images){\n        res.render('list.html', { \n            images:images,\n            offline:offline\n        });\n      });\n  });\n\n\n  var userTemplates = []; \n  //===========================\n  //ENDPOINTS\n  //____________________________\n\n  endpointCompositeImage({\n    app:app,\n    accessKeyId:AWS_ACCESS_KEY,\n    secretAccessKey:AWS_SECRET_KEY,\n    Bucket: S3_BUCKET,\n    urlPattern: generateUrlRegexNamespace('image\\/')\n  });\n\n  endpointGetNormalizedImageInfo({\n    app:app,\n    accessKeyId:AWS_ACCESS_KEY,\n    secretAccessKey:AWS_SECRET_KEY,\n    Bucket: S3_BUCKET,\n    userTemplates:userTemplates,\n    urlPattern: ensureLeadingSlash(`${nameSpace}/get_normalized_image_info`)\n  });\n  endpointGetS3SignedUploadUrl({\n    app:app,\n    accessKeyId:AWS_ACCESS_KEY,\n    secretAccessKey:AWS_SECRET_KEY,\n    Bucket: S3_BUCKET,\n    urlPattern: ensureLeadingSlash(`${nameSpace}/get_s3_signed_upload_url`)\n  });\n\n  endpointIframeUpload({\n    app:app,\n    accessKeyId:AWS_ACCESS_KEY,\n    secretAccessKey:AWS_SECRET_KEY,\n    Bucket: S3_BUCKET,\n    urlPattern: ensureLeadingSlash(`${nameSpace}/uploadsimple`)\n  });\n\n  app.get(ensureLeadingSlash(`${nameSpace}/get_template_list`), (req, res) => {\n    console.log('req',req)\n    console.log('get_template_list',userTemplates)\n    respondWithJson({\n      res,\n      userTemplates,\n    });\n  });\n\n\n\n\n  // require('./js/passportStuff')({\n  //   app:app\n  // });\n  // app.listen(3000);\n\n\n\n\n\n\n\n\n\n\n  app.post(ensureLeadingSlash(`${nameSpace}/SimpleImage`),function(req, res){\n    var data = req.body;\n    mongooseStuff.simpleimage(data.url, data.idX).then(function() {\n      res.send({\n          status:\"success\"\n      })\n    })\n  })\n\n  app.post(ensureLeadingSlash(`${nameSpace}/ComplexImage`), function(req, res){\n      var data = req.body;\n\n      mongooseStuff.ComplexImage(data).then(function(result){\n        res.send({\n            status:\"success\",\n            result:result,\n            payload:data\n        })\n      });\n  });\n\n  app.post(ensureLeadingSlash(`${nameSpace}/GetComplexImage`), function(req, res){\n      var data = req.body.data;\n      mongooseStuff.GetComplexImage('asdf').then(function(result){\n        res.send({\n            status:\"success\",\n            result:result\n        })\n      });\n  });\n\n  app.post(ensureLeadingSlash(`${nameSpace}/UpdateComplexImage`), function(req, res){\n      var data = req.body;\n      mongooseStuff.UpdateComplexImage(data).then(function(result){\n        res.send({\n            status:\"success\",\n            result:result\n        })\n      });\n  });\n\n\n\n\n  // GetComplexImage\n  // mongooseStuff.ComplexImage({url:'asdf'}).always(function(arguments){\n  //    console.log('ComplexImage',arguments)\n  //  })\n\n  // mongooseStuff.GetComplexImageAll().always(function(arguments){\n  //   console.log('ComplexImage',arguments)\n  // })\n   \n  mongooseStuff.GetUserTemplatesAll().always(function(data){\n    // console.log('GetUserTemplatesAll',data);\n    userTemplates = data;\n    // console.log('userTemplates',userTemplates)\n  })\n\n  return app;\n});\n\n\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/bernieExpressServer.js","var jD = require('jquery-deferred');\nvar prepareModuleWithDefaults = require('./prepareModuleWithDefaults');\nvar Busboy = require('busboy');\n\nmodule.exports = prepareModuleWithDefaults(function(req){\n  var dfd = jD.Deferred();\n\n  var filenameDfd = jD.Deferred();\n  var busboy = new Busboy({ headers: req.headers });\n  var busboy = new Busboy({ headers: req.headers });\n  var bufferArray = [];\n  var filenamex;\n  var toResolve = {\n    Body: []\n  };\n  busboy.on('file', function(fieldname, file, filename, encoding, mimetype) {\n    // console.log('File [' + fieldname + ']: filename: ' + filename + ', encoding: ' + encoding + ', mimetype: ' + mimetype);\n    toResolve.filename = filename;\n\n    file.on('data', function(data) {\n      // console.log('File [' + fieldname + '] got ' + data.length + ' bytes',data);\n      toResolve.Body.push(data);\n\n    });\n    // file.on('end', function() {\n    //   console.log('File [' + fieldname + '] Finished');\n    // });\n  });\n  // busboy.on('field', function(fieldname, val, fieldnameTruncated, valTruncated, encoding, mimetype) {\n  //   console.log('Field [' + fieldname + ']: value: ' + inspect(val));\n  // });\n  busboy.on('finish', function() {\n    toResolve.Body = Buffer.concat(toResolve.Body);\n    // console.log('Done parsing form!',Body);\n    dfd.resolve(toResolve);\n  });\n  req.pipe(busboy);\n  \n  return dfd.promise();\n\n  /*\n  var data = [];\n  req.on('data', function(chunk) {\n      data.push(chunk);\n  });\n  var endDfd = jD.Deferred();\n  req.on('end', function(x) {\n    console.log('end')\n    console.log(data)\n      var Body = Buffer.concat(data);\n      // console.log(Body)\n      endDfd.resolve({\n        body: data\n      });\n  });\n  req.on('error', function(err) {\n      endDfd.reject(err);\n  });\n  */\n});\n\n\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/apiRequestIntoBufferData.js","module.exports = function(cropSettings,userPhotoWidthHeight){\n  var limit = 1200;\n  // var scale = overlaySettings.scale;\n  var cropWidth = cropSettings.width;\n  var cropHeight = cropSettings.height;\n  var cropTop = cropSettings.top;\n  var cropLeft = cropSettings.left;\n  var cropRight = cropLeft + cropWidth;\n  var cropBottom = cropTop + cropHeight;\n  var rawWidth = userPhotoWidthHeight.width;\n  var rawHeight = userPhotoWidthHeight.height;\n  var rawRight = rawWidth;\n  var rawBottom = rawHeight;\n  var rawTop = 0;\n  var rawLeft = 0;\n\n  var s = {};\n\n  \n  s.extract = {\n    left: cropLeft > 0 ? cropLeft : 0,\n    top: cropTop > 0 ? cropTop : 0,\n  };\n  s.extract.width = cropRight < rawRight ? cropRight : rawRight;\n  s.extract.width =  s.extract.width - s.extract.left;\n  s.extract.width = s.extract.width > 0 ? s.extract.width : 0;\n  s.extract.height = cropBottom < rawBottom ? cropBottom : rawBottom;\n  s.extract.height =  s.extract.height - s.extract.top;\n  s.extract.height = s.extract.height > 0 ? s.extract.height : 0;\n\n\n\n  s.extend = {\n    left: cropLeft < 0 ? -cropLeft : 0,\n    top: cropTop < 0 ? -cropTop : 0,\n    right: cropRight > rawRight ? cropRight - rawRight : 0,\n    bottom: cropBottom > rawBottom ? cropBottom - rawBottom : 0\n  };\n  \n  s.resize = {\n    width:1200,\n    height:1200\n  }\n\n  s.completelyOutOfBound = false;\n  if(\n    (\n      s.extract.left >= rawRight ||\n      s.extract.top >= rawBottom ||\n      s.extend.left >= cropWidth ||\n      s.extend.top >= cropHeight\n    )\n  ){\n    s.completelyOutOfBound = true;\n  }\n  s.extract = s.extract.width && s.extract.height ? s.extract : null;\n  s.extend = s.extend.left || s.extend.top || s.extend.bottom || s.extend.right ? s.extend : null;\n  s.limit = limit;\n  return s;\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/calcOverlayAndTemplateProcessingSettings.js","var sharp = require('sharp');\nvar jD = require('jquery-deferred');\nvar calcOverlayAndTemplateProcessingSettings = require('./calcOverlayAndTemplateProcessingSettings');\nmodule.exports = function(overlaySettings,responses){\n  var dfd = jD.Deferred();\n  var templateFetchResponse = responses.template;\n  var userPhotoFetchResponse = responses.userPhoto;\n  var args = Array.prototype.slice.call(arguments);  \n  var userPhoto = sharp(userPhotoFetchResponse.data.Body);\n  userPhoto.metadata().then(function(metadata) {\n    var imageProcessingSettings = calcOverlayAndTemplateProcessingSettings(overlaySettings,metadata);\n    var s = imageProcessingSettings;\n    if(s.completelyOutOfBound){\n      var template = sharp(templateFetchResponse.data.Body);\n      template.resize(s.limit, s.limit).min().max();\n      template.background('white').flatten().jpeg().toBuffer().then(function(templateBuffer){\n        dfd.resolve({\n          Body: templateBuffer,\n        });\n      });\n    } else {\n      if(s.extract){\n        userPhoto.extract(s.extract);\n      }\n      if(s.extend){\n        userPhoto.extend(s.extend);\n      }\n\n      userPhoto.background('white').flatten().toBuffer().then(function(userPhotoBuffer){\n        var userPhoto = sharp(userPhotoBuffer);\n        userPhoto.resize(1200,1200);\n        var template = sharp(templateFetchResponse.data.Body);\n        template.resize(1200, 1200).min().max();\n        template.toBuffer().then(function(templateBuffer){\n          userPhoto.overlayWith(templateBuffer, {\n            top: 0,\n            left: 0\n          });\n          userPhoto.jpeg().toBuffer().then(function(userPhotoBuffer){\n            dfd.resolve({\n              Body: userPhotoBuffer,\n            });\n          });\n        });\n      })       \n    }    \n    return userPhoto\n  });\n  return dfd.promise();\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/createCompositeBuffer.js","var jD = require('jquery-deferred');\nvar aws = require('aws-sdk');\nvar prepareModuleWithDefaults = require('./prepareModuleWithDefaults');\n\n\n\nmodule.exports = prepareModuleWithDefaults(function(s){\n  var dfd = jD.Deferred();\n  s = Object.assign({},s);\n  aws.config.update({accessKeyId: s.accessKeyId , secretAccessKey: s.secretAccessKey });\n  var s3 = new aws.S3();\n  \n  //toPass.uploadRequestSettings.originalFilename\n  if(s.Key){\n    s3.deleteObjects(\n      {\n        Bucket: s.Bucket,\n        Delete: {\n            Objects: [\n                 { Key: s.Key }\n            ]\n        }\n      }, function(err, data) {\n          if (err){\n            dfd.reject(err);\n          } else {\n            dfd.resolve(data);\n          }\n      }\n    );\n  } else {\n    console.log('NOTHING TO DELETE');\n    dfd.resolve({msg:'Missing key, nothing deleted.'});\n  }\n  return dfd.promise();\n});\n\n\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/deleteS3Object.js","import aws from 'aws-sdk';\nimport {parse as parseUrl} from 'url';\nimport ensureLeadingSlash from '@defualt/ensure-leading-slash';\nimport getAllS3Objects from './getAllS3Objects';\nimport getS3ObjectData from './getS3ObjectData';\nimport createCompositeBuffer from './createCompositeBuffer';\n\nvar parseClientCompositeImageUrl = function(url){\n  var pathnameSplit = parseUrl(url).pathname.split('/').splice(2,2);\n  var compositeS3Key = 'consolidated/' + pathnameSplit.join('/');\n  var templateFilename = pathnameSplit[0];\n  var userImageAndScalePos = pathnameSplit[1];\n  userImageAndScalePos = userImageAndScalePos.split('_');\n  var userImageFilename = userImageAndScalePos;\n  var scalePos = userImageFilename.splice(-4,4);\n  scalePos[3] = scalePos[3].split('.');\n  scalePos[3].pop();\n  scalePos[3] = scalePos[3].join('.');\n  var overlaySettings = {\n    width: +scalePos[0] == scalePos[0] ? +scalePos[0] : 100,\n    height: +scalePos[1] == scalePos[1] ? +scalePos[1] : 100,\n    left: +scalePos[2] == scalePos[2]? +scalePos[2] : 0,\n    top: +scalePos[3] == scalePos[3]? +scalePos[3] : 0,\n  };\n  userImageFilename = userImageFilename.join('_');\n  return {\n    userImageFilename: userImageFilename,\n    templateFilename: templateFilename,\n    overlaySettings: overlaySettings,\n    compositeS3Key:compositeS3Key\n  };\n};\nexport default ({app,accessKeyId,secretAccessKey,Bucket,urlPattern}) => {\n  app.get(urlPattern, function(req, res) {\n    var compositeImageInstructions = parseClientCompositeImageUrl(req.url);\n    var s = compositeImageInstructions;\n    getS3ObjectData({\n      Key:s.compositeS3Key,\n      resolveNullOn404:true,\n      accessKeyId:accessKeyId,\n      secretAccessKey:secretAccessKey,\n      Bucket: Bucket\n    }).then(function(data){\n      if(!data){\n        console.log('COMPOSITE IMAGE DOES NOT EXIST');\n        \n        getAllS3Objects({\n          dict:{\n            template:{\n              Key:'decorations/' + s.templateFilename + '.png'\n            },\n            userPhoto:{\n              Key:'selfies/' + s.userImageFilename + '.png',\n              retrySearchCriteria:{\n                Prefix:'res/dthvwwocq/image/upload/bernie/'+s.userImageFilename,\n                Bucket: 'cloudinary-bernie-backup'\n              }\n            }\n          },\n          Bucket:Bucket,\n          accessKeyId: accessKeyId,\n          secretAccessKey: secretAccessKey\n        })\n        .then(createCompositeBuffer.bind(null,s.overlaySettings))\n        .then(function(bufferData){\n          res.setHeader('content-type', 'image/jpeg');\n          res.write(bufferData.Body,'binary');\n          res.end(null, 'binary');\n\n          aws.config.update({accessKeyId: accessKeyId , secretAccessKey: secretAccessKey });\n          var s3 = new aws.S3(); \n          s3.putObject(\n            {\n                Bucket: Bucket,\n                Key: s.compositeS3Key,\n                Body: bufferData.Body,\n                ContentType: 'image/jpeg',\n                ACL: 'public-read'\n            },\n            function(err, data) {\n                if (err) {\n                    // Failed saving to S3\n                    log.error('Failed saving to S3', err);\n                }\n            }\n          );\n        });\n      } else {\n        console.log('COMPOSITE IMAGE DOES IN FACT EXIST !!!!');\n        res.setHeader('content-type', data.ContentType);\n        res.write(data.Body,'binary');\n        res.end(null, 'binary');\n      }\n    });\n  });\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/endpointCompositeImage.js","/*\n * Respond to GET requests to /get_normalized_image_info.\n * changes size of image if it is too big\n * also rotates exif\n * responds with a new image url\n*/\nimport aws from 'aws-sdk';\nimport jD from 'jquery-deferred';\nimport { x as mongooseStuff } from './mongooseStuff';\n\nexport default ({accessKeyId,secretAccessKey,Bucket,app,userTemplates, urlPattern}) => {\n  var urlToFileData = require('./urlToFileData');\n  var uploadToS3 = require('./uploadToS3')({\n    prepareModuleWithDefaults: true,\n    accessKeyId:accessKeyId,\n    secretAccessKey:secretAccessKey,\n    Bucket:Bucket\n  });\n\n  var parseUrl = require('url').parse;\n\n  var normalizeImageFileData = require('./normalizeImageFileData')({\n    prepareModuleWithDefaults: true,\n    parseSettings: function(s){\n      var filename;\n      var originalFilename;\n      var url;\n      if(s.originalUrl.indexOf('amazonaws.com/') !== -1){\n        var host = s.originalUrl.split('amazonaws.com/');\n        host = host[0] + 'amazonaws.com/';\n        filename = s.originalUrl.split('amazonaws.com/');\n        originalFilename = filename[filename.length - 1];\n        filename = originalFilename.replace('_temp','');\n        filename = filename.split('.');\n        filename = filename[filename.length - 2];\n        filename = filename + '.png';\n        url = host + filename;\n      } else {\n        filename = parseUrl(s.originalUrl).pathname.split('/');\n        filename = filename[filename.length - 1];\n        filename = filename.split('.');\n        filename.pop();\n        filename = filename.join('.');\n        filename = filename + Date.now() + '.png';\n        filename = 'selfies/' + filename;\n        originalFilename = null;\n        url = '//s3-us-west-1.amazonaws.com/bernieapp/' + filename;\n      }\n      s.filename = filename;\n      s.url = url;\n      s.originalFilename = originalFilename;\n      return s;\n    }\n  });\n  var deep = require('deep-get-set');\n  var deleteS3Object = require('./deleteS3Object')({\n    prepareModuleWithDefaults: true,\n    parseSettings: function(s){\n      s.Key = deep(s,'originalFilename');\n      return s;\n    },\n    accessKeyId: accessKeyId,\n    secretAccessKey: secretAccessKey,\n    Bucket: Bucket\n  });\n\n  app.get(urlPattern, function(req, res){  \n    var originalUrl = decodeURIComponent(req.query.image_url);\n    var mustBeSquare = req.query.must_be_square === 'true';\n\n    var respondWithJsonSuccess = require('./respondWithJson')({\n      prepareModuleWithDefaults: true,\n      res:res,\n      isSuccess:true\n    });\n    var respondWithJsonFail = require('./respondWithJson')({\n      prepareModuleWithDefaults: true,\n      res:res,\n      isSuccess:false\n    });\n    var promise = urlToFileData(originalUrl).then(normalizeImageFileData);\n    var promises = [\n      promise,\n      promise.then(deleteS3Object),\n      promise.then(function(fileData){\n        if(mustBeSquare && (Math.abs(fileData.width - fileData.height) > 1)){\n          var dfd = jD.Deferred();\n          dfd.resolve({\n            failingSquare:true\n          });\n          return dfd.promise();\n        } else {          \n          var uploadToS3Promise = this.then(uploadToS3);\n          uploadToS3Promise.then(function(){\n            if(mustBeSquare){\n              var userTemplateModel = {\n                created: new Date(),\n                customTemplate: fileData.Key.replace('selfies/','').replace('.png',''),\n                templateHeight: fileData.height,\n                templateWidth: fileData.width\n              };\n              userTemplates.push(userTemplateModel);\n              mongooseStuff.MakeUserTemplate(userTemplateModel);\n            }\n          });\n          return uploadToS3Promise;\n        }\n      }).then(respondWithJsonSuccess)\n\n    ];\n    jD.when.apply(null,promises).then(null,function(err){\n      respondWithJsonFail({error:err})\n    });\n  });\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/endpointGetNormalizedImageInfo.js","/*\n * Respond to GET requests to /get_normalized_image_info.\n * changes size of image if it is too big\n * also rotates exif\n * responds with a new image url\n*/\nimport aws from 'aws-sdk';\nimport ensureLeadingSlash from '@defualt/ensure-leading-slash';\nimport respondWithJson from './respondWithJson';\n\nexport default ({\n  app,\n  accessKeyId,\n  secretAccessKey,\n  Bucket,\n  urlPattern\n}) => {\n  // Generates a unique aws url that the client uploads an image to.  Neat.\n  app.get(urlPattern, function(req, res){\n    aws.config.update({accessKeyId: accessKeyId , secretAccessKey: secretAccessKey });\n    var s3 = new aws.S3(); \n    var filename = req.query.file_name;\n    filename = filename.split('.');\n    var secondToLast = filename[filename.length - 2];\n    filename[filename.length - 2] = secondToLast + Date.now()+'_temp';\n    filename = filename.join('.');\n    var s3_params = { \n        Bucket: Bucket, \n        Key: filename, \n        Expires: 60, \n        ContentType: req.query.file_type, \n        ACL: 'public-read'\n    }; \n\n    s3.getSignedUrl('putObject', s3_params, function(err, data){ \n      respondWithJson({\n        res:res,\n        signed_request: err || data,\n        url: 'https://'+Bucket+'.s3.amazonaws.com/'+filename \n      });\n    });\n  });\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/endpointGetS3SignedUploadUrl.js","import ensureLeadingSlash from '@defualt/ensure-leading-slash';\nexport default ({app,accessKeyId,secretAccessKey,Bucket, urlPattern}) => {\n  app.post(urlPattern, function(req, res, next) {\n    var parseUrl = require('url').parse;\n    var normalizeImageFileData = require('./normalizeImageFileData')({\n      prepareModuleWithDefaults: true,\n      parseSettings: function(s){\n        var filename = s.filename;\n        // filename = parseUrl(s.originalUrl).pathname.split('/');\n        // filename = filename[filename.length - 1];\n        filename = filename.split('.');\n        filename.pop();\n        filename = filename.join('.');\n        filename = filename + Date.now() + '.png';\n        filename = 'selfies/' + filename;\n        s.url = '//s3-us-west-1.amazonaws.com/bernieapp/' + filename;\n        s.filename = filename;\n        return s;\n      }\n    });\n    var uploadToS3 = require('./uploadToS3')({\n      prepareModuleWithDefaults: true,\n      accessKeyId:accessKeyId,\n      secretAccessKey:secretAccessKey,\n      Bucket: Bucket\n    });\n    var apiRequestIntoBufferData = require('./apiRequestIntoBufferData');\n    apiRequestIntoBufferData(req).then(normalizeImageFileData).then(uploadToS3).then(function(r){\n      var details = {\n        url:r.url\n      };\n      app.render('iframeuploadbutton.html',{\n        lastData:{\n            width: r.width,\n            height: r.height,\n            public_id:r.Key.replace('selfies/',''),\n            url:r.url\n        },\n        buttonText:decodeURIComponent(req.query.buttonText)\n      },function(err, html){\n        res.end(html);\n      });\n    });\n  });\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/endpointIframeUpload.js","module.exports = function(standardModes){\n  if(typeof standardModes === 'string'){\n    standardModes = [standardModes];\n  }\n  var pipedString = ''\n  for(var i =0,l=standardModes.length;i<l;i++){\n    var mode = standardModes[i];\n    pipedString += i > 0 ? '|' + mode : mode;\n\n  }\n  var regx = new RegExp('^/('+pipedString+')(.+)');;\n  return regx;\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/generateUrlRegexNamespace.js","var aws = require('aws-sdk');\nvar jD = require('jquery-deferred');\nvar getS3ObjectData = require('./getS3ObjectData');\nmodule.exports = function(s){\n  var dfdMain = jD.Deferred();\n  var promises = [];\n  aws.config.update({accessKeyId: s.accessKeyId , secretAccessKey: s.secretAccessKey });\n  var s3 = new aws.S3();\n  for(var entryName in s.dict){\n    var entry = s.dict[entryName];\n    var filename = entry.Key;\n    (function(entryName,filename,entry){\n      var entryDfd = jD.Deferred();\n      getS3ObjectData({\n        Key:filename,\n        outputParser:function(data){\n          return {\n            entryName:entryName,\n            filename:filename,\n            data:data,\n          };\n        },\n        accessKeyId:s.accessKeyId,\n        secretAccessKey:s.secretAccessKey,\n        Bucket: s.Bucket\n      })\n      .then(entryDfd.resolve)\n      .fail(function(originalErr){\n        if(entry.retrySearchCriteria){\n          var retryBucket = entry.retrySearchCriteria.Bucket ? entry.retrySearchCriteria.Bucket : s.Bucket\n          var aws = require('aws-sdk');\n          aws.config.update({accessKeyId: s.accessKeyId , secretAccessKey: s.secretAccessKey });\n          var s3 = new aws.S3(); \n          var params = {\n            Bucket: retryBucket,\n            Prefix: entry.retrySearchCriteria.Prefix\n          };\n          s3.listObjectsV2(params, function(err, data) {\n            if(err){\n              entryDfd.reject(err);\n            } else {\n              if(data.Contents && data.Contents[0]){\n                getS3ObjectData({\n                  Key:data.Contents[0].Key,\n                  outputParser:function(data){\n                    return {\n                      entryName:entryName,\n                      filename:filename,\n                      data:data,\n                    };\n                  },\n                  accessKeyId:s.accessKeyId,\n                  secretAccessKey:s.secretAccessKey,\n                  Bucket:retryBucket\n                })\n                .then(function(){\n                  var args = arguments;\n                  var normalizeImageFileData = require('./normalizeImageFileData')({\n                    prepareModuleWithDefaults: true,\n                    filename: filename,\n                    parseSettings: function(s){\n                      s.Body = s.data.Body;\n                      return s;\n                    }\n                  });\n                  var uploadToS3 = require('./uploadToS3')({\n                    prepareModuleWithDefaults: true,\n                    accessKeyId:s.accessKeyId,\n                    secretAccessKey:s.secretAccessKey,\n                    Bucket:s.Bucket,\n                  });\n                  this.then(normalizeImageFileData).then(uploadToS3).always(function(){\n                    entryDfd.resolve.apply(null,args);\n                  });\n                  return this;\n                })\n                .fail(entryDfd.reject);\n              } else {\n                entryDfd.reject(originalErr);\n              }\n            }\n          });\n        } else {\n          entryDfd.reject(originalErr);\n        }\n      });\n      promises.push(entryDfd.promise());\n    })(entryName,filename,entry);\n  }\n\n  jD.when.apply(null,promises).done(function ( templateFetchResponse, userPhotoFetchResponse) {\n    var args = Array.prototype.slice.call(arguments);\n    var output = {};\n    for(var i=0,l=args.length;i<l;i++){\n      var entryName = args[i].entryName;\n      delete args[i].Key;\n      output[entryName] = args[i];\n    }\n    dfdMain.resolve(output);\n  }).then(null,function(err){\n    dfdMain.reject(err);\n  });\n  return dfdMain.promise();\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/getAllS3Objects.js","var jD = require('jquery-deferred');\nmodule.exports = function(originalUrl){\n  var isHttps = originalUrl.indexOf('https://') !== -1;\n  var url = require('url');\n  \n  var dfd = jD.Deferred();\n  var options = url.parse(originalUrl);\n  var http;\n  if(isHttps){\n    http = require('https');\n  } else {\n    http = require('http');\n  }\n\n  http.get(options, function (response) {\n    var chunks = [];\n    response.on('data', function (chunk) {\n      chunks.push(chunk);\n    }).on('end', function() {\n      var buffer = Buffer.concat(chunks);\n      var contentType = response.headers['content-type'];\n      dfd.resolve({\n        Body: buffer,\n        ContentType: contentType,\n        originalUrl: originalUrl\n      })\n    }).on('error', (e) => {\n      dfd.reject(e);\n    });\n  });\n\n  return dfd.promise();\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/urlToFileData.js",";var mymoduleName = 'mymodule';\n\n\nvar templateBaseUrl = 'http://s3-us-west-1.amazonaws.com/bernieapp/decorations/';\n\nvar rawImagePrefix = 'http://s3-us-west-1.amazonaws.com/bernieapp/selfies/';\n\n\nvar isNode= (function(){\n\tvar isNode = false;    \n\tif (typeof process === 'object') {\n\t  if (typeof process.versions === 'object') {\n\t    if (typeof process.versions.node !== 'undefined') {\n\t      isNode = true;\n\t    }\n\t  }\n\t}\n\treturn isNode;\n})();\n\n;(function(exports){\n\n\tvar standardModes = [\n\t\t{\n\t\t\tmode:'f',\n\t\t\tfeatured:false,\n\t\t\told:true\n\t\t},\n\t\t{\n\t\t\tmode:'ut',\n\t\t\tfeatured:false\n\t\t},\n\t\t{\n\t\t\tmode:'b',\n\t\t\tfeatured:false,\n\t\t\told:true\n\t\t},\n\t\t{\n\t\t\tmode:'h',\n\t\t\tfeatured:false,\n\t\t\told:true\n\t\t},\n\t\t{\n\t\t\tmode:'selfie',\n\t\t\tfeatured:false,\n\t\t\told:true\n\t\t},\n\t\t{\n\t\t\tmode:'h3',\n\t\t\tfeatured:true\n\t\t},\n\t\t{\n\t\t\tmode:'h4',\n\t\t\tfeatured:true\n\t\t},\n\t\t{\n\t\t\tmode:'wg',\n\t\t\tfeatured:true\n\t\t}\n\t];\n\texports.standardModes = standardModes;\n\texports.getStandardModesRegex = function(nameSpace){\n\t\tvar pipedString = ''\n\t\tfor(var i =0,l=exports.standardModes.length;i<l;i++){\n\t\t\tvar mode = exports.standardModes[i].mode;\n\t\t\tmode = nameSpace ? (nameSpace + '\\/' + mode) : mode;\n\t\t\tconsole.log('mode',mode);\n\t\t\tpipedString += i > 0 ? ('|' + mode) : mode;\n\n\t\t}\n\t\treturn new RegExp('^[/]('+pipedString+')[/](.+)');\n\t};\n\n\texports.oldModes = (function(){\n\t\tvar a = []\n\t\tfor(var i =0,l=exports.standardModes.length;i<l;i++){\n\t\t\tif(!!exports.standardModes[i].old){\n\t\t\t\ta.push(exports.standardModes[i]);\n\t\t\t}\n\t\t}\n\t\treturn a;\n\t})();\n\n\texports.isOldMode = function(toCompare){\n\t\tvar is = false;\n\t\tfor(var i =0,l=exports.oldModes.length;i<l;i++){\n\t\t\tis = is || toCompare === exports.oldModes[i].mode;\n\t\t}\n\t\treturn is;\n\t};\n\n\tvar containsStardardModeCache = {};\n\texports.containsStardardMode = function(url){\n\t\tvar contains = false;\n\t\tif(typeof containsStardardModeCache[url] === 'undefined'){\n\t\t\tfor(var i =0,l=exports.standardModes.length;i<l;i++){\n\t\t\t\tvar mode = exports.standardModes[i].mode;\n\t\t\t\tcontains = contains || url.indexOf(mode) !== -1;\n\t\t\t}\n\t\t\tcontainsStardardModeCache[url] = contains;\n\t\t}\n\t\treturn containsStardardModeCache[url];\n\t};\n\n\t\n\n\tvar DeriveUrlInfo = function({pathname,offline,nameSpace}){\n\t\tthis.init({pathname,offline,nameSpace})\n\t\t\n\t\t\n\t};\n\tDeriveUrlInfo.prototype.init = function({pathname,offline,nameSpace}){\n\t\tthis.nameSpace = nameSpace;\n\t\tthis.nameSpaceWithLeadingSlash = nameSpace ? `/${nameSpace}` : '';\n\t\tvar nameSpaceWithLeadingSlash = this.nameSpaceWithLeadingSlash;\n\t\tthis.offline = offline;\n\t\tvar defaultPathname = '/h3/zephyr1476401787491/180_3_218_218_553_553/';\n\t\tpathname = !!pathname !== 0 ? pathname : defaultPathname;\n\t\tpathname = pathname === nameSpaceWithLeadingSlash || pathname === nameSpaceWithLeadingSlash + '/' ? defaultPathname : pathname;\n\t\tif (pathname && pathname.indexOf(this.nameSpaceWithLeadingSlash) === 0) {\n\t\t\tpathname = pathname.replace(this.nameSpaceWithLeadingSlash, '');\n\t\t}\n\t\tpathname = pathname ? pathname : defaultPathname;\n\n\t\tthis.slashSplit = pathname.split('/');\n\t\tif(pathname.indexOf('/f/') === 0){\n\t\t\tthis.idX = this.slashSplit[4];\n\t\t\tthis.customTemplate = this.slashSplit[2];\n\t\t} else if(pathname.indexOf('/selfie/') === 0){\n\t\t\tpathname = '/selfie/v1438476536/bernie/' + this.slashSplit[4];\n\t\t\tthis.slashSplit = pathname.split('/');\n\t\t\tthis.idX = this.slashSplit[4];\n\t\t\tthis.customTemplate = 'i4hiodnsy2yaqavpowm1';\n\t\t} else {\n\t\t\t//pathname.indexOf('/h/') === 0\n\t\t\t//pathname.indexOf('/h3/') === 0\n\t\t\tthis.idX = this.slashSplit[2];\n\t\t}\n\n\t\tif(pathname.indexOf('/ut/') === 0){\n\t\t\tthis.customTemplate = this.slashSplit[4];\n\t\t}\n\n\t\tif(pathname.indexOf('/h/') === 0){\n\t\t\tthis.customTemplate = 'hairglasses';\n\t\t}\n\n\t\tthis.pathname = this.nameSpaceWithLeadingSlash + pathname;\n\t\tconsole.log('this.slashSplit',this.slashSplit);\n\t\tthis.coords = this.slashSplit[3].split('_');\n\n\t\tfor(var i=0,l=this.coords.length;i<l;i++){\n\t\t\tthis.coords[i] = +this.coords[i];\n\t\t}\n\n\t\tthis.dims = this.coords.splice(4,2);\n\t\tthis.width = +this.dims[0];\n\t\tthis.height = +this.dims[1];\n\t\tthis.x = this.coords[0];\n\t\tthis.y = +this.coords[1];\n\t\tthis.cropWidth = this.coords[2];\n\t\tthis.cropHeight = this.coords[3];\n\t\t\n\t\tthis.format = '.jpg';\n\n\t\tthis.customUrl = '';\n\t\tthis.customUrlQueryString = '';\n\t\tthis.makeCustomUrl({\n\n\t\t});\n\t};\n\tDeriveUrlInfo.prototype.normalize = function(val,def){\n\t\tdef = typeof def !== 'undefined' ? def : true;\n\t\tval = typeof val !== 'undefined' ? val : def;\n\t\tif(typeof def === 'number'){\n\t\t\tval = typeof val === 'string' ? +val : val;\n\t\t\tval = !isNaN(val) ? val : def;\n\t\t\tval = Math.round(val);\n\t\t}\n\t\t\n\t\treturn val;\n\t}\n\tDeriveUrlInfo.prototype.doubleNormalize = function(val,prexisting,def){\n\t\tvar def = this.normalize(prexisting,def);\n\t\treturn this.normalize(val,def);\n\t}\n\tDeriveUrlInfo.prototype.doubleNormalizeInterface = function(dest,options,defaults){\n\t\tfor(var name in defaults){\n\t\t\tvar def = defaults[name];\n\t\t\tdest[name] = this.doubleNormalize(options[name],dest[name],def);\n\t\t}\n\t};\n\n\tDeriveUrlInfo.prototype.makeCustomUrl = function(settings){\n\t\tvar mode = this.slashSplit[1].toLowerCase();\n\t\t\n\t\tvar toNormalize = {\n\t\t\t'x':mode !== 'selfie' ? 0 : 142,\n\t\t\t'y':mode !== 'selfie' ? 0 : 98,\n\t\t\t'cropWidth':mode !== 'selfie' ? 1200 : 305,\n\t\t\t'cropHeight':mode !== 'selfie' ? 1200 : 305,\n\t\t\t'width':1200,\n\t\t\t'height':1200,\n\t\t\t'idX':'zephyr1476401787491.png',\n\t\t\t'mode':mode\n\t\t};\n\t\tif(!!settings.customTemplate){\n\t\t\ttoNormalize.customTemplate = settings.customTemplate;\n\t\t}\n\t\tthis.doubleNormalizeInterface(this,settings,toNormalize);\n\t\tthis.idX = this.idX.split('.');\n\t\tif(this.idX.length > 1){\n\t\t\tthis.idX.pop();\n\t\t}\n\t\tthis.idX = this.idX.join('.');\n\t\tthis.rawImage = rawImagePrefix + this.idX;\n\t\tthis.rawImage = !!this.offline ? '/images/mock-selfie-raw.jpg' : this.rawImage;\n\t\tif(this.rawImage.indexOf('.') === -1){\n\t\t\tthis.rawImage += '.png';\n\t\t}\n\t\tif(this.mode === 'f' || this.mode === 'selfie'){\n\t\t\tthis.customTemplate = 'wg';\n\t\t\tthis.doStandardSquare();\n\t\t}else{\n\t\t\tthis.doStandardSquare()\n\t\t}\n\t};\n\tDeriveUrlInfo.prototype.serialize = function(obj, prefix) {\n\t\tif(typeof obj !== 'object'){\n\t\t\tobj = {whatever:obj};\n\t\t}\n\t    var str = [];\n\t    for (var p in obj) {\n\t        if (obj.hasOwnProperty(p)) {\n\t            var k = prefix ? prefix + \"[\" + p + \"]\" : p,\n\t                v = obj[p];\n\t            str.push(typeof v == \"object\" ?\n\t                serialize(v, k) :\n\t                encodeURIComponent(k) + \"=\" + encodeURIComponent(v));\n\t        }\n\t    }\n\t    str = str.join(\"&\");\n\t    str = str.replace('whatever=','')\n\t    return str;\n\t};\n\n\tDeriveUrlInfo.prototype.doStandardSquare = function(){\n\t\tthis.pathname = '/'+this.mode+'/'+this.idX+'/'+this.x+'_'+this.y+'_'+this.cropWidth+'_'+this.cropHeight+'_'+this.width+'_'+this.height+'/'\n\t\tif(!!this.customTemplate && this.mode !== 'h'){\n\t\t\tthis.pathname += this.customTemplate + '/';\n\t\t}\n\t\t\n\t\tvar userPhotoKey = this.idX;\n\t\tuserPhotoKey = userPhotoKey.split('.');\n\t\tif(userPhotoKey.length > 1){\n\t\t\tuserPhotoKey.pop();\n\t\t}\n\t\tuserPhotoKey = userPhotoKey.join('.');\n\t\tuserPhotoKey = userPhotoKey;\n\t\t\n\t\tvar customUrlSettings = {\n\t\t\tcropWidth: this.cropWidth,\n\t\t\tcropHeight: this.cropHeight,\n\t\t\tx: this.x,\n\t\t\ty: this.y,\n\t\t\ttemplate:(!!this.customTemplate ? this.customTemplate : this.mode),\n\t\t\tuserPhotoKey: userPhotoKey\n\t\t};\n\t\tvar s = customUrlSettings;\n\n\t\tthis.customUrl = ('' +\n\t\t\t'/image/' + \n\t\t\ts.template +\n\t\t\t'/' +\n\t\t\ts.userPhotoKey +\n\t\t\t'_' + s.cropWidth + '_' + s.cropHeight + '_' + s.x + '_' + s.y + '.jpg' +\n\t\t'');\n\t\tthis.customUrl = !!this.offline ? '/images/mock-selfie.png' : this.customUrl;\n\t\tthis.customUrlQueryString = this.serialize(this.customUrl);\n\n\t\treturn this.customUrl;\n\t};\n\n\texports.generateTemplateImgListHtml = function(userTemplates,offline){\n\t\tvar imgsHtml = '';\n\t\tif(offline){\n\t\t\t;(function(){\n\t\t\t\tvar offlineTemplates = [\n                    {customTemplate:'/images/h3.png'},\n                    {customTemplate:'/images/h4.png'},\n                    {customTemplate:'/images/h3.png'}\n                ];\n\t            for(var i=0,l=offlineTemplates.length;i<l;i++){\n\t            \timgsHtml += '<div class=\"designFrame\">';\n\t            \t\timgsHtml += '<div class=\"designFrame_innerWrap\">';\n\t                \t\timgsHtml += '<img class=\"designFrame_design userTemplate\" src=\"'+offlineTemplates[i].customTemplate+'\">'\n\t            \t\timgsHtml += '</div>';\n\t            \timgsHtml += '</div>';\n\t            }\n\t            \n\t        })();\n\t\t}else{\n\t\t\t;(function(){\n\t            for(var i=0,l=standardModes.length;i<l;i++){\n\t                if(!!standardModes[i].featured){\n\t                \timgsHtml += '<div class=\"designFrame\">';\n\t\t                \timgsHtml += '<div class=\"designFrame_innerWrap\">';\n\t\t                    \timgsHtml += '<img class=\"designFrame_design standardTemplate\" src=\"' + templateBaseUrl +standardModes[i].mode+'.png\">';\n\t\t                \timgsHtml += '</div>';\n\t                \timgsHtml += '</div>';\n\t                }\n\t            }\n\t        })();\n\t        ;(function(){\n\t            for(var i=0,l=userTemplates.length;i<l;i++){\n\t            \timgsHtml += '<div class=\"designFrame\">';\n\t\t            \timgsHtml += '<div class=\"designFrame_innerWrap\">';\n\t\t                \timgsHtml += '<img class=\"designFrame_design userTemplate\" src=\"' + templateBaseUrl +userTemplates[i].customTemplate+'.png\">'\n\t\t            \timgsHtml += '</div>';\n\t            \timgsHtml += '</div>';\n\t            }\n\t            \n\t        })();\n        }\n        return imgsHtml;\n\t};\n\texports.deriveUrlInfo = function({pathname,offline,nameSpace}){\n\t\treturn new DeriveUrlInfo({pathname,offline,nameSpace});\n\t};\n\n})(typeof exports === 'undefined'? this[mymoduleName]={}: exports);\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/public/js/mymodule.js"],"sourceRoot":""}