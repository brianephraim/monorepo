{"version":3,"sources":["webpack:///../bernieserver/bernieserver.express.js","webpack:///../bernieserver/js/prepareModuleWithDefaults.js","webpack:///../bernieserver/js/respondWithJson.js","webpack:///../ensure-leading-slash/ensure-leading-slash.js","webpack:///../bernieserver/js/normalizeImageFileData.js","webpack:///../bernieserver/js/uploadToS3.js","webpack:///../bernieserver/js/getS3ObjectData.js","webpack:///../bernieserver/js/mongooseStuff.js","webpack:///../bernieserver/bernieExpressServer.js","webpack:///../bernieserver/js/apiRequestIntoBufferData.js","webpack:///../bernieserver/js/calcOverlayAndTemplateProcessingSettings.js","webpack:///../bernieserver/js/createCompositeBuffer.js","webpack:///../bernieserver/js/deleteS3Object.js","webpack:///../bernieserver/js/endpointCompositeImage.js","webpack:///../bernieserver/js/endpointGetNormalizedImageInfo.js","webpack:///../bernieserver/js/endpointGetS3SignedUploadUrl.js","webpack:///../bernieserver/js/endpointIframeUpload.js","webpack:///../bernieserver/js/generateUrlRegexNamespace.js","webpack:///../bernieserver/js/getAllS3Objects.js","webpack:///../bernieserver/js/urlToFileData.js","webpack:///../bernieserver/public/js/mymodule.js"],"names":["console","log","module","exports","fun","c","prepareModuleWithDefaults","Object","assign","parseSettings","r","Array","isArray","require","s","res","isSuccess","accessKeyId","secretAccessKey","status","statusCode","error","json","message","write","JSON","stringify","end","ensureLeadingSlash","str","replace","jD","sharp","parseUrl","parse","dfd","Deferred","buffer","Body","image","metadata","err","meta","reject","smallestDim","Math","min","width","height","largestDim","max","limit","multiplier","floor","resize","withoutEnlargement","rotate","toBuffer","outputBuffer","info","manipulatedImageFileData","Key","filename","ContentType","url","originalFilename","resolve","promise","aws","mime","extension","split","pop","lookup","config","update","s3","S3","s3Params","Bucket","ACL","putObject","data","uploadResponse","getObject","output","resolveNullOn404","outputParser","mymoduleName","mongoose","uriUtil","mongooseStuff","MongooseStuff","self","mongodbUri","process","env","MONGOLAB_URI","ENVNAME","DATABASE_NAME","mongooseUri","formatMongoose","db","connection","models","SimpleImage","model","Schema","String","ComplexImage","Date","Number","UserTemplate","created","customTemplate","templateHeight","templateWidth","prototype","connect","readyState","options","server","socketOptions","keepAlive","connectTimeoutMS","replset","once","on","bind","checkUrl","idX","then","findOne","simpleimage","GetComplexImage","GetUserTemplatesAll","find","GetComplexImageAll","MakeUserTemplate","findOneAndUpdate","upsert","apply","arguments","UpdateComplexImage","newRecord","save","getImages","nuke","collection","drop","close","x","app","port","nameSpace","appIsBrandNew","set","__dirname","engine","renderFile","use","static","join","AWS_ACCESS_KEY","AWS_SECRET_KEY","S3_BUCKET","get","req","render","pageName","urlInfo","deriveUrlInfo","userTemplates","buttonText","query","standardRouteHtmlHandler","urlToUse","pathname","offline","iframebutton","result","mymodule","getStandardModesRegex","images","urlPattern","post","body","send","payload","always","listen","Busboy","filenameDfd","busboy","headers","bufferArray","filenamex","toResolve","fieldname","file","encoding","mimetype","push","Buffer","concat","pipe","cropSettings","userPhotoWidthHeight","cropWidth","cropHeight","cropTop","top","cropLeft","left","cropRight","cropBottom","rawWidth","rawHeight","rawRight","rawBottom","rawTop","rawLeft","extract","extend","right","bottom","completelyOutOfBound","calcOverlayAndTemplateProcessingSettings","overlaySettings","responses","templateFetchResponse","template","userPhotoFetchResponse","userPhoto","args","slice","call","imageProcessingSettings","background","flatten","jpeg","templateBuffer","userPhotoBuffer","overlayWith","deleteObjects","Delete","Objects","msg","parseClientCompositeImageUrl","pathnameSplit","splice","compositeS3Key","templateFilename","userImageAndScalePos","userImageFilename","scalePos","compositeImageInstructions","dict","retrySearchCriteria","Prefix","bufferData","setHeader","urlToFileData","uploadToS3","normalizeImageFileData","originalUrl","indexOf","host","length","now","deep","deleteS3Object","decodeURIComponent","image_url","mustBeSquare","must_be_square","respondWithJsonSuccess","respondWithJsonFail","promises","fileData","abs","failingSquare","uploadToS3Promise","userTemplateModel","when","file_name","secondToLast","s3_params","Expires","file_type","getSignedUrl","signed_request","next","apiRequestIntoBufferData","details","lastData","public_id","html","standardModes","pipedString","i","l","mode","regx","RegExp","getS3ObjectData","dfdMain","entryName","entry","entryDfd","fail","originalErr","retryBucket","params","listObjectsV2","Contents","done","isHttps","http","response","chunks","chunk","contentType","e","templateBaseUrl","rawImagePrefix","isNode","versions","node","featured","old","oldModes","a","isOldMode","toCompare","is","containsStardardModeCache","containsStardardMode","contains","DeriveUrlInfo","init","nameSpaceWithLeadingSlash","defaultPathname","slashSplit","coords","dims","y","format","customUrl","customUrlQueryString","makeCustomUrl","normalize","val","def","isNaN","round","doubleNormalize","prexisting","doubleNormalizeInterface","dest","defaults","name","settings","toLowerCase","toNormalize","rawImage","doStandardSquare","serialize","obj","prefix","whatever","p","hasOwnProperty","k","v","encodeURIComponent","userPhotoKey","customUrlSettings","generateTemplateImgListHtml","imgsHtml","offlineTemplates"],"mappings":"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","file":"0.js","sourcesContent":["console.log('BERNIE SERVER EXPRESS HERE!!!');\n\nimport serve from './bernieExpressServer';\n\nexport default serve;\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/bernieserver.express.js","module.exports = function(fun){\n  return function(c){\n    if(c.prepareModuleWithDefaults){\n      c = Object.assign({},c);\n      var parseSettings = null;\n      if(c.parseSettings){\n        parseSettings = c.parseSettings;\n        delete c.parseSettings;\n      }\n      delete c.prepareModuleWithDefaults;\n      return function(r){\n        if(typeof r === 'object' && !Array.isArray(r)){\n          r = Object.assign({},c,r);\n        }\n        \n        if(parseSettings){\n          r = parseSettings(r);\n        }\n        return fun(r);\n      };\n    } else {\n      return fun(c);\n    }\n  };\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/prepareModuleWithDefaults.js","var prepareModuleWithDefaults = require('./prepareModuleWithDefaults');\nmodule.exports = prepareModuleWithDefaults(function(s){\n\tvar res = s.res;\n\tvar isSuccess = typeof s.isSuccess === 'undefined' || !!s.isSuccess;\n\tdelete s.res;\n\tdelete s.isSuccess;\n\tdelete s.accessKeyId;\n\tdelete s.secretAccessKey;\n\tvar status = 200;//ok\n\tif(s.statusCode){\n\t\tstatus = s.statusCode;\n\t} else if(!isSuccess){\n\t\tstatus = 500;\n\t}\n\tstatus = status === 0 ? 500 : status;\n\t\n\tif(s.error){\n\t\t// res.write(s.error);\n\t\t// res.render('error', s.error);\n\t\tres.status(status).json({\n\t\t\tmessage:s.error.message,\n\t\t\terror:s.error.error\n\t\t})\n\t\t// res.json('error', {\n\t //        message: s.error.message,\n\t //        error: s.error\n\t //    });\n\t} else {\n\t\tres.status(status);\n\t\tres.write(JSON.stringify(s));\n\t}\n\t\n\tres.end();\n});\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/respondWithJson.js","function ensureLeadingSlash(str) {\n  return str.replace(/^\\/?/, '/');\n}\nexport default ensureLeadingSlash;\n\n\n\n// WEBPACK FOOTER //\n// ../ensure-leading-slash/ensure-leading-slash.js","var jD = require('jquery-deferred');\nvar sharp = require('sharp');\nvar prepareModuleWithDefaults = require('./prepareModuleWithDefaults');\nvar parseUrl = require('url').parse;\nmodule.exports = prepareModuleWithDefaults(function(s){\n  var dfd = jD.Deferred();\n  var buffer = s.Body;\n  var sharp = require('sharp');\n  var image = sharp(buffer);\n  image.metadata(function(err, meta){\n      if(err){\n        dfd.reject(err);\n      } else {\n        var smallestDim = Math.min(meta.width, meta.height);\n        var largestDim = Math.max(meta.width, meta.height);\n        var limit = 1200;\n\n        var multiplier = limit/smallestDim;\n        multiplier = multiplier < 1 ? multiplier : 1;\n        if(multiplier !== 1){\n          limit = Math.floor(largestDim * multiplier);\n          image.resize(limit,limit).max().withoutEnlargement()\n        }\n        image.rotate().toBuffer(function(err, outputBuffer, info) {\n          if(err){\n            dfd.reject(err);\n          } else {\n            var manipulatedImageFileData = {\n              Key: s.filename,\n              ContentType: 'image/png',\n              Body: outputBuffer,\n              width: info.width,\n              height: info.height,\n              url: s.url,\n              originalFilename: s.originalFilename\n            };\n          }\n          dfd.resolve(manipulatedImageFileData);\n        });\n      }\n  });\n  return dfd.promise();\n});\n\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/normalizeImageFileData.js","var jD = require('jquery-deferred');\nvar aws = require('aws-sdk');\nvar prepareModuleWithDefaults = require('./prepareModuleWithDefaults');\nmodule.exports = prepareModuleWithDefaults(function(s){\n  s = Object.assign({},s);\n  if(!s.ContentType){\n    var mime = require('mime-types');\n    var extension = s.Key.split('.').pop();\n    s.ContentType = mime.lookup(extension);\n  }\n  var dfd = jD.Deferred();\n\n  aws.config.update({accessKeyId: s.accessKeyId , secretAccessKey: s.secretAccessKey });\n  var s3 = new aws.S3(); \n  var s3Params = {\n      Bucket: s.Bucket,\n      Key: s.Key,\n      Body: s.Body,\n      ContentType: s.ContentType,\n      ACL: 'public-read'\n  };\n\n  s3.putObject(\n    s3Params,\n    function(err, data) {\n        if (err) {\n          dfd.reject(err);\n        } else {\n          s.uploadResponse = data;\n          dfd.resolve(s);\n        }\n    }\n  );\n  return dfd.promise();\n});\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/uploadToS3.js","var jD = require('jquery-deferred');\nvar aws = require('aws-sdk');\nmodule.exports = function(s){\n  s = Object.assign({},s);\n  var dfd = jD.Deferred();\n  aws.config.update({accessKeyId: s.accessKeyId , secretAccessKey: s.secretAccessKey });\n  var s3 = new aws.S3(); \n  s3.getObject(\n    {\n        Bucket: s.Bucket,\n        Key: s.Key\n    },\n    function(err, data) {\n      var output;\n      if(err && err.statusCode === 404 && s.resolveNullOn404){\n        output = s.outputParser ? s.outputParser(null) : null;\n        dfd.resolve(output);\n      } else if (err){\n        dfd.reject(err);\n      } else {\n        output = s.outputParser ? s.outputParser(data) : data;\n        dfd.resolve(output);\n      }\n    }\n  );\n  return dfd.promise();\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/getS3ObjectData.js",";\nvar mymoduleName = 'mongooseStuff';;\n(function(exports) {\n\n    var jD = require('jquery-deferred');\n\n\n    var mongoose = require('mongoose');\n    var uriUtil = require('mongodb-uri');\n\n    var mongooseStuff = (function() {\n        var MongooseStuff = function() {\n            var self = this;\n            var mongodbUri = process.env.MONGOLAB_URI;\n            if(process.env.ENVNAME === 'foremanLocal'){\n                mongodbUri = \"mongodb://localhost:27017/\"+process.env.DATABASE_NAME;\n            }\n            \n            this.mongooseUri = uriUtil.formatMongoose(mongodbUri);\n            this.db = mongoose.connection;\n            this.models = {};\n            self.models.SimpleImage = mongoose.model('simpleimage', mongoose.Schema({\n                \"url\": String,\n                \"idX\": String,\n                // \"date\": {\n                //     type: Date,\n                //     default: Date.now\n                // },\n                // \"width\": Number,\n                // \"height\": Number,\n            }));\n\n            self.models.ComplexImage = mongoose.model('ComplexImage', mongoose.Schema({\n                \"url\": String,\n                \"idX\": String,\n                \"date\":Date,\n                \"width\":Number,\n                \"height\":Number,\n                \"cropWidth\":Number,\n                \"cropHeight\":Number,\n                \"x\":Number,\n                \"y\":Number,\n                \"mode\":String,\n                \"customTemplate\":String,\n                \"idX\":String,\n                \"customUrl\":String,\n                \"pathname\":String,\n                \"good\":Number\n                // \"date\": {\n                //     type: Date,\n                //     default: Date.now\n                // },\n                // \"width\": Number,\n                // \"height\": Number,\n            }));\n\n            self.models.UserTemplate = mongoose.model('UserTemplate', mongoose.Schema({\n\t\t\t\tcreated: Date,\n\t\t\t\tcustomTemplate:String,\n\t\t\t\ttemplateHeight: Number,\n\t\t\t\ttemplateWidth:Number\n            }));\n        };\n        MongooseStuff.prototype.connect = function() {\n            var self = this;\n            var dfd = jD.Deferred();\n            if (mongoose.connection.readyState === 0) {\n                var options = {\n                    server: {\n                        socketOptions: {\n                            keepAlive: 1,\n                            connectTimeoutMS: 30000\n                        }\n                    },\n                    replset: {\n                        socketOptions: {\n                            keepAlive: 1,\n                            connectTimeoutMS: 30000\n                        }\n                    }\n                };\n                mongoose.connect(self.mongooseUri, options);\n                self.db.once('open', dfd.resolve);\n                self.db.on('error', console.error.bind(console, 'connection error:'));\n\n            } else {\n                dfd.resolve();\n            }\n\n            return dfd.promise();\n        };\n\n        MongooseStuff.prototype.checkUrl = function(idX) {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n                self.models.SimpleImage.findOne({\n                    'idX': idX\n                }, 'url idX', function(err, simpleimage) {\n\n                    if (simpleimage !== null) {\n                        dfd.resolve(true)\n                    } else {\n                        dfd.resolve(false)\n                    }\n\n                    // if (err) return handleError(err);\n                    // console.log('%s %s is a %s.', person.name.first, person.name.last, person.occupation) // Space Ghost is a talk show host.\n                })\n            });\n            return dfd.promise();\n        };\n\n        MongooseStuff.prototype.GetComplexImage = function(idX) {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n                self.models.ComplexImage.findOne({\n                    'idX': idX\n                }, function(err, data) {\n\n                    if (data !== null) {\n                        dfd.resolve(data)\n                    } else {\n                        dfd.resolve(data)\n                    }\n\n                    // if (err) return handleError(err);\n                    // console.log('%s %s is a %s.', person.name.first, person.name.last, person.occupation) // Space Ghost is a talk show host.\n                })\n            });\n            return dfd.promise();\n        };\n\n        MongooseStuff.prototype.GetUserTemplatesAll = function() {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n                self.models.UserTemplate.find({\n                }, function(err, data) {\n\n                    if (data !== null) {\n                        dfd.resolve(data)\n                    } else {\n                        dfd.resolve(data)\n                    }\n\n                    // if (err) return handleError(err);\n                    // console.log('%s %s is a %s.', person.name.first, person.name.last, person.occupation) // Space Ghost is a talk show host.\n                })\n            });\n            return dfd.promise();\n        };\n\n        MongooseStuff.prototype.GetComplexImageAll = function() {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n                self.models.ComplexImage.find({\n                }, function(err, data) {\n\n                    if (data !== null) {\n                        dfd.resolve(data)\n                    } else {\n                        dfd.resolve(data)\n                    }\n\n                    // if (err) return handleError(err);\n                    // console.log('%s %s is a %s.', person.name.first, person.name.last, person.occupation) // Space Ghost is a talk show host.\n                })\n            });\n            return dfd.promise();\n        };\n\n        \n        MongooseStuff.prototype.MakeUserTemplate = function(data) {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n            \tself.models.UserTemplate.findOneAndUpdate( { customTemplate : data.customTemplate },data,{ upsert : true }, function(){\n            \t\tdfd.resolve.apply(null, arguments);\n            \t});\n            });\n            return dfd.promise();\n        };\n\n\n        MongooseStuff.prototype.UpdateComplexImage = function(data) {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n            \tself.models.ComplexImage.findOneAndUpdate( { idX : data.idX },data,{ upsert : true }, function(){\n            \t\tdfd.resolve.apply(null, arguments);\n            \t});\n            });\n            return dfd.promise();\n        };\n\n        MongooseStuff.prototype.ComplexImage = function(data) {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n                var newRecord = new self.models.ComplexImage(data);\n\n                newRecord.save(function() {\n                    dfd.resolve.apply(null, arguments);\n                })\n            });\n            return dfd.promise();\n        };\n\n        MongooseStuff.prototype.simpleimage = function(url, idX) {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n                var newRecord = new self.models.SimpleImage({\n                    url: url,\n                    idX: idX\n                });\n\n                newRecord.save(function() {\n                    dfd.resolve.apply(null, arguments);\n                })\n            });\n            return dfd.promise();\n        };\n\n        MongooseStuff.prototype.getImages = function(url, idX) {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n                self.models.SimpleImage.find({}, 'url idX', function(err, simpleimage) {\n                    dfd.resolve(simpleimage);\n                })\n            });\n            return dfd.promise();\n        };\n\n        MongooseStuff.prototype.nuke = function() {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n                mongoose.connection.db.collection('usertemplates').drop(function(err) {//compleximages\n                    if (err) throw err;\n\n                    // Only close the connection when your app is terminating\n                    mongoose.connection.db.close(function(err) {\n                        dfd.resolve();\n                        if (err) throw err;\n                    });\n                });\n                return dfd.promise();\n            });\n        };\n\n\n\n        return new MongooseStuff();\n    })();\n\n\n    exports.x = mongooseStuff;\n\n\t// mongooseStuff.nuke();\n\n\t// mongooseStuff.connect().then(function(){\n\t// \tmongoose.connection.db.listCollections().toArray(function(err, names) {\n\t// \t    if (err) {\n\t// \t        console.log(err);\n\t// \t    }\n\t// \t    else {\n\t// \t        names.forEach(function(e,i,a) {\n\t// \t            mongoose.connection.db.dropCollection(e.name);\n\t// \t            console.log(\"collection --->>\", e.name);\n\t// \t        });\n\t// \t    }\n\t// \t});\n //    });\n\n\n})(typeof exports === 'undefined' ? this[mymoduleName] = {} : exports);\n\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/mongooseStuff.js","console.log('APP.js');\nimport mymodule from './public/js/mymodule';\nimport express from 'express';\nimport ejs from 'ejs';\nimport path from 'path';\nimport url from 'url';\nimport fs from 'fs';\nimport { x as mongooseStuff } from './js/mongooseStuff';\nimport endpointCompositeImage from './js/endpointCompositeImage';\nimport endpointGetNormalizedImageInfo from './js/endpointGetNormalizedImageInfo';\nimport endpointGetS3SignedUploadUrl from './js/endpointGetS3SignedUploadUrl';\nimport endpointIframeUpload from './js/endpointIframeUpload';\nimport generateUrlRegexNamespace from './js/generateUrlRegexNamespace';\nimport respondWithJson from './js/respondWithJson';\nimport ensureLeadingSlash from '@defualt/ensure-leading-slash';\n// var mymodule = require('./public/js/mymodule');\n// var express = require('express');\n// var ejs = require('ejs');\n// var path = require('path');\n// var url = require('url');\n// var mongooseStuff = require('./js/mongooseStuff').x;\n// var endpointCompositeImage = require('./js/endpointCompositeImage');\n\n// var endpointGetNormalizedImageInfo = require('./js/endpointGetNormalizedImageInfo');\n\n// var endpointGetS3SignedUploadUrl = require('./js/endpointGetS3SignedUploadUrl');\n\n// var endpointIframeUpload = require('./js/endpointIframeUpload');\n// var fs = require('fs');\n\n/*\n * Set-up the Express app.\n */\n\nexport default ({app, port = 3000, nameSpace = ''}) => {\n  console.log(\"SERVING BERNIE BACKEND\");\n  // This module either extends an existing express app\n  // or creates a new express app\n  let appIsBrandNew = false;\n  if (!app) {\n    appIsBrandNew = true;\n    app = express();\n  }\n\n  app.set('views', __dirname + '/views');\n  app.engine('html', ejs.renderFile);\n\n  app.use(express.static(path.join(__dirname, 'public')));\n\n  /*\n   * Load the S3 information from the environment variables.\n   */\n  var AWS_ACCESS_KEY = process.env.AWS_ACCESS_KEY;\n  var AWS_SECRET_KEY = process.env.AWS_SECRET_KEY;\n  var S3_BUCKET = process.env.S3_BUCKET\n\n  //===========================\n  //HTML PAGES\n  //____________________________\n\n  app.get(ensureLeadingSlash(`${nameSpace}/privacy`), function(req, res){\n      res.render('privacy.html',{\n          pageName:'privacy',\n          urlInfo:mymodule.deriveUrlInfo({nameSpace}),\n          userTemplates:userTemplates\n      });\n  });\n\n  app.get(ensureLeadingSlash(`${nameSpace}/terms`), function(req, res){\n      res.render('terms.html',{\n          pageName:'terms',\n          urlInfo:mymodule.deriveUrlInfo({nameSpace}),\n          userTemplates:userTemplates\n      });\n  });\n\n  app.get(ensureLeadingSlash(`${nameSpace}/iframeuploadbutton`), function(req, res){\n      res.render('iframeuploadbutton.html',{\n          pageName:'iframeuploadbutton',\n          urlInfo:null,\n          buttonText:req.query.buttonText\n      });\n  });\n\n\n\n  var standardRouteHtmlHandler = function(req, res){\n    var urlToUse = req.url;  \n    urlToUse = url.parse(urlToUse).pathname === '/' ? null : urlToUse;\n    var offline = typeof req.query.offline !== 'undefined';\n    var iframebutton = typeof req.query.iframebutton !== 'undefined';\n    var urlInfo = mymodule.deriveUrlInfo({pathname: urlToUse,offline,nameSpace});\n    \n    mongooseStuff.UpdateComplexImage(urlInfo).then(function(result){});\n\n    res.render('redesign'+'.html',{\n        userTemplates:userTemplates,\n        req:req,\n        urlInfo:urlInfo,\n        mymodule:mymodule,\n        offline:offline,\n        iframebutton:iframebutton\n        // pretty:stringify(req, null, 2)\n    });\n  };\n  app.get(mymodule.getStandardModesRegex(nameSpace), standardRouteHtmlHandler);\n\n  app.get(ensureLeadingSlash(`${nameSpace}/`), standardRouteHtmlHandler);\n\n  app.get(ensureLeadingSlash(`${nameSpace}/redesign`), standardRouteHtmlHandler);\n\n\n\n  app.get(ensureLeadingSlash(`${nameSpace}/list`), function(req, res){\n      var offline = typeof req.query.offline !== 'undefined';\n      mongooseStuff.GetComplexImageAll().then(function(images){\n      // mongooseStuff.getImages().then(function(images){\n        res.render('list.html', { \n            images:images,\n            offline:offline\n        });\n      });\n  });\n\n\n  var userTemplates = []; \n  //===========================\n  //ENDPOINTS\n  //____________________________\n\n  endpointCompositeImage({\n    app:app,\n    accessKeyId:AWS_ACCESS_KEY,\n    secretAccessKey:AWS_SECRET_KEY,\n    Bucket: S3_BUCKET,\n    urlPattern: generateUrlRegexNamespace('image\\/')\n  });\n\n  endpointGetNormalizedImageInfo({\n    app:app,\n    accessKeyId:AWS_ACCESS_KEY,\n    secretAccessKey:AWS_SECRET_KEY,\n    Bucket: S3_BUCKET,\n    userTemplates:userTemplates,\n    urlPattern: ensureLeadingSlash(`${nameSpace}/get_normalized_image_info`)\n  });\n  endpointGetS3SignedUploadUrl({\n    app:app,\n    accessKeyId:AWS_ACCESS_KEY,\n    secretAccessKey:AWS_SECRET_KEY,\n    Bucket: S3_BUCKET,\n    urlPattern: ensureLeadingSlash(`${nameSpace}/get_s3_signed_upload_url`)\n  });\n\n  endpointIframeUpload({\n    app:app,\n    accessKeyId:AWS_ACCESS_KEY,\n    secretAccessKey:AWS_SECRET_KEY,\n    Bucket: S3_BUCKET,\n    urlPattern: ensureLeadingSlash(`${nameSpace}/uploadsimple`)\n  });\n\n  app.get(ensureLeadingSlash(`${nameSpace}/get_template_list`), (req, res) => {\n    console.log('req',req)\n    console.log('get_template_list',userTemplates)\n    respondWithJson({\n      res,\n      userTemplates,\n    });\n  });\n\n\n\n\n  // require('./js/passportStuff')({\n  //   app:app\n  // });\n  // app.listen(3000);\n\n\n\n\n\n\n\n\n\n\n  app.post(ensureLeadingSlash(`${nameSpace}/SimpleImage`),function(req, res){\n    var data = req.body;\n    mongooseStuff.simpleimage(data.url, data.idX).then(function() {\n      res.send({\n          status:\"success\"\n      })\n    })\n  })\n\n  app.post(ensureLeadingSlash(`${nameSpace}/ComplexImage`), function(req, res){\n      var data = req.body;\n\n      mongooseStuff.ComplexImage(data).then(function(result){\n        res.send({\n            status:\"success\",\n            result:result,\n            payload:data\n        })\n      });\n  });\n\n  app.post(ensureLeadingSlash(`${nameSpace}/GetComplexImage`), function(req, res){\n      var data = req.body.data;\n      mongooseStuff.GetComplexImage('asdf').then(function(result){\n        res.send({\n            status:\"success\",\n            result:result\n        })\n      });\n  });\n\n  app.post(ensureLeadingSlash(`${nameSpace}/UpdateComplexImage`), function(req, res){\n      var data = req.body;\n      mongooseStuff.UpdateComplexImage(data).then(function(result){\n        res.send({\n            status:\"success\",\n            result:result\n        })\n      });\n  });\n\n\n\n\n  // GetComplexImage\n  // mongooseStuff.ComplexImage({url:'asdf'}).always(function(arguments){\n  //    console.log('ComplexImage',arguments)\n  //  })\n\n  // mongooseStuff.GetComplexImageAll().always(function(arguments){\n  //   console.log('ComplexImage',arguments)\n  // })\n   \n  mongooseStuff.GetUserTemplatesAll().always(function(data){\n    // console.log('GetUserTemplatesAll',data);\n    userTemplates = data;\n    // console.log('userTemplates',userTemplates)\n  })\n\n  if (appIsBrandNew) {\n    app.listen(port, (error) => {\n      if (error) {\n        console.error(error);\n      } else {\n        console.info(\n          ' Listening on port %s. Open up http://localhost:%s/ in your browser.',\n          port,\n          port,\n        );\n      }\n    });\n  }\n\n  return app;\n};\n\n\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/bernieExpressServer.js","var jD = require('jquery-deferred');\nvar prepareModuleWithDefaults = require('./prepareModuleWithDefaults');\nvar Busboy = require('busboy');\n\nmodule.exports = prepareModuleWithDefaults(function(req){\n  var dfd = jD.Deferred();\n\n  var filenameDfd = jD.Deferred();\n  var busboy = new Busboy({ headers: req.headers });\n  var busboy = new Busboy({ headers: req.headers });\n  var bufferArray = [];\n  var filenamex;\n  var toResolve = {\n    Body: []\n  };\n  busboy.on('file', function(fieldname, file, filename, encoding, mimetype) {\n    // console.log('File [' + fieldname + ']: filename: ' + filename + ', encoding: ' + encoding + ', mimetype: ' + mimetype);\n    toResolve.filename = filename;\n\n    file.on('data', function(data) {\n      // console.log('File [' + fieldname + '] got ' + data.length + ' bytes',data);\n      toResolve.Body.push(data);\n\n    });\n    // file.on('end', function() {\n    //   console.log('File [' + fieldname + '] Finished');\n    // });\n  });\n  // busboy.on('field', function(fieldname, val, fieldnameTruncated, valTruncated, encoding, mimetype) {\n  //   console.log('Field [' + fieldname + ']: value: ' + inspect(val));\n  // });\n  busboy.on('finish', function() {\n    toResolve.Body = Buffer.concat(toResolve.Body);\n    // console.log('Done parsing form!',Body);\n    dfd.resolve(toResolve);\n  });\n  req.pipe(busboy);\n  \n  return dfd.promise();\n\n  /*\n  var data = [];\n  req.on('data', function(chunk) {\n      data.push(chunk);\n  });\n  var endDfd = jD.Deferred();\n  req.on('end', function(x) {\n    console.log('end')\n    console.log(data)\n      var Body = Buffer.concat(data);\n      // console.log(Body)\n      endDfd.resolve({\n        body: data\n      });\n  });\n  req.on('error', function(err) {\n      endDfd.reject(err);\n  });\n  */\n});\n\n\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/apiRequestIntoBufferData.js","module.exports = function(cropSettings,userPhotoWidthHeight){\n  var limit = 1200;\n  // var scale = overlaySettings.scale;\n  var cropWidth = cropSettings.width;\n  var cropHeight = cropSettings.height;\n  var cropTop = cropSettings.top;\n  var cropLeft = cropSettings.left;\n  var cropRight = cropLeft + cropWidth;\n  var cropBottom = cropTop + cropHeight;\n  var rawWidth = userPhotoWidthHeight.width;\n  var rawHeight = userPhotoWidthHeight.height;\n  var rawRight = rawWidth;\n  var rawBottom = rawHeight;\n  var rawTop = 0;\n  var rawLeft = 0;\n\n  var s = {};\n\n  \n  s.extract = {\n    left: cropLeft > 0 ? cropLeft : 0,\n    top: cropTop > 0 ? cropTop : 0,\n  };\n  s.extract.width = cropRight < rawRight ? cropRight : rawRight;\n  s.extract.width =  s.extract.width - s.extract.left;\n  s.extract.width = s.extract.width > 0 ? s.extract.width : 0;\n  s.extract.height = cropBottom < rawBottom ? cropBottom : rawBottom;\n  s.extract.height =  s.extract.height - s.extract.top;\n  s.extract.height = s.extract.height > 0 ? s.extract.height : 0;\n\n\n\n  s.extend = {\n    left: cropLeft < 0 ? -cropLeft : 0,\n    top: cropTop < 0 ? -cropTop : 0,\n    right: cropRight > rawRight ? cropRight - rawRight : 0,\n    bottom: cropBottom > rawBottom ? cropBottom - rawBottom : 0\n  };\n  \n  s.resize = {\n    width:1200,\n    height:1200\n  }\n\n  s.completelyOutOfBound = false;\n  if(\n    (\n      s.extract.left >= rawRight ||\n      s.extract.top >= rawBottom ||\n      s.extend.left >= cropWidth ||\n      s.extend.top >= cropHeight\n    )\n  ){\n    s.completelyOutOfBound = true;\n  }\n  s.extract = s.extract.width && s.extract.height ? s.extract : null;\n  s.extend = s.extend.left || s.extend.top || s.extend.bottom || s.extend.right ? s.extend : null;\n  s.limit = limit;\n  return s;\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/calcOverlayAndTemplateProcessingSettings.js","var sharp = require('sharp');\nvar jD = require('jquery-deferred');\nvar calcOverlayAndTemplateProcessingSettings = require('./calcOverlayAndTemplateProcessingSettings');\nmodule.exports = function(overlaySettings,responses){\n  var dfd = jD.Deferred();\n  var templateFetchResponse = responses.template;\n  var userPhotoFetchResponse = responses.userPhoto;\n  var args = Array.prototype.slice.call(arguments);  \n  var userPhoto = sharp(userPhotoFetchResponse.data.Body);\n  userPhoto.metadata().then(function(metadata) {\n    var imageProcessingSettings = calcOverlayAndTemplateProcessingSettings(overlaySettings,metadata);\n    var s = imageProcessingSettings;\n    if(s.completelyOutOfBound){\n      var template = sharp(templateFetchResponse.data.Body);\n      template.resize(s.limit, s.limit).min().max();\n      template.background('white').flatten().jpeg().toBuffer().then(function(templateBuffer){\n        dfd.resolve({\n          Body: templateBuffer,\n        });\n      });\n    } else {\n      if(s.extract){\n        userPhoto.extract(s.extract);\n      }\n      if(s.extend){\n        userPhoto.extend(s.extend);\n      }\n\n      userPhoto.background('white').flatten().toBuffer().then(function(userPhotoBuffer){\n        var userPhoto = sharp(userPhotoBuffer);\n        userPhoto.resize(1200,1200);\n        var template = sharp(templateFetchResponse.data.Body);\n        template.resize(1200, 1200).min().max();\n        template.toBuffer().then(function(templateBuffer){\n          userPhoto.overlayWith(templateBuffer, {\n            top: 0,\n            left: 0\n          });\n          userPhoto.jpeg().toBuffer().then(function(userPhotoBuffer){\n            dfd.resolve({\n              Body: userPhotoBuffer,\n            });\n          });\n        });\n      })       \n    }    \n    return userPhoto\n  });\n  return dfd.promise();\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/createCompositeBuffer.js","var jD = require('jquery-deferred');\nvar aws = require('aws-sdk');\nvar prepareModuleWithDefaults = require('./prepareModuleWithDefaults');\n\n\n\nmodule.exports = prepareModuleWithDefaults(function(s){\n  var dfd = jD.Deferred();\n  s = Object.assign({},s);\n  aws.config.update({accessKeyId: s.accessKeyId , secretAccessKey: s.secretAccessKey });\n  var s3 = new aws.S3();\n  \n  //toPass.uploadRequestSettings.originalFilename\n  if(s.Key){\n    s3.deleteObjects(\n      {\n        Bucket: s.Bucket,\n        Delete: {\n            Objects: [\n                 { Key: s.Key }\n            ]\n        }\n      }, function(err, data) {\n          if (err){\n            dfd.reject(err);\n          } else {\n            dfd.resolve(data);\n          }\n      }\n    );\n  } else {\n    console.log('NOTHING TO DELETE');\n    dfd.resolve({msg:'Missing key, nothing deleted.'});\n  }\n  return dfd.promise();\n});\n\n\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/deleteS3Object.js","import aws from 'aws-sdk';\nimport {parse as parseUrl} from 'url';\nimport ensureLeadingSlash from '@defualt/ensure-leading-slash';\nimport getAllS3Objects from './getAllS3Objects';\nimport getS3ObjectData from './getS3ObjectData';\nimport createCompositeBuffer from './createCompositeBuffer';\n\nvar parseClientCompositeImageUrl = function(url){\n  var pathnameSplit = parseUrl(url).pathname.split('/').splice(2,2);\n  var compositeS3Key = 'consolidated/' + pathnameSplit.join('/');\n  var templateFilename = pathnameSplit[0];\n  var userImageAndScalePos = pathnameSplit[1];\n  userImageAndScalePos = userImageAndScalePos.split('_');\n  var userImageFilename = userImageAndScalePos;\n  var scalePos = userImageFilename.splice(-4,4);\n  scalePos[3] = scalePos[3].split('.');\n  scalePos[3].pop();\n  scalePos[3] = scalePos[3].join('.');\n  var overlaySettings = {\n    width: +scalePos[0] == scalePos[0] ? +scalePos[0] : 100,\n    height: +scalePos[1] == scalePos[1] ? +scalePos[1] : 100,\n    left: +scalePos[2] == scalePos[2]? +scalePos[2] : 0,\n    top: +scalePos[3] == scalePos[3]? +scalePos[3] : 0,\n  };\n  userImageFilename = userImageFilename.join('_');\n  return {\n    userImageFilename: userImageFilename,\n    templateFilename: templateFilename,\n    overlaySettings: overlaySettings,\n    compositeS3Key:compositeS3Key\n  };\n};\nexport default ({app,accessKeyId,secretAccessKey,Bucket,urlPattern}) => {\n  app.get(urlPattern, function(req, res) {\n    var compositeImageInstructions = parseClientCompositeImageUrl(req.url);\n    var s = compositeImageInstructions;\n    getS3ObjectData({\n      Key:s.compositeS3Key,\n      resolveNullOn404:true,\n      accessKeyId:accessKeyId,\n      secretAccessKey:secretAccessKey,\n      Bucket: Bucket\n    }).then(function(data){\n      if(!data){\n        console.log('COMPOSITE IMAGE DOES NOT EXIST');\n        \n        getAllS3Objects({\n          dict:{\n            template:{\n              Key:'decorations/' + s.templateFilename + '.png'\n            },\n            userPhoto:{\n              Key:'selfies/' + s.userImageFilename + '.png',\n              retrySearchCriteria:{\n                Prefix:'res/dthvwwocq/image/upload/bernie/'+s.userImageFilename,\n                Bucket: 'cloudinary-bernie-backup'\n              }\n            }\n          },\n          Bucket:Bucket,\n          accessKeyId: accessKeyId,\n          secretAccessKey: secretAccessKey\n        })\n        .then(createCompositeBuffer.bind(null,s.overlaySettings))\n        .then(function(bufferData){\n          res.setHeader('content-type', 'image/jpeg');\n          res.write(bufferData.Body,'binary');\n          res.end(null, 'binary');\n\n          aws.config.update({accessKeyId: accessKeyId , secretAccessKey: secretAccessKey });\n          var s3 = new aws.S3(); \n          s3.putObject(\n            {\n                Bucket: Bucket,\n                Key: s.compositeS3Key,\n                Body: bufferData.Body,\n                ContentType: 'image/jpeg',\n                ACL: 'public-read'\n            },\n            function(err, data) {\n                if (err) {\n                    // Failed saving to S3\n                    log.error('Failed saving to S3', err);\n                }\n            }\n          );\n        });\n      } else {\n        console.log('COMPOSITE IMAGE DOES IN FACT EXIST !!!!');\n        res.setHeader('content-type', data.ContentType);\n        res.write(data.Body,'binary');\n        res.end(null, 'binary');\n      }\n    });\n  });\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/endpointCompositeImage.js","/*\n * Respond to GET requests to /get_normalized_image_info.\n * changes size of image if it is too big\n * also rotates exif\n * responds with a new image url\n*/\nimport aws from 'aws-sdk';\nimport jD from 'jquery-deferred';\nimport { x as mongooseStuff } from './mongooseStuff';\n\nexport default ({accessKeyId,secretAccessKey,Bucket,app,userTemplates, urlPattern}) => {\n  var urlToFileData = require('./urlToFileData');\n  var uploadToS3 = require('./uploadToS3')({\n    prepareModuleWithDefaults: true,\n    accessKeyId:accessKeyId,\n    secretAccessKey:secretAccessKey,\n    Bucket:Bucket\n  });\n\n  var parseUrl = require('url').parse;\n\n  var normalizeImageFileData = require('./normalizeImageFileData')({\n    prepareModuleWithDefaults: true,\n    parseSettings: function(s){\n      var filename;\n      var originalFilename;\n      var url;\n      if(s.originalUrl.indexOf('amazonaws.com/') !== -1){\n        var host = s.originalUrl.split('amazonaws.com/');\n        host = host[0] + 'amazonaws.com/';\n        filename = s.originalUrl.split('amazonaws.com/');\n        originalFilename = filename[filename.length - 1];\n        filename = originalFilename.replace('_temp','');\n        filename = filename.split('.');\n        filename = filename[filename.length - 2];\n        filename = filename + '.png';\n        url = host + filename;\n      } else {\n        filename = parseUrl(s.originalUrl).pathname.split('/');\n        filename = filename[filename.length - 1];\n        filename = filename.split('.');\n        filename.pop();\n        filename = filename.join('.');\n        filename = filename + Date.now() + '.png';\n        filename = 'selfies/' + filename;\n        originalFilename = null;\n        url = '//s3-us-west-1.amazonaws.com/bernieapp/' + filename;\n      }\n      s.filename = filename;\n      s.url = url;\n      s.originalFilename = originalFilename;\n      return s;\n    }\n  });\n  var deep = require('deep-get-set');\n  var deleteS3Object = require('./deleteS3Object')({\n    prepareModuleWithDefaults: true,\n    parseSettings: function(s){\n      s.Key = deep(s,'originalFilename');\n      return s;\n    },\n    accessKeyId: accessKeyId,\n    secretAccessKey: secretAccessKey,\n    Bucket: Bucket\n  });\n\n  app.get(urlPattern, function(req, res){  \n    var originalUrl = decodeURIComponent(req.query.image_url);\n    var mustBeSquare = req.query.must_be_square === 'true';\n\n    var respondWithJsonSuccess = require('./respondWithJson')({\n      prepareModuleWithDefaults: true,\n      res:res,\n      isSuccess:true\n    });\n    var respondWithJsonFail = require('./respondWithJson')({\n      prepareModuleWithDefaults: true,\n      res:res,\n      isSuccess:false\n    });\n    var promise = urlToFileData(originalUrl).then(normalizeImageFileData);\n    var promises = [\n      promise,\n      promise.then(deleteS3Object),\n      promise.then(function(fileData){\n        if(mustBeSquare && (Math.abs(fileData.width - fileData.height) > 1)){\n          var dfd = jD.Deferred();\n          dfd.resolve({\n            failingSquare:true\n          });\n          return dfd.promise();\n        } else {          \n          var uploadToS3Promise = this.then(uploadToS3);\n          uploadToS3Promise.then(function(){\n            if(mustBeSquare){\n              var userTemplateModel = {\n                created: new Date(),\n                customTemplate: fileData.Key.replace('selfies/','').replace('.png',''),\n                templateHeight: fileData.height,\n                templateWidth: fileData.width\n              };\n              userTemplates.push(userTemplateModel);\n              mongooseStuff.MakeUserTemplate(userTemplateModel);\n            }\n          });\n          return uploadToS3Promise;\n        }\n      }).then(respondWithJsonSuccess)\n\n    ];\n    jD.when.apply(null,promises).then(null,function(err){\n      respondWithJsonFail({error:err})\n    });\n  });\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/endpointGetNormalizedImageInfo.js","/*\n * Respond to GET requests to /get_normalized_image_info.\n * changes size of image if it is too big\n * also rotates exif\n * responds with a new image url\n*/\nimport aws from 'aws-sdk';\nimport ensureLeadingSlash from '@defualt/ensure-leading-slash';\nimport respondWithJson from './respondWithJson';\n\nexport default ({\n  app,\n  accessKeyId,\n  secretAccessKey,\n  Bucket,\n  urlPattern\n}) => {\n  // Generates a unique aws url that the client uploads an image to.  Neat.\n  app.get(urlPattern, function(req, res){\n    aws.config.update({accessKeyId: accessKeyId , secretAccessKey: secretAccessKey });\n    var s3 = new aws.S3(); \n    var filename = req.query.file_name;\n    filename = filename.split('.');\n    var secondToLast = filename[filename.length - 2];\n    filename[filename.length - 2] = secondToLast + Date.now()+'_temp';\n    filename = filename.join('.');\n    var s3_params = { \n        Bucket: Bucket, \n        Key: filename, \n        Expires: 60, \n        ContentType: req.query.file_type, \n        ACL: 'public-read'\n    }; \n\n    s3.getSignedUrl('putObject', s3_params, function(err, data){ \n      respondWithJson({\n        res:res,\n        signed_request: err || data,\n        url: 'https://'+Bucket+'.s3.amazonaws.com/'+filename \n      });\n    });\n  });\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/endpointGetS3SignedUploadUrl.js","import ensureLeadingSlash from '@defualt/ensure-leading-slash';\nexport default ({app,accessKeyId,secretAccessKey,Bucket, urlPattern}) => {\n  app.post(urlPattern, function(req, res, next) {\n    var parseUrl = require('url').parse;\n    var normalizeImageFileData = require('./normalizeImageFileData')({\n      prepareModuleWithDefaults: true,\n      parseSettings: function(s){\n        var filename = s.filename;\n        // filename = parseUrl(s.originalUrl).pathname.split('/');\n        // filename = filename[filename.length - 1];\n        filename = filename.split('.');\n        filename.pop();\n        filename = filename.join('.');\n        filename = filename + Date.now() + '.png';\n        filename = 'selfies/' + filename;\n        s.url = '//s3-us-west-1.amazonaws.com/bernieapp/' + filename;\n        s.filename = filename;\n        return s;\n      }\n    });\n    var uploadToS3 = require('./uploadToS3')({\n      prepareModuleWithDefaults: true,\n      accessKeyId:accessKeyId,\n      secretAccessKey:secretAccessKey,\n      Bucket: Bucket\n    });\n    var apiRequestIntoBufferData = require('./apiRequestIntoBufferData');\n    apiRequestIntoBufferData(req).then(normalizeImageFileData).then(uploadToS3).then(function(r){\n      var details = {\n        url:r.url\n      };\n      app.render('iframeuploadbutton.html',{\n        lastData:{\n            width: r.width,\n            height: r.height,\n            public_id:r.Key.replace('selfies/',''),\n            url:r.url\n        },\n        buttonText:decodeURIComponent(req.query.buttonText)\n      },function(err, html){\n        res.end(html);\n      });\n    });\n  });\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/endpointIframeUpload.js","module.exports = function(standardModes){\n  if(typeof standardModes === 'string'){\n    standardModes = [standardModes];\n  }\n  var pipedString = ''\n  for(var i =0,l=standardModes.length;i<l;i++){\n    var mode = standardModes[i];\n    pipedString += i > 0 ? '|' + mode : mode;\n\n  }\n  var regx = new RegExp('^/('+pipedString+')(.+)');;\n  return regx;\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/generateUrlRegexNamespace.js","var aws = require('aws-sdk');\nvar jD = require('jquery-deferred');\nvar getS3ObjectData = require('./getS3ObjectData');\nmodule.exports = function(s){\n  var dfdMain = jD.Deferred();\n  var promises = [];\n  aws.config.update({accessKeyId: s.accessKeyId , secretAccessKey: s.secretAccessKey });\n  var s3 = new aws.S3();\n  for(var entryName in s.dict){\n    var entry = s.dict[entryName];\n    var filename = entry.Key;\n    (function(entryName,filename,entry){\n      var entryDfd = jD.Deferred();\n      getS3ObjectData({\n        Key:filename,\n        outputParser:function(data){\n          return {\n            entryName:entryName,\n            filename:filename,\n            data:data,\n          };\n        },\n        accessKeyId:s.accessKeyId,\n        secretAccessKey:s.secretAccessKey,\n        Bucket: s.Bucket\n      })\n      .then(entryDfd.resolve)\n      .fail(function(originalErr){\n        if(entry.retrySearchCriteria){\n          var retryBucket = entry.retrySearchCriteria.Bucket ? entry.retrySearchCriteria.Bucket : s.Bucket\n          var aws = require('aws-sdk');\n          aws.config.update({accessKeyId: s.accessKeyId , secretAccessKey: s.secretAccessKey });\n          var s3 = new aws.S3(); \n          var params = {\n            Bucket: retryBucket,\n            Prefix: entry.retrySearchCriteria.Prefix\n          };\n          s3.listObjectsV2(params, function(err, data) {\n            if(err){\n              entryDfd.reject(err);\n            } else {\n              if(data.Contents && data.Contents[0]){\n                getS3ObjectData({\n                  Key:data.Contents[0].Key,\n                  outputParser:function(data){\n                    return {\n                      entryName:entryName,\n                      filename:filename,\n                      data:data,\n                    };\n                  },\n                  accessKeyId:s.accessKeyId,\n                  secretAccessKey:s.secretAccessKey,\n                  Bucket:retryBucket\n                })\n                .then(function(){\n                  var args = arguments;\n                  var normalizeImageFileData = require('./normalizeImageFileData')({\n                    prepareModuleWithDefaults: true,\n                    filename: filename,\n                    parseSettings: function(s){\n                      s.Body = s.data.Body;\n                      return s;\n                    }\n                  });\n                  var uploadToS3 = require('./uploadToS3')({\n                    prepareModuleWithDefaults: true,\n                    accessKeyId:s.accessKeyId,\n                    secretAccessKey:s.secretAccessKey,\n                    Bucket:s.Bucket,\n                  });\n                  this.then(normalizeImageFileData).then(uploadToS3).always(function(){\n                    entryDfd.resolve.apply(null,args);\n                  });\n                  return this;\n                })\n                .fail(entryDfd.reject);\n              } else {\n                entryDfd.reject(originalErr);\n              }\n            }\n          });\n        } else {\n          entryDfd.reject(originalErr);\n        }\n      });\n      promises.push(entryDfd.promise());\n    })(entryName,filename,entry);\n  }\n\n  jD.when.apply(null,promises).done(function ( templateFetchResponse, userPhotoFetchResponse) {\n    var args = Array.prototype.slice.call(arguments);\n    var output = {};\n    for(var i=0,l=args.length;i<l;i++){\n      var entryName = args[i].entryName;\n      delete args[i].Key;\n      output[entryName] = args[i];\n    }\n    dfdMain.resolve(output);\n  }).then(null,function(err){\n    dfdMain.reject(err);\n  });\n  return dfdMain.promise();\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/getAllS3Objects.js","var jD = require('jquery-deferred');\nmodule.exports = function(originalUrl){\n  var isHttps = originalUrl.indexOf('https://') !== -1;\n  var url = require('url');\n  \n  var dfd = jD.Deferred();\n  var options = url.parse(originalUrl);\n  var http;\n  if(isHttps){\n    http = require('https');\n  } else {\n    http = require('http');\n  }\n\n  http.get(options, function (response) {\n    var chunks = [];\n    response.on('data', function (chunk) {\n      chunks.push(chunk);\n    }).on('end', function() {\n      var buffer = Buffer.concat(chunks);\n      var contentType = response.headers['content-type'];\n      dfd.resolve({\n        Body: buffer,\n        ContentType: contentType,\n        originalUrl: originalUrl\n      })\n    }).on('error', (e) => {\n      dfd.reject(e);\n    });\n  });\n\n  return dfd.promise();\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/urlToFileData.js",";var mymoduleName = 'mymodule';\n\n\nvar templateBaseUrl = 'http://s3-us-west-1.amazonaws.com/bernieapp/decorations/';\n\nvar rawImagePrefix = 'http://s3-us-west-1.amazonaws.com/bernieapp/selfies/';\n\n\nvar isNode= (function(){\n\tvar isNode = false;    \n\tif (typeof process === 'object') {\n\t  if (typeof process.versions === 'object') {\n\t    if (typeof process.versions.node !== 'undefined') {\n\t      isNode = true;\n\t    }\n\t  }\n\t}\n\treturn isNode;\n})();\n\n;(function(exports){\n\n\tvar standardModes = [\n\t\t{\n\t\t\tmode:'f',\n\t\t\tfeatured:false,\n\t\t\told:true\n\t\t},\n\t\t{\n\t\t\tmode:'ut',\n\t\t\tfeatured:false\n\t\t},\n\t\t{\n\t\t\tmode:'b',\n\t\t\tfeatured:false,\n\t\t\told:true\n\t\t},\n\t\t{\n\t\t\tmode:'h',\n\t\t\tfeatured:false,\n\t\t\told:true\n\t\t},\n\t\t{\n\t\t\tmode:'selfie',\n\t\t\tfeatured:false,\n\t\t\told:true\n\t\t},\n\t\t{\n\t\t\tmode:'h3',\n\t\t\tfeatured:true\n\t\t},\n\t\t{\n\t\t\tmode:'h4',\n\t\t\tfeatured:true\n\t\t},\n\t\t{\n\t\t\tmode:'wg',\n\t\t\tfeatured:true\n\t\t}\n\t];\n\texports.standardModes = standardModes;\n\texports.getStandardModesRegex = function(nameSpace){\n\t\tvar pipedString = ''\n\t\tfor(var i =0,l=exports.standardModes.length;i<l;i++){\n\t\t\tvar mode = exports.standardModes[i].mode;\n\t\t\tmode = nameSpace ? (nameSpace + '\\/' + mode) : mode;\n\t\t\tconsole.log('mode',mode);\n\t\t\tpipedString += i > 0 ? ('|' + mode) : mode;\n\n\t\t}\n\t\treturn new RegExp('^[/]('+pipedString+')[/](.+)');\n\t};\n\n\texports.oldModes = (function(){\n\t\tvar a = []\n\t\tfor(var i =0,l=exports.standardModes.length;i<l;i++){\n\t\t\tif(!!exports.standardModes[i].old){\n\t\t\t\ta.push(exports.standardModes[i]);\n\t\t\t}\n\t\t}\n\t\treturn a;\n\t})();\n\n\texports.isOldMode = function(toCompare){\n\t\tvar is = false;\n\t\tfor(var i =0,l=exports.oldModes.length;i<l;i++){\n\t\t\tis = is || toCompare === exports.oldModes[i].mode;\n\t\t}\n\t\treturn is;\n\t};\n\n\tvar containsStardardModeCache = {};\n\texports.containsStardardMode = function(url){\n\t\tvar contains = false;\n\t\tif(typeof containsStardardModeCache[url] === 'undefined'){\n\t\t\tfor(var i =0,l=exports.standardModes.length;i<l;i++){\n\t\t\t\tvar mode = exports.standardModes[i].mode;\n\t\t\t\tcontains = contains || url.indexOf(mode) !== -1;\n\t\t\t}\n\t\t\tcontainsStardardModeCache[url] = contains;\n\t\t}\n\t\treturn containsStardardModeCache[url];\n\t};\n\n\t\n\n\tvar DeriveUrlInfo = function({pathname,offline,nameSpace}){\n\t\tthis.init({pathname,offline,nameSpace})\n\t\t\n\t\t\n\t};\n\tDeriveUrlInfo.prototype.init = function({pathname,offline,nameSpace}){\n\t\tthis.nameSpace = nameSpace;\n\t\tthis.nameSpaceWithLeadingSlash = nameSpace ? `/${nameSpace}` : '';\n\t\tvar nameSpaceWithLeadingSlash = this.nameSpaceWithLeadingSlash;\n\t\tthis.offline = offline;\n\t\tvar defaultPathname = '/h3/zephyr1476401787491/180_3_218_218_553_553/';\n\t\tpathname = !!pathname !== 0 ? pathname : defaultPathname;\n\t\tpathname = pathname === nameSpaceWithLeadingSlash || pathname === nameSpaceWithLeadingSlash + '/' ? defaultPathname : pathname;\n\t\tif (pathname && pathname.indexOf(this.nameSpaceWithLeadingSlash) === 0) {\n\t\t\tpathname = pathname.replace(this.nameSpaceWithLeadingSlash, '');\n\t\t}\n\t\tpathname = pathname ? pathname : defaultPathname;\n\n\t\tthis.slashSplit = pathname.split('/');\n\t\tif(pathname.indexOf('/f/') === 0){\n\t\t\tthis.idX = this.slashSplit[4];\n\t\t\tthis.customTemplate = this.slashSplit[2];\n\t\t} else if(pathname.indexOf('/selfie/') === 0){\n\t\t\tpathname = '/selfie/v1438476536/bernie/' + this.slashSplit[4];\n\t\t\tthis.slashSplit = pathname.split('/');\n\t\t\tthis.idX = this.slashSplit[4];\n\t\t\tthis.customTemplate = 'i4hiodnsy2yaqavpowm1';\n\t\t} else {\n\t\t\t//pathname.indexOf('/h/') === 0\n\t\t\t//pathname.indexOf('/h3/') === 0\n\t\t\tthis.idX = this.slashSplit[2];\n\t\t}\n\n\t\tif(pathname.indexOf('/ut/') === 0){\n\t\t\tthis.customTemplate = this.slashSplit[4];\n\t\t}\n\n\t\tif(pathname.indexOf('/h/') === 0){\n\t\t\tthis.customTemplate = 'hairglasses';\n\t\t}\n\n\t\tthis.pathname = this.nameSpaceWithLeadingSlash + pathname;\n\t\tconsole.log('this.slashSplit',this.slashSplit);\n\t\tthis.coords = this.slashSplit[3].split('_');\n\n\t\tfor(var i=0,l=this.coords.length;i<l;i++){\n\t\t\tthis.coords[i] = +this.coords[i];\n\t\t}\n\n\t\tthis.dims = this.coords.splice(4,2);\n\t\tthis.width = +this.dims[0];\n\t\tthis.height = +this.dims[1];\n\t\tthis.x = this.coords[0];\n\t\tthis.y = +this.coords[1];\n\t\tthis.cropWidth = this.coords[2];\n\t\tthis.cropHeight = this.coords[3];\n\t\t\n\t\tthis.format = '.jpg';\n\n\t\tthis.customUrl = '';\n\t\tthis.customUrlQueryString = '';\n\t\tthis.makeCustomUrl({\n\n\t\t});\n\t};\n\tDeriveUrlInfo.prototype.normalize = function(val,def){\n\t\tdef = typeof def !== 'undefined' ? def : true;\n\t\tval = typeof val !== 'undefined' ? val : def;\n\t\tif(typeof def === 'number'){\n\t\t\tval = typeof val === 'string' ? +val : val;\n\t\t\tval = !isNaN(val) ? val : def;\n\t\t\tval = Math.round(val);\n\t\t}\n\t\t\n\t\treturn val;\n\t}\n\tDeriveUrlInfo.prototype.doubleNormalize = function(val,prexisting,def){\n\t\tvar def = this.normalize(prexisting,def);\n\t\treturn this.normalize(val,def);\n\t}\n\tDeriveUrlInfo.prototype.doubleNormalizeInterface = function(dest,options,defaults){\n\t\tfor(var name in defaults){\n\t\t\tvar def = defaults[name];\n\t\t\tdest[name] = this.doubleNormalize(options[name],dest[name],def);\n\t\t}\n\t};\n\n\tDeriveUrlInfo.prototype.makeCustomUrl = function(settings){\n\t\tvar mode = this.slashSplit[1].toLowerCase();\n\t\t\n\t\tvar toNormalize = {\n\t\t\t'x':mode !== 'selfie' ? 0 : 142,\n\t\t\t'y':mode !== 'selfie' ? 0 : 98,\n\t\t\t'cropWidth':mode !== 'selfie' ? 1200 : 305,\n\t\t\t'cropHeight':mode !== 'selfie' ? 1200 : 305,\n\t\t\t'width':1200,\n\t\t\t'height':1200,\n\t\t\t'idX':'zephyr1476401787491.png',\n\t\t\t'mode':mode\n\t\t};\n\t\tif(!!settings.customTemplate){\n\t\t\ttoNormalize.customTemplate = settings.customTemplate;\n\t\t}\n\t\tthis.doubleNormalizeInterface(this,settings,toNormalize);\n\t\tthis.idX = this.idX.split('.');\n\t\tif(this.idX.length > 1){\n\t\t\tthis.idX.pop();\n\t\t}\n\t\tthis.idX = this.idX.join('.');\n\t\tthis.rawImage = rawImagePrefix + this.idX;\n\t\tthis.rawImage = !!this.offline ? '/images/mock-selfie-raw.jpg' : this.rawImage;\n\t\tif(this.rawImage.indexOf('.') === -1){\n\t\t\tthis.rawImage += '.png';\n\t\t}\n\t\tif(this.mode === 'f' || this.mode === 'selfie'){\n\t\t\tthis.customTemplate = 'wg';\n\t\t\tthis.doStandardSquare();\n\t\t}else{\n\t\t\tthis.doStandardSquare()\n\t\t}\n\t};\n\tDeriveUrlInfo.prototype.serialize = function(obj, prefix) {\n\t\tif(typeof obj !== 'object'){\n\t\t\tobj = {whatever:obj};\n\t\t}\n\t    var str = [];\n\t    for (var p in obj) {\n\t        if (obj.hasOwnProperty(p)) {\n\t            var k = prefix ? prefix + \"[\" + p + \"]\" : p,\n\t                v = obj[p];\n\t            str.push(typeof v == \"object\" ?\n\t                serialize(v, k) :\n\t                encodeURIComponent(k) + \"=\" + encodeURIComponent(v));\n\t        }\n\t    }\n\t    str = str.join(\"&\");\n\t    str = str.replace('whatever=','')\n\t    return str;\n\t};\n\n\tDeriveUrlInfo.prototype.doStandardSquare = function(){\n\t\tthis.pathname = '/'+this.mode+'/'+this.idX+'/'+this.x+'_'+this.y+'_'+this.cropWidth+'_'+this.cropHeight+'_'+this.width+'_'+this.height+'/'\n\t\tif(!!this.customTemplate && this.mode !== 'h'){\n\t\t\tthis.pathname += this.customTemplate + '/';\n\t\t}\n\t\t\n\t\tvar userPhotoKey = this.idX;\n\t\tuserPhotoKey = userPhotoKey.split('.');\n\t\tif(userPhotoKey.length > 1){\n\t\t\tuserPhotoKey.pop();\n\t\t}\n\t\tuserPhotoKey = userPhotoKey.join('.');\n\t\tuserPhotoKey = userPhotoKey;\n\t\t\n\t\tvar customUrlSettings = {\n\t\t\tcropWidth: this.cropWidth,\n\t\t\tcropHeight: this.cropHeight,\n\t\t\tx: this.x,\n\t\t\ty: this.y,\n\t\t\ttemplate:(!!this.customTemplate ? this.customTemplate : this.mode),\n\t\t\tuserPhotoKey: userPhotoKey\n\t\t};\n\t\tvar s = customUrlSettings;\n\n\t\tthis.customUrl = ('' +\n\t\t\t'/image/' + \n\t\t\ts.template +\n\t\t\t'/' +\n\t\t\ts.userPhotoKey +\n\t\t\t'_' + s.cropWidth + '_' + s.cropHeight + '_' + s.x + '_' + s.y + '.jpg' +\n\t\t'');\n\t\tthis.customUrl = !!this.offline ? '/images/mock-selfie.png' : this.customUrl;\n\t\tthis.customUrlQueryString = this.serialize(this.customUrl);\n\n\t\treturn this.customUrl;\n\t};\n\n\texports.generateTemplateImgListHtml = function(userTemplates,offline){\n\t\tvar imgsHtml = '';\n\t\tif(offline){\n\t\t\t;(function(){\n\t\t\t\tvar offlineTemplates = [\n                    {customTemplate:'/images/h3.png'},\n                    {customTemplate:'/images/h4.png'},\n                    {customTemplate:'/images/h3.png'}\n                ];\n\t            for(var i=0,l=offlineTemplates.length;i<l;i++){\n\t            \timgsHtml += '<div class=\"designFrame\">';\n\t            \t\timgsHtml += '<div class=\"designFrame_innerWrap\">';\n\t                \t\timgsHtml += '<img class=\"designFrame_design userTemplate\" src=\"'+offlineTemplates[i].customTemplate+'\">'\n\t            \t\timgsHtml += '</div>';\n\t            \timgsHtml += '</div>';\n\t            }\n\t            \n\t        })();\n\t\t}else{\n\t\t\t;(function(){\n\t            for(var i=0,l=standardModes.length;i<l;i++){\n\t                if(!!standardModes[i].featured){\n\t                \timgsHtml += '<div class=\"designFrame\">';\n\t\t                \timgsHtml += '<div class=\"designFrame_innerWrap\">';\n\t\t                    \timgsHtml += '<img class=\"designFrame_design standardTemplate\" src=\"' + templateBaseUrl +standardModes[i].mode+'.png\">';\n\t\t                \timgsHtml += '</div>';\n\t                \timgsHtml += '</div>';\n\t                }\n\t            }\n\t        })();\n\t        ;(function(){\n\t            for(var i=0,l=userTemplates.length;i<l;i++){\n\t            \timgsHtml += '<div class=\"designFrame\">';\n\t\t            \timgsHtml += '<div class=\"designFrame_innerWrap\">';\n\t\t                \timgsHtml += '<img class=\"designFrame_design userTemplate\" src=\"' + templateBaseUrl +userTemplates[i].customTemplate+'.png\">'\n\t\t            \timgsHtml += '</div>';\n\t            \timgsHtml += '</div>';\n\t            }\n\t            \n\t        })();\n        }\n        return imgsHtml;\n\t};\n\texports.deriveUrlInfo = function({pathname,offline,nameSpace}){\n\t\treturn new DeriveUrlInfo({pathname,offline,nameSpace});\n\t};\n\n})(typeof exports === 'undefined'? this[mymoduleName]={}: exports);\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/public/js/mymodule.js"],"sourceRoot":""}