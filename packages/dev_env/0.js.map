{"version":3,"sources":["webpack:///../bernieserver/bernieserver.express.js","webpack:///../ensure-leading-slash/ensure-leading-slash.js","webpack:///../bernieserver/js/prepareModuleWithDefaults.js","webpack:///../bernieserver/js/respondWithJson.js","webpack:///../bernieserver/js/normalizeImageFileData.js","webpack:///../bernieserver/js/uploadToS3.js","webpack:///../make-serve-chainable-express/make-serve-chainable-express.js","webpack:///../bernieserver/js/mongooseStuff.js","webpack:///../bernieserver/js/getS3ObjectData.js","webpack:///../bernieserver/bernieExpressServer.js","webpack:///../bernieserver/public/js/mymodule.js","webpack:///../bernieserver/js/endpointCompositeImage.js","webpack:///../bernieserver/js/getAllS3Objects.js","webpack:///../bernieserver/js/meldAndCropImages.js","webpack:///../bernieserver/js/calcOverlayAndTemplateProcessingSettings.js","webpack:///../bernieserver/js/endpointGetNormalizedImageInfo.js","webpack:///../bernieserver/js/urlToFileData.js","webpack:///../bernieserver/js/deleteS3Object.js","webpack:///../bernieserver/js/endpointGetS3SignedUploadUrl.js","webpack:///../bernieserver/js/endpointIframeUpload.js","webpack:///../bernieserver/js/apiRequestIntoBufferData.js","webpack:///../bernieserver/js/generateUrlRegexNamespace.js"],"names":["ensureLeadingSlash","str","replace","module","exports","fun","c","prepareModuleWithDefaults","Object","assign","parseSettings","r","Array","isArray","require","s","res","isSuccess","accessKeyId","secretAccessKey","status","statusCode","error","json","message","write","JSON","stringify","end","jD","sharp","parseUrl","parse","dfd","Deferred","buffer","Body","image","metadata","err","meta","reject","smallestDim","Math","min","width","height","largestDim","max","limit","multiplier","floor","resize","withoutEnlargement","rotate","toBuffer","outputBuffer","info","manipulatedImageFileData","Key","filename","ContentType","url","originalFilename","resolve","promise","aws","mime","extension","split","pop","lookup","config","update","s3","S3","s3Params","Bucket","ACL","putObject","data","uploadResponse","makeServeChainableExpress","serverLogic","app","port","nameSpace","appIsBrandNew","listen","console","mymoduleName","mongoose","uriUtil","mongooseStuff","MongooseStuff","self","mongodbUri","process","env","MONGOLAB_URI","ENVNAME","DATABASE_NAME","mongooseUri","formatMongoose","db","connection","models","SimpleImage","model","Schema","String","ComplexImage","Date","Number","UserTemplate","created","customTemplate","templateHeight","templateWidth","prototype","connect","readyState","options","server","socketOptions","keepAlive","connectTimeoutMS","replset","once","on","bind","checkUrl","idX","then","findOne","simpleimage","GetComplexImage","GetUserTemplatesAll","find","GetComplexImageAll","MakeUserTemplate","findOneAndUpdate","upsert","apply","arguments","UpdateComplexImage","newRecord","save","getImages","nuke","collection","drop","close","x","getObject","output","resolveNullOn404","outputParser","set","__dirname","engine","renderFile","use","static","join","AWS_ACCESS_KEY","AWS_SECRET_KEY","S3_BUCKET","get","req","render","pageName","urlInfo","deriveUrlInfo","userTemplates","buttonText","query","standardRouteHtmlHandler","urlToUse","pathname","offline","iframebutton","result","mymodule","getStandardModesRegex","images","urlPattern","post","body","send","payload","always","templateBaseUrl","rawImagePrefix","isNode","versions","node","standardModes","mode","featured","old","pipedString","i","l","length","log","RegExp","oldModes","a","push","isOldMode","toCompare","is","containsStardardModeCache","containsStardardMode","contains","indexOf","DeriveUrlInfo","init","nameSpaceWithLeadingSlash","defaultPathname","slashSplit","coords","dims","splice","y","cropWidth","cropHeight","format","customUrl","customUrlQueryString","makeCustomUrl","normalize","val","def","isNaN","round","doubleNormalize","prexisting","doubleNormalizeInterface","dest","defaults","name","settings","toLowerCase","toNormalize","rawImage","doStandardSquare","serialize","obj","prefix","whatever","p","hasOwnProperty","k","v","encodeURIComponent","userPhotoKey","customUrlSettings","template","generateTemplateImgListHtml","imgsHtml","offlineTemplates","parseClientCompositeImageUrl","pathnameSplit","compositeS3Key","templateFilename","userImageAndScalePos","userImageFilename","scalePos","overlaySettings","left","top","extname","fileTypes","fileType","compositeImageInstructions","templateCreateMode","getAllS3ObjectsSettingsDict","userPhoto","retrySearchCriteria","Prefix","dict","bufferData","setHeader","getS3ObjectData","dfdMain","promises","entryName","entry","entryDfd","fail","originalErr","retryBucket","params","listObjectsV2","Contents","args","normalizeImageFileData","uploadToS3","when","done","templateFetchResponse","userPhotoFetchResponse","slice","call","calcOverlayAndTemplateProcessingSettings","responses","templateCroppingMode","bgColor","g","b","alpha","imageProcessingSettings","completelyOutOfBound","responseToProcess","background","flatten","templateBuffer","extract","extend","userPhotoBuffer","png","overlayWith","jpeg","cropSettings","userPhotoWidthHeight","cropTop","cropLeft","cropRight","cropBottom","rawWidth","rawHeight","rawRight","rawBottom","rawTop","rawLeft","right","bottom","urlToFileData","originalUrl","host","now","deep","deleteS3Object","decodeURIComponent","image_url","mustBeSquare","must_be_square","respondWithJsonSuccess","respondWithJsonFail","fileData","abs","failingSquare","uploadToS3Promise","userTemplateModel","isHttps","http","response","chunks","chunk","Buffer","concat","contentType","headers","e","deleteObjects","Delete","Objects","msg","file_name","secondToLast","s3_params","Expires","file_type","getSignedUrl","signed_request","next","apiRequestIntoBufferData","details","lastData","public_id","html","Busboy","filenameDfd","busboy","bufferArray","filenamex","toResolve","fieldname","file","encoding","mimetype","pipe","regx"],"mappings":"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","file":"0.js","sourcesContent":["import serve from './bernieExpressServer';\n\nexport default serve;\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/bernieserver.express.js","function ensureLeadingSlash(str) {\n  return str.replace(/^\\/?/, '/');\n}\nexport default ensureLeadingSlash;\n\n\n\n// WEBPACK FOOTER //\n// ../ensure-leading-slash/ensure-leading-slash.js","module.exports = function(fun){\n  return function(c){\n    if(c.prepareModuleWithDefaults){\n      c = Object.assign({},c);\n      var parseSettings = null;\n      if(c.parseSettings){\n        parseSettings = c.parseSettings;\n        delete c.parseSettings;\n      }\n      delete c.prepareModuleWithDefaults;\n      return function(r){\n        if(typeof r === 'object' && !Array.isArray(r)){\n          r = Object.assign({},c,r);\n        }\n        \n        if(parseSettings){\n          r = parseSettings(r);\n        }\n        return fun(r);\n      };\n    } else {\n      return fun(c);\n    }\n  };\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/prepareModuleWithDefaults.js","var prepareModuleWithDefaults = require('./prepareModuleWithDefaults');\nmodule.exports = prepareModuleWithDefaults(function(s){\n\tvar res = s.res;\n\tvar isSuccess = typeof s.isSuccess === 'undefined' || !!s.isSuccess;\n\tdelete s.res;\n\tdelete s.isSuccess;\n\tdelete s.accessKeyId;\n\tdelete s.secretAccessKey;\n\tvar status = 200;//ok\n\tif(s.statusCode){\n\t\tstatus = s.statusCode;\n\t} else if(!isSuccess){\n\t\tstatus = 500;\n\t}\n\tstatus = status === 0 ? 500 : status;\n\t\n\tif(s.error){\n\t\t// res.write(s.error);\n\t\t// res.render('error', s.error);\n\t\tres.status(status).json({\n\t\t\tmessage:s.error.message,\n\t\t\terror:s.error.error\n\t\t})\n\t\t// res.json('error', {\n\t //        message: s.error.message,\n\t //        error: s.error\n\t //    });\n\t} else {\n\t\tres.status(status);\n\t\tres.write(JSON.stringify(s));\n\t}\n\t\n\tres.end();\n});\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/respondWithJson.js","var jD = require('jquery-deferred');\nvar sharp = require('sharp');\nvar prepareModuleWithDefaults = require('./prepareModuleWithDefaults');\nvar parseUrl = require('url').parse;\nmodule.exports = prepareModuleWithDefaults(function(s){\n  var dfd = jD.Deferred();\n  var buffer = s.Body;\n  var sharp = require('sharp');\n  var image = sharp(buffer);\n  image.metadata(function(err, meta){\n      if(err){\n        dfd.reject(err);\n      } else {\n        var smallestDim = Math.min(meta.width, meta.height);\n        var largestDim = Math.max(meta.width, meta.height);\n        var limit = 1200;\n\n        var multiplier = limit/smallestDim;\n        multiplier = multiplier < 1 ? multiplier : 1;\n        if(multiplier !== 1){\n          limit = Math.floor(largestDim * multiplier);\n          image.resize(limit,limit).max().withoutEnlargement()\n        }\n        image.rotate().toBuffer(function(err, outputBuffer, info) {\n          if(err){\n            dfd.reject(err);\n          } else {\n            var manipulatedImageFileData = {\n              Key: s.filename,\n              ContentType: 'image/png',\n              Body: outputBuffer,\n              width: info.width,\n              height: info.height,\n              url: s.url,\n              originalFilename: s.originalFilename\n            };\n          }\n          dfd.resolve(manipulatedImageFileData);\n        });\n      }\n  });\n  return dfd.promise();\n});\n\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/normalizeImageFileData.js","var jD = require('jquery-deferred');\nvar aws = require('aws-sdk');\nvar prepareModuleWithDefaults = require('./prepareModuleWithDefaults');\nmodule.exports = prepareModuleWithDefaults(function(s){\n  s = Object.assign({},s);\n  if(!s.ContentType){\n    var mime = require('mime-types');\n    var extension = s.Key.split('.').pop();\n    s.ContentType = mime.lookup(extension);\n  }\n  var dfd = jD.Deferred();\n\n  aws.config.update({accessKeyId: s.accessKeyId , secretAccessKey: s.secretAccessKey });\n  var s3 = new aws.S3(); \n  var s3Params = {\n      Bucket: s.Bucket,\n      Key: s.Key,\n      Body: s.Body,\n      ContentType: s.ContentType,\n      ACL: 'public-read'\n  };\n\n  s3.putObject(\n    s3Params,\n    function(err, data) {\n        if (err) {\n          dfd.reject(err);\n        } else {\n          s.uploadResponse = data;\n          dfd.resolve(s);\n        }\n    }\n  );\n  return dfd.promise();\n});\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/uploadToS3.js","import express from 'express';\n\nfunction makeServeChainableExpress(serverLogic) {\n  return ({app, port = 3000, nameSpace = ''}) => {\n    let appIsBrandNew = false;\n    if (!app) {\n      appIsBrandNew = true;\n      app = express();\n    }\n\n    serverLogic(app, nameSpace);\n    \n\n    if (appIsBrandNew) {\n      app.listen(port, (error) => {\n        if (error) {\n          console.error(error);\n        } else {\n          console.info(\n            '🌎 Listening on port %s. Open up http://localhost:%s/ in your browser.',\n            port,\n            port,\n          );\n        }\n      });\n    }\n\n    return app;\n  };\n}\n\nexport default makeServeChainableExpress;\n\n\n// WEBPACK FOOTER //\n// ../make-serve-chainable-express/make-serve-chainable-express.js",";\nvar mymoduleName = 'mongooseStuff';;\n(function(exports) {\n\n    var jD = require('jquery-deferred');\n\n\n    var mongoose = require('mongoose');\n    var uriUtil = require('mongodb-uri');\n\n    var mongooseStuff = (function() {\n        var MongooseStuff = function() {\n            var self = this;\n            var mongodbUri = process.env.MONGOLAB_URI;\n            if(process.env.ENVNAME === 'foremanLocal'){\n                mongodbUri = \"mongodb://localhost:27017/\"+process.env.DATABASE_NAME;\n            }\n            \n            this.mongooseUri = uriUtil.formatMongoose(mongodbUri);\n            this.db = mongoose.connection;\n            this.models = {};\n            self.models.SimpleImage = mongoose.model('simpleimage', mongoose.Schema({\n                \"url\": String,\n                \"idX\": String,\n                // \"date\": {\n                //     type: Date,\n                //     default: Date.now\n                // },\n                // \"width\": Number,\n                // \"height\": Number,\n            }));\n\n            self.models.ComplexImage = mongoose.model('ComplexImage', mongoose.Schema({\n                \"url\": String,\n                \"idX\": String,\n                \"date\":Date,\n                \"width\":Number,\n                \"height\":Number,\n                \"cropWidth\":Number,\n                \"cropHeight\":Number,\n                \"x\":Number,\n                \"y\":Number,\n                \"mode\":String,\n                \"customTemplate\":String,\n                \"idX\":String,\n                \"customUrl\":String,\n                \"pathname\":String,\n                \"good\":Number\n                // \"date\": {\n                //     type: Date,\n                //     default: Date.now\n                // },\n                // \"width\": Number,\n                // \"height\": Number,\n            }));\n\n            self.models.UserTemplate = mongoose.model('UserTemplate', mongoose.Schema({\n\t\t\t\tcreated: Date,\n\t\t\t\tcustomTemplate:String,\n\t\t\t\ttemplateHeight: Number,\n\t\t\t\ttemplateWidth:Number\n            }));\n        };\n        MongooseStuff.prototype.connect = function() {\n            var self = this;\n            var dfd = jD.Deferred();\n            if (mongoose.connection.readyState === 0) {\n                var options = {\n                    server: {\n                        socketOptions: {\n                            keepAlive: 1,\n                            connectTimeoutMS: 30000\n                        }\n                    },\n                    replset: {\n                        socketOptions: {\n                            keepAlive: 1,\n                            connectTimeoutMS: 30000\n                        }\n                    }\n                };\n                mongoose.connect(self.mongooseUri, options);\n                self.db.once('open', dfd.resolve);\n                self.db.on('error', console.error.bind(console, 'connection error:'));\n\n            } else {\n                dfd.resolve();\n            }\n\n            return dfd.promise();\n        };\n\n        MongooseStuff.prototype.checkUrl = function(idX) {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n                self.models.SimpleImage.findOne({\n                    'idX': idX\n                }, 'url idX', function(err, simpleimage) {\n\n                    if (simpleimage !== null) {\n                        dfd.resolve(true)\n                    } else {\n                        dfd.resolve(false)\n                    }\n\n                    // if (err) return handleError(err);\n                    // console.log('%s %s is a %s.', person.name.first, person.name.last, person.occupation) // Space Ghost is a talk show host.\n                })\n            });\n            return dfd.promise();\n        };\n\n        MongooseStuff.prototype.GetComplexImage = function(idX) {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n                self.models.ComplexImage.findOne({\n                    'idX': idX\n                }, function(err, data) {\n\n                    if (data !== null) {\n                        dfd.resolve(data)\n                    } else {\n                        dfd.resolve(data)\n                    }\n\n                    // if (err) return handleError(err);\n                    // console.log('%s %s is a %s.', person.name.first, person.name.last, person.occupation) // Space Ghost is a talk show host.\n                })\n            });\n            return dfd.promise();\n        };\n\n        MongooseStuff.prototype.GetUserTemplatesAll = function() {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n                self.models.UserTemplate.find({\n                }, function(err, data) {\n\n                    if (data !== null) {\n                        dfd.resolve(data)\n                    } else {\n                        dfd.resolve(data)\n                    }\n\n                    // if (err) return handleError(err);\n                    // console.log('%s %s is a %s.', person.name.first, person.name.last, person.occupation) // Space Ghost is a talk show host.\n                })\n            });\n            return dfd.promise();\n        };\n\n        MongooseStuff.prototype.GetComplexImageAll = function() {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n                self.models.ComplexImage.find({\n                }, function(err, data) {\n\n                    if (data !== null) {\n                        dfd.resolve(data)\n                    } else {\n                        dfd.resolve(data)\n                    }\n\n                    // if (err) return handleError(err);\n                    // console.log('%s %s is a %s.', person.name.first, person.name.last, person.occupation) // Space Ghost is a talk show host.\n                })\n            });\n            return dfd.promise();\n        };\n\n        \n        MongooseStuff.prototype.MakeUserTemplate = function(data) {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n            \tself.models.UserTemplate.findOneAndUpdate( { customTemplate : data.customTemplate },data,{ upsert : true }, function(){\n            \t\tdfd.resolve.apply(null, arguments);\n            \t});\n            });\n            return dfd.promise();\n        };\n\n\n        MongooseStuff.prototype.UpdateComplexImage = function(data) {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n            \tself.models.ComplexImage.findOneAndUpdate( { idX : data.idX },data,{ upsert : true }, function(){\n            \t\tdfd.resolve.apply(null, arguments);\n            \t});\n            });\n            return dfd.promise();\n        };\n\n        MongooseStuff.prototype.ComplexImage = function(data) {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n                var newRecord = new self.models.ComplexImage(data);\n\n                newRecord.save(function() {\n                    dfd.resolve.apply(null, arguments);\n                })\n            });\n            return dfd.promise();\n        };\n\n        MongooseStuff.prototype.simpleimage = function(url, idX) {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n                var newRecord = new self.models.SimpleImage({\n                    url: url,\n                    idX: idX\n                });\n\n                newRecord.save(function() {\n                    dfd.resolve.apply(null, arguments);\n                })\n            });\n            return dfd.promise();\n        };\n\n        MongooseStuff.prototype.getImages = function(url, idX) {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n                self.models.SimpleImage.find({}, 'url idX', function(err, simpleimage) {\n                    dfd.resolve(simpleimage);\n                })\n            });\n            return dfd.promise();\n        };\n\n        MongooseStuff.prototype.nuke = function() {\n            var self = this;\n            var dfd = jD.Deferred();\n            self.connect().then(function() {\n                mongoose.connection.db.collection('usertemplates').drop(function(err) {//compleximages\n                    if (err) throw err;\n\n                    // Only close the connection when your app is terminating\n                    mongoose.connection.db.close(function(err) {\n                        dfd.resolve();\n                        if (err) throw err;\n                    });\n                });\n                return dfd.promise();\n            });\n        };\n\n\n\n        return new MongooseStuff();\n    })();\n\n\n    exports.x = mongooseStuff;\n\n\t// mongooseStuff.nuke();\n\n\t// mongooseStuff.connect().then(function(){\n\t// \tmongoose.connection.db.listCollections().toArray(function(err, names) {\n\t// \t    if (err) {\n\t// \t        console.log(err);\n\t// \t    }\n\t// \t    else {\n\t// \t        names.forEach(function(e,i,a) {\n\t// \t            mongoose.connection.db.dropCollection(e.name);\n\t// \t            console.log(\"collection --->>\", e.name);\n\t// \t        });\n\t// \t    }\n\t// \t});\n //    });\n\n\n})(typeof exports === 'undefined' ? this[mymoduleName] = {} : exports);\n\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/mongooseStuff.js","var jD = require('jquery-deferred');\nvar aws = require('aws-sdk');\nmodule.exports = function(s){\n  s = Object.assign({},s);\n  var dfd = jD.Deferred();\n  aws.config.update({accessKeyId: s.accessKeyId , secretAccessKey: s.secretAccessKey });\n  var s3 = new aws.S3(); \n  s3.getObject(\n    {\n        Bucket: s.Bucket,\n        Key: s.Key\n    },\n    function(err, data) {\n      var output;\n      if(err && err.statusCode === 404 && s.resolveNullOn404){\n        output = s.outputParser ? s.outputParser(null) : null;\n        dfd.resolve(output);\n      } else if (err){\n        dfd.reject(err);\n      } else {\n        output = s.outputParser ? s.outputParser(data) : data;\n        dfd.resolve(output);\n      }\n    }\n  );\n  return dfd.promise();\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/getS3ObjectData.js","import mymodule from './public/js/mymodule';\nimport express from 'express';\nimport ejs from 'ejs';\nimport path from 'path';\nimport url from 'url';\nimport fs from 'fs';\nimport { x as mongooseStuff } from './js/mongooseStuff';\nimport endpointCompositeImage from './js/endpointCompositeImage';\nimport endpointGetNormalizedImageInfo from './js/endpointGetNormalizedImageInfo';\nimport endpointGetS3SignedUploadUrl from './js/endpointGetS3SignedUploadUrl';\nimport endpointIframeUpload from './js/endpointIframeUpload';\nimport generateUrlRegexNamespace from './js/generateUrlRegexNamespace';\nimport respondWithJson from './js/respondWithJson';\nimport ensureLeadingSlash from '@defualt/ensure-leading-slash';\nimport makeServeChainableExpress from '@defualt/make-serve-chainable-express';\n// var mymodule = require('./public/js/mymodule');\n// var express = require('express');\n// var ejs = require('ejs');\n// var path = require('path');\n// var url = require('url');\n// var mongooseStuff = require('./js/mongooseStuff').x;\n// var endpointCompositeImage = require('./js/endpointCompositeImage');\n\n// var endpointGetNormalizedImageInfo = require('./js/endpointGetNormalizedImageInfo');\n\n// var endpointGetS3SignedUploadUrl = require('./js/endpointGetS3SignedUploadUrl');\n\n// var endpointIframeUpload = require('./js/endpointIframeUpload');\n// var fs = require('fs');\n\n/*\n * Set-up the Express app.\n */\n\nexport default makeServeChainableExpress((app, nameSpace) => {\n  app.set('views', __dirname + '/views');\n  app.engine('html', ejs.renderFile);\n\n  app.use(express.static(path.join(__dirname, 'public')));\n\n  /*\n   * Load the S3 information from the environment variables.\n   */\n  var AWS_ACCESS_KEY = process.env.AWS_ACCESS_KEY;\n  var AWS_SECRET_KEY = process.env.AWS_SECRET_KEY;\n  var S3_BUCKET = process.env.S3_BUCKET\n\n  //===========================\n  //HTML PAGES\n  //____________________________\n\n  app.get(ensureLeadingSlash(`${nameSpace}/privacy`), function(req, res){\n      res.render('privacy.html',{\n          pageName:'privacy',\n          urlInfo:mymodule.deriveUrlInfo({nameSpace}),\n          userTemplates:userTemplates\n      });\n  });\n\n  app.get(ensureLeadingSlash(`${nameSpace}/terms`), function(req, res){\n      res.render('terms.html',{\n          pageName:'terms',\n          urlInfo:mymodule.deriveUrlInfo({nameSpace}),\n          userTemplates:userTemplates\n      });\n  });\n\n  app.get(ensureLeadingSlash(`${nameSpace}/iframeuploadbutton`), function(req, res){\n      res.render('iframeuploadbutton.html',{\n          pageName:'iframeuploadbutton',\n          urlInfo:null,\n          buttonText:req.query.buttonText\n      });\n  });\n\n\n\n  var standardRouteHtmlHandler = function(req, res){\n    var urlToUse = req.url;  \n    urlToUse = url.parse(urlToUse).pathname === '/' ? null : urlToUse;\n    var offline = typeof req.query.offline !== 'undefined';\n    var iframebutton = typeof req.query.iframebutton !== 'undefined';\n    var urlInfo = mymodule.deriveUrlInfo({pathname: urlToUse,offline,nameSpace});\n    \n    mongooseStuff.UpdateComplexImage(urlInfo).then(function(result){});\n\n    res.render('redesign'+'.html',{\n        userTemplates:userTemplates,\n        req:req,\n        urlInfo:urlInfo,\n        mymodule:mymodule,\n        offline:offline,\n        iframebutton:iframebutton\n        // pretty:stringify(req, null, 2)\n    });\n  };\n  app.get(mymodule.getStandardModesRegex(nameSpace), standardRouteHtmlHandler);\n\n  app.get(ensureLeadingSlash(`${nameSpace}/`), standardRouteHtmlHandler);\n\n  app.get(ensureLeadingSlash(`${nameSpace}/redesign`), standardRouteHtmlHandler);\n\n\n\n  app.get(ensureLeadingSlash(`${nameSpace}/list`), function(req, res){\n      var offline = typeof req.query.offline !== 'undefined';\n      mongooseStuff.GetComplexImageAll().then(function(images){\n      // mongooseStuff.getImages().then(function(images){\n        res.render('list.html', { \n            images:images,\n            offline:offline\n        });\n      });\n  });\n\n\n  var userTemplates = []; \n  //===========================\n  //ENDPOINTS\n  //____________________________\n\n  endpointCompositeImage({\n    app:app,\n    accessKeyId:AWS_ACCESS_KEY,\n    secretAccessKey:AWS_SECRET_KEY,\n    Bucket: S3_BUCKET,\n    urlPattern: generateUrlRegexNamespace('image\\/')\n  });\n\n  endpointGetNormalizedImageInfo({\n    app:app,\n    accessKeyId:AWS_ACCESS_KEY,\n    secretAccessKey:AWS_SECRET_KEY,\n    Bucket: S3_BUCKET,\n    userTemplates:userTemplates,\n    urlPattern: ensureLeadingSlash(`${nameSpace}/get_normalized_image_info`)\n  });\n  endpointGetS3SignedUploadUrl({\n    app:app,\n    accessKeyId:AWS_ACCESS_KEY,\n    secretAccessKey:AWS_SECRET_KEY,\n    Bucket: S3_BUCKET,\n    urlPattern: ensureLeadingSlash(`${nameSpace}/get_s3_signed_upload_url`)\n  });\n\n  endpointIframeUpload({\n    app:app,\n    accessKeyId:AWS_ACCESS_KEY,\n    secretAccessKey:AWS_SECRET_KEY,\n    Bucket: S3_BUCKET,\n    urlPattern: ensureLeadingSlash(`${nameSpace}/uploadsimple`)\n  });\n\n  app.get(ensureLeadingSlash(`${nameSpace}/get_template_list`), (req, res) => {\n    respondWithJson({\n      res,\n      userTemplates,\n    });\n  });\n\n\n\n\n  // require('./js/passportStuff')({\n  //   app:app\n  // });\n  // app.listen(3000);\n\n\n\n\n\n\n\n\n\n\n  app.post(ensureLeadingSlash(`${nameSpace}/SimpleImage`),function(req, res){\n    var data = req.body;\n    mongooseStuff.simpleimage(data.url, data.idX).then(function() {\n      res.send({\n          status:\"success\"\n      })\n    })\n  })\n\n  app.post(ensureLeadingSlash(`${nameSpace}/ComplexImage`), function(req, res){\n      var data = req.body;\n\n      mongooseStuff.ComplexImage(data).then(function(result){\n        res.send({\n            status:\"success\",\n            result:result,\n            payload:data\n        })\n      });\n  });\n\n  app.post(ensureLeadingSlash(`${nameSpace}/GetComplexImage`), function(req, res){\n      var data = req.body.data;\n      mongooseStuff.GetComplexImage('asdf').then(function(result){\n        res.send({\n            status:\"success\",\n            result:result\n        })\n      });\n  });\n\n  app.post(ensureLeadingSlash(`${nameSpace}/UpdateComplexImage`), function(req, res){\n      var data = req.body;\n      mongooseStuff.UpdateComplexImage(data).then(function(result){\n        res.send({\n            status:\"success\",\n            result:result\n        })\n      });\n  });\n\n\n\n\n  // GetComplexImage\n  // mongooseStuff.ComplexImage({url:'asdf'}).always(function(arguments){\n  //    console.log('ComplexImage',arguments)\n  //  })\n\n  // mongooseStuff.GetComplexImageAll().always(function(arguments){\n  //   console.log('ComplexImage',arguments)\n  // })\n   \n  mongooseStuff.GetUserTemplatesAll().always(function(data){\n    // console.log('GetUserTemplatesAll',data);\n    userTemplates = data;\n    // console.log('userTemplates',userTemplates)\n  })\n\n  return app;\n});\n\n\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/bernieExpressServer.js",";var mymoduleName = 'mymodule';\n\n\nvar templateBaseUrl = 'http://s3-us-west-1.amazonaws.com/bernieapp/decorations/';\n\nvar rawImagePrefix = 'http://s3-us-west-1.amazonaws.com/bernieapp/selfies/';\n\n\nvar isNode= (function(){\n\tvar isNode = false;    \n\tif (typeof process === 'object') {\n\t  if (typeof process.versions === 'object') {\n\t    if (typeof process.versions.node !== 'undefined') {\n\t      isNode = true;\n\t    }\n\t  }\n\t}\n\treturn isNode;\n})();\n\n;(function(exports){\n\n\tvar standardModes = [\n\t\t{\n\t\t\tmode:'f',\n\t\t\tfeatured:false,\n\t\t\told:true\n\t\t},\n\t\t{\n\t\t\tmode:'ut',\n\t\t\tfeatured:false\n\t\t},\n\t\t{\n\t\t\tmode:'b',\n\t\t\tfeatured:false,\n\t\t\told:true\n\t\t},\n\t\t{\n\t\t\tmode:'h',\n\t\t\tfeatured:false,\n\t\t\told:true\n\t\t},\n\t\t{\n\t\t\tmode:'selfie',\n\t\t\tfeatured:false,\n\t\t\told:true\n\t\t},\n\t\t{\n\t\t\tmode:'h3',\n\t\t\tfeatured:true\n\t\t},\n\t\t{\n\t\t\tmode:'h4',\n\t\t\tfeatured:true\n\t\t},\n\t\t{\n\t\t\tmode:'wg',\n\t\t\tfeatured:true\n\t\t}\n\t];\n\texports.standardModes = standardModes;\n\texports.getStandardModesRegex = function(nameSpace){\n\t\tvar pipedString = ''\n\t\tfor(var i =0,l=exports.standardModes.length;i<l;i++){\n\t\t\tvar mode = exports.standardModes[i].mode;\n\t\t\tmode = nameSpace ? (nameSpace + '\\/' + mode) : mode;\n\t\t\tconsole.log('mode',mode);\n\t\t\tpipedString += i > 0 ? ('|' + mode) : mode;\n\n\t\t}\n\t\treturn new RegExp('^[/]('+pipedString+')[/](.+)');\n\t};\n\n\texports.oldModes = (function(){\n\t\tvar a = []\n\t\tfor(var i =0,l=exports.standardModes.length;i<l;i++){\n\t\t\tif(!!exports.standardModes[i].old){\n\t\t\t\ta.push(exports.standardModes[i]);\n\t\t\t}\n\t\t}\n\t\treturn a;\n\t})();\n\n\texports.isOldMode = function(toCompare){\n\t\tvar is = false;\n\t\tfor(var i =0,l=exports.oldModes.length;i<l;i++){\n\t\t\tis = is || toCompare === exports.oldModes[i].mode;\n\t\t}\n\t\treturn is;\n\t};\n\n\tvar containsStardardModeCache = {};\n\texports.containsStardardMode = function(url){\n\t\tvar contains = false;\n\t\tif(typeof containsStardardModeCache[url] === 'undefined'){\n\t\t\tfor(var i =0,l=exports.standardModes.length;i<l;i++){\n\t\t\t\tvar mode = exports.standardModes[i].mode;\n\t\t\t\tcontains = contains || url.indexOf(mode) !== -1;\n\t\t\t}\n\t\t\tcontainsStardardModeCache[url] = contains;\n\t\t}\n\t\treturn containsStardardModeCache[url];\n\t};\n\n\t\n\n\tvar DeriveUrlInfo = function({pathname,offline,nameSpace}){\n\t\tthis.init({pathname,offline,nameSpace})\n\t\t\n\t\t\n\t};\n\tDeriveUrlInfo.prototype.init = function({pathname,offline,nameSpace}){\n\t\tthis.nameSpace = nameSpace;\n\t\tthis.nameSpaceWithLeadingSlash = nameSpace ? `/${nameSpace}` : '';\n\t\tvar nameSpaceWithLeadingSlash = this.nameSpaceWithLeadingSlash;\n\t\tthis.offline = offline;\n\t\tvar defaultPathname = '/h3/zephyr1476401787491/180_3_218_218_553_553/';\n\t\tpathname = !!pathname !== 0 ? pathname : defaultPathname;\n\t\tpathname = pathname === nameSpaceWithLeadingSlash || pathname === nameSpaceWithLeadingSlash + '/' ? defaultPathname : pathname;\n\t\tif (pathname && pathname.indexOf(this.nameSpaceWithLeadingSlash) === 0) {\n\t\t\tpathname = pathname.replace(this.nameSpaceWithLeadingSlash, '');\n\t\t}\n\t\tpathname = pathname ? pathname : defaultPathname;\n\n\t\tthis.slashSplit = pathname.split('/');\n\t\tif(pathname.indexOf('/f/') === 0){\n\t\t\tthis.idX = this.slashSplit[4];\n\t\t\tthis.customTemplate = this.slashSplit[2];\n\t\t} else if(pathname.indexOf('/selfie/') === 0){\n\t\t\tpathname = '/selfie/v1438476536/bernie/' + this.slashSplit[4];\n\t\t\tthis.slashSplit = pathname.split('/');\n\t\t\tthis.idX = this.slashSplit[4];\n\t\t\tthis.customTemplate = 'i4hiodnsy2yaqavpowm1';\n\t\t} else {\n\t\t\t//pathname.indexOf('/h/') === 0\n\t\t\t//pathname.indexOf('/h3/') === 0\n\t\t\tthis.idX = this.slashSplit[2];\n\t\t}\n\n\t\tif(pathname.indexOf('/ut/') === 0){\n\t\t\tthis.customTemplate = this.slashSplit[4];\n\t\t}\n\n\t\tif(pathname.indexOf('/h/') === 0){\n\t\t\tthis.customTemplate = 'hairglasses';\n\t\t}\n\n\t\tthis.pathname = this.nameSpaceWithLeadingSlash + pathname;\n\t\tconsole.log('this.slashSplit',this.slashSplit);\n\t\tthis.coords = this.slashSplit[3].split('_');\n\n\t\tfor(var i=0,l=this.coords.length;i<l;i++){\n\t\t\tthis.coords[i] = +this.coords[i];\n\t\t}\n\n\t\tthis.dims = this.coords.splice(4,2);\n\t\tthis.width = +this.dims[0];\n\t\tthis.height = +this.dims[1];\n\t\tthis.x = this.coords[0];\n\t\tthis.y = +this.coords[1];\n\t\tthis.cropWidth = this.coords[2];\n\t\tthis.cropHeight = this.coords[3];\n\t\t\n\t\tthis.format = '.jpg';\n\n\t\tthis.customUrl = '';\n\t\tthis.customUrlQueryString = '';\n\t\tthis.makeCustomUrl({\n\n\t\t});\n\t};\n\tDeriveUrlInfo.prototype.normalize = function(val,def){\n\t\tdef = typeof def !== 'undefined' ? def : true;\n\t\tval = typeof val !== 'undefined' ? val : def;\n\t\tif(typeof def === 'number'){\n\t\t\tval = typeof val === 'string' ? +val : val;\n\t\t\tval = !isNaN(val) ? val : def;\n\t\t\tval = Math.round(val);\n\t\t}\n\t\t\n\t\treturn val;\n\t}\n\tDeriveUrlInfo.prototype.doubleNormalize = function(val,prexisting,def){\n\t\tvar def = this.normalize(prexisting,def);\n\t\treturn this.normalize(val,def);\n\t}\n\tDeriveUrlInfo.prototype.doubleNormalizeInterface = function(dest,options,defaults){\n\t\tfor(var name in defaults){\n\t\t\tvar def = defaults[name];\n\t\t\tdest[name] = this.doubleNormalize(options[name],dest[name],def);\n\t\t}\n\t};\n\n\tDeriveUrlInfo.prototype.makeCustomUrl = function(settings){\n\t\tvar mode = this.slashSplit[1].toLowerCase();\n\t\t\n\t\tvar toNormalize = {\n\t\t\t'x':mode !== 'selfie' ? 0 : 142,\n\t\t\t'y':mode !== 'selfie' ? 0 : 98,\n\t\t\t'cropWidth':mode !== 'selfie' ? 1200 : 305,\n\t\t\t'cropHeight':mode !== 'selfie' ? 1200 : 305,\n\t\t\t'width':1200,\n\t\t\t'height':1200,\n\t\t\t'idX':'zephyr1476401787491.png',\n\t\t\t'mode':mode\n\t\t};\n\t\tif(!!settings.customTemplate){\n\t\t\ttoNormalize.customTemplate = settings.customTemplate;\n\t\t}\n\t\tthis.doubleNormalizeInterface(this,settings,toNormalize);\n\t\tthis.idX = this.idX.split('.');\n\t\tif(this.idX.length > 1){\n\t\t\tthis.idX.pop();\n\t\t}\n\t\tthis.idX = this.idX.join('.');\n\t\tthis.rawImage = rawImagePrefix + this.idX;\n\t\tthis.rawImage = !!this.offline ? '/images/mock-selfie-raw.jpg' : this.rawImage;\n\t\tif(this.rawImage.indexOf('.') === -1){\n\t\t\tthis.rawImage += '.png';\n\t\t}\n\t\tif(this.mode === 'f' || this.mode === 'selfie'){\n\t\t\tthis.customTemplate = 'wg';\n\t\t\tthis.doStandardSquare();\n\t\t}else{\n\t\t\tthis.doStandardSquare()\n\t\t}\n\t};\n\tDeriveUrlInfo.prototype.serialize = function(obj, prefix) {\n\t\tif(typeof obj !== 'object'){\n\t\t\tobj = {whatever:obj};\n\t\t}\n\t    var str = [];\n\t    for (var p in obj) {\n\t        if (obj.hasOwnProperty(p)) {\n\t            var k = prefix ? prefix + \"[\" + p + \"]\" : p,\n\t                v = obj[p];\n\t            str.push(typeof v == \"object\" ?\n\t                serialize(v, k) :\n\t                encodeURIComponent(k) + \"=\" + encodeURIComponent(v));\n\t        }\n\t    }\n\t    str = str.join(\"&\");\n\t    str = str.replace('whatever=','')\n\t    return str;\n\t};\n\n\tDeriveUrlInfo.prototype.doStandardSquare = function(){\n\t\tthis.pathname = '/'+this.mode+'/'+this.idX+'/'+this.x+'_'+this.y+'_'+this.cropWidth+'_'+this.cropHeight+'_'+this.width+'_'+this.height+'/'\n\t\tif(!!this.customTemplate && this.mode !== 'h'){\n\t\t\tthis.pathname += this.customTemplate + '/';\n\t\t}\n\t\t\n\t\tvar userPhotoKey = this.idX;\n\t\tuserPhotoKey = userPhotoKey.split('.');\n\t\tif(userPhotoKey.length > 1){\n\t\t\tuserPhotoKey.pop();\n\t\t}\n\t\tuserPhotoKey = userPhotoKey.join('.');\n\t\tuserPhotoKey = userPhotoKey;\n\t\t\n\t\tvar customUrlSettings = {\n\t\t\tcropWidth: this.cropWidth,\n\t\t\tcropHeight: this.cropHeight,\n\t\t\tx: this.x,\n\t\t\ty: this.y,\n\t\t\ttemplate:(!!this.customTemplate ? this.customTemplate : this.mode),\n\t\t\tuserPhotoKey: userPhotoKey\n\t\t};\n\t\tvar s = customUrlSettings;\n\n\t\tthis.customUrl = ('' +\n\t\t\t'/image/' + \n\t\t\ts.template +\n\t\t\t'/' +\n\t\t\ts.userPhotoKey +\n\t\t\t'_' + s.cropWidth + '_' + s.cropHeight + '_' + s.x + '_' + s.y + '.jpg' +\n\t\t'');\n\t\tthis.customUrl = !!this.offline ? '/images/mock-selfie.png' : this.customUrl;\n\t\tthis.customUrlQueryString = this.serialize(this.customUrl);\n\n\t\treturn this.customUrl;\n\t};\n\n\texports.generateTemplateImgListHtml = function(userTemplates,offline){\n\t\tvar imgsHtml = '';\n\t\tif(offline){\n\t\t\t;(function(){\n\t\t\t\tvar offlineTemplates = [\n                    {customTemplate:'/images/h3.png'},\n                    {customTemplate:'/images/h4.png'},\n                    {customTemplate:'/images/h3.png'}\n                ];\n\t            for(var i=0,l=offlineTemplates.length;i<l;i++){\n\t            \timgsHtml += '<div class=\"designFrame\">';\n\t            \t\timgsHtml += '<div class=\"designFrame_innerWrap\">';\n\t                \t\timgsHtml += '<img class=\"designFrame_design userTemplate\" src=\"'+offlineTemplates[i].customTemplate+'\">'\n\t            \t\timgsHtml += '</div>';\n\t            \timgsHtml += '</div>';\n\t            }\n\t            \n\t        })();\n\t\t}else{\n\t\t\t;(function(){\n\t            for(var i=0,l=standardModes.length;i<l;i++){\n\t                if(!!standardModes[i].featured){\n\t                \timgsHtml += '<div class=\"designFrame\">';\n\t\t                \timgsHtml += '<div class=\"designFrame_innerWrap\">';\n\t\t                    \timgsHtml += '<img class=\"designFrame_design standardTemplate\" src=\"' + templateBaseUrl +standardModes[i].mode+'.png\">';\n\t\t                \timgsHtml += '</div>';\n\t                \timgsHtml += '</div>';\n\t                }\n\t            }\n\t        })();\n\t        ;(function(){\n\t            for(var i=0,l=userTemplates.length;i<l;i++){\n\t            \timgsHtml += '<div class=\"designFrame\">';\n\t\t            \timgsHtml += '<div class=\"designFrame_innerWrap\">';\n\t\t                \timgsHtml += '<img class=\"designFrame_design userTemplate\" src=\"' + templateBaseUrl +userTemplates[i].customTemplate+'.png\">'\n\t\t            \timgsHtml += '</div>';\n\t            \timgsHtml += '</div>';\n\t            }\n\t            \n\t        })();\n        }\n        return imgsHtml;\n\t};\n\texports.deriveUrlInfo = function({pathname,offline,nameSpace}){\n\t\treturn new DeriveUrlInfo({pathname,offline,nameSpace});\n\t};\n\n})(typeof exports === 'undefined'? this[mymoduleName]={}: exports);\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/public/js/mymodule.js","/* eslint-disable */\nimport aws from 'aws-sdk';\nimport path from 'path';\nimport {parse as parseUrl} from 'url';\nimport ensureLeadingSlash from '@defualt/ensure-leading-slash';\nimport getAllS3Objects from './getAllS3Objects';\nimport getS3ObjectData from './getS3ObjectData';\nimport meldAndCropImages from './meldAndCropImages';\nimport respondWithJson from './respondWithJson';\n\nvar parseClientCompositeImageUrl = function(url){\n  var pathnameSplit = parseUrl(url).pathname.split('/').splice(2,2);\n  var compositeS3Key = 'consolidated/' + pathnameSplit.join('/');\n  var templateFilename = pathnameSplit[0];\n  var userImageAndScalePos = pathnameSplit[1];\n  userImageAndScalePos = userImageAndScalePos.split('_');\n  var userImageFilename = userImageAndScalePos;\n  var scalePos = userImageFilename.splice(-4,4);\n  scalePos[3] = scalePos[3].split('.');\n  scalePos[3].pop();\n  scalePos[3] = scalePos[3].join('.');\n  var overlaySettings = {\n    width: +scalePos[0] == scalePos[0] ? +scalePos[0] : 100,\n    height: +scalePos[1] == scalePos[1] ? +scalePos[1] : 100,\n    left: +scalePos[2] == scalePos[2]? +scalePos[2] : 0,\n    top: +scalePos[3] == scalePos[3]? +scalePos[3] : 0,\n  };\n  console.log('overlaySettings',overlaySettings);\n  userImageFilename = userImageFilename.join('_');\n  return {\n    userImageFilename: userImageFilename,\n    templateFilename: templateFilename,\n    overlaySettings: overlaySettings,\n    compositeS3Key:compositeS3Key\n  };\n};\n// Generate composite images.\n// Requests are either .png, .jpg, or .json.\n// If .json, the composite image is generated, uploaded to S3,\n// and the S3 item key is sent to the client in json.\nexport default ({app,accessKeyId,secretAccessKey,Bucket,urlPattern}) => {\n  app.get(urlPattern, function(req, res) {\n    console.log('EXTNSSION', )\n    var extension = path.extname(req.url);\n    var fileTypes = {\n      '.json': 'png',\n      '.png': 'png',\n      '.jpg': 'jpeg',\n      '.jpeg': 'jpeg'\n    };\n    var fileType = fileTypes[extension] ? fileTypes[extension] : 'jpeg';\n    console.log('fileType',fileType);\n    var compositeImageInstructions = parseClientCompositeImageUrl(req.url);\n    var s = compositeImageInstructions;\n    console.log('s.compositeS3Key',s.compositeS3Key);\n    getS3ObjectData({\n      Key:s.compositeS3Key,\n      resolveNullOn404:true,\n      accessKeyId:accessKeyId,\n      secretAccessKey:secretAccessKey,\n      Bucket: Bucket\n    }).then(function(data){\n      if(!data){\n        console.log('COMPOSITE IMAGE DOES NOT EXIST!');\n\n        var templateCreateMode = !s.templateFilename || s.templateFilename === 'undefined';\n\n        const getAllS3ObjectsSettingsDict = {\n          userPhoto:{\n              Key:'selfies/' + s.userImageFilename + '.png',\n              retrySearchCriteria:{\n                Prefix:'res/dthvwwocq/image/upload/bernie/'+s.userImageFilename,\n                Bucket: 'cloudinary-bernie-backup'\n              }\n            }\n        };\n        if (!templateCreateMode) {\n          getAllS3ObjectsSettingsDict.template = {\n            Key:'decorations/' + s.templateFilename + '.png'\n          };\n        }\n        \n        getAllS3Objects({\n          dict:getAllS3ObjectsSettingsDict,\n          Bucket:Bucket,\n          accessKeyId: accessKeyId,\n          secretAccessKey: secretAccessKey\n        })\n        .then(meldAndCropImages.bind(null,s.overlaySettings))\n        .then(function(bufferData){\n          \n          var Key = s.compositeS3Key;\n          if (templateCreateMode) {\n            Key = 'decorations/' + s.userImageFilename + '.png'\n          } else {\n            res.setHeader('content-type', 'image/'+fileType);\n            res.write(bufferData.Body,'binary');\n            res.end(null, 'binary');\n          }\n\n          aws.config.update({accessKeyId: accessKeyId , secretAccessKey: secretAccessKey });\n          var s3 = new aws.S3(); \n          s3.putObject(\n            {\n                Bucket: Bucket,\n                Key: Key,\n                Body: bufferData.Body,\n                ContentType: 'image/'+fileType,\n                ACL: 'public-read'\n            },\n            function(err, data) {\n                if (err) {\n                    // Failed saving to S3\n                    log.error('Failed saving to S3', err);\n                } else {\n                  if (templateCreateMode) {\n                    respondWithJson({\n                      Key:Key,\n                      res:res,\n                      isSuccess:true\n                    });\n                  }\n                }\n            }\n          );\n        });\n      } else {\n        console.log('COMPOSITE IMAGE DOES IN FACT EXIST !!!!');\n        res.setHeader('content-type', data.ContentType);\n        res.write(data.Body,'binary');\n        res.end(null, 'binary');\n      }\n    });\n  });\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/endpointCompositeImage.js","var aws = require('aws-sdk');\nvar jD = require('jquery-deferred');\nvar getS3ObjectData = require('./getS3ObjectData');\nmodule.exports = function(s){\n  var dfdMain = jD.Deferred();\n  var promises = [];\n  aws.config.update({accessKeyId: s.accessKeyId , secretAccessKey: s.secretAccessKey });\n  var s3 = new aws.S3();\n  for(var entryName in s.dict){\n    var entry = s.dict[entryName];\n    var filename = entry.Key;\n    (function(entryName,filename,entry){\n      var entryDfd = jD.Deferred();\n      getS3ObjectData({\n        Key:filename,\n        outputParser:function(data){\n          return {\n            entryName:entryName,\n            filename:filename,\n            data:data,\n          };\n        },\n        accessKeyId:s.accessKeyId,\n        secretAccessKey:s.secretAccessKey,\n        Bucket: s.Bucket\n      })\n      .then(entryDfd.resolve)\n      .fail(function(originalErr){\n        if(entry.retrySearchCriteria){\n          var retryBucket = entry.retrySearchCriteria.Bucket ? entry.retrySearchCriteria.Bucket : s.Bucket\n          var aws = require('aws-sdk');\n          aws.config.update({accessKeyId: s.accessKeyId , secretAccessKey: s.secretAccessKey });\n          var s3 = new aws.S3(); \n          var params = {\n            Bucket: retryBucket,\n            Prefix: entry.retrySearchCriteria.Prefix\n          };\n          s3.listObjectsV2(params, function(err, data) {\n            if(err){\n              entryDfd.reject(err);\n            } else {\n              if(data.Contents && data.Contents[0]){\n                getS3ObjectData({\n                  Key:data.Contents[0].Key,\n                  outputParser:function(data){\n                    return {\n                      entryName:entryName,\n                      filename:filename,\n                      data:data,\n                    };\n                  },\n                  accessKeyId:s.accessKeyId,\n                  secretAccessKey:s.secretAccessKey,\n                  Bucket:retryBucket\n                })\n                .then(function(){\n                  var args = arguments;\n                  var normalizeImageFileData = require('./normalizeImageFileData')({\n                    prepareModuleWithDefaults: true,\n                    filename: filename,\n                    parseSettings: function(s){\n                      s.Body = s.data.Body;\n                      return s;\n                    }\n                  });\n                  var uploadToS3 = require('./uploadToS3')({\n                    prepareModuleWithDefaults: true,\n                    accessKeyId:s.accessKeyId,\n                    secretAccessKey:s.secretAccessKey,\n                    Bucket:s.Bucket,\n                  });\n                  this.then(normalizeImageFileData).then(uploadToS3).always(function(){\n                    entryDfd.resolve.apply(null,args);\n                  });\n                  return this;\n                })\n                .fail(entryDfd.reject);\n              } else {\n                entryDfd.reject(originalErr);\n              }\n            }\n          });\n        } else {\n          entryDfd.reject(originalErr);\n        }\n      });\n      promises.push(entryDfd.promise());\n    })(entryName,filename,entry);\n  }\n\n  jD.when.apply(null,promises).done(function ( templateFetchResponse, userPhotoFetchResponse) {\n    var args = Array.prototype.slice.call(arguments);\n    var output = {};\n    for(var i=0,l=args.length;i<l;i++){\n      var entryName = args[i].entryName;\n      delete args[i].Key;\n      output[entryName] = args[i];\n    }\n    dfdMain.resolve(output);\n  }).then(null,function(err){\n    dfdMain.reject(err);\n  });\n  return dfdMain.promise();\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/getAllS3Objects.js","/* eslint-disable */\nvar sharp = require('sharp');\nvar jD = require('jquery-deferred');\nvar calcOverlayAndTemplateProcessingSettings = require('./calcOverlayAndTemplateProcessingSettings');\n\n// Normally, this will meld a foreground and a background image together,\n// and crop them to a square, as a new image jpeg.\n// But when templateCroppingMode is true,\n// only the foreground image is used,\n// and it alone gets cropped as a new image png.\nmodule.exports = function(overlaySettings,responses){\n  var dfd = jD.Deferred();\n  var templateFetchResponse = responses.template;\n  var templateCroppingMode = !templateFetchResponse;\n  var userPhotoFetchResponse = responses.userPhoto;\n  var args = Array.prototype.slice.call(arguments);  \n  var userPhoto = sharp(userPhotoFetchResponse.data.Body);\n  var bgColor = templateCroppingMode ? {r: 0, g: 0, b: 0, alpha: 0} : 'white';\n  var fileType = templateCroppingMode ? 'png' : 'jpeg';\n  userPhoto.metadata().then(function(metadata) {\n    var imageProcessingSettings = calcOverlayAndTemplateProcessingSettings(overlaySettings,metadata);\n    var s = imageProcessingSettings;\n    if(s.completelyOutOfBound){\n      var responseToProcess = templateCroppingMode ? userPhotoFetchResponse : templateFetchResponse;\n      var template = sharp(responseToProcess.data.Body);\n      template.resize(s.limit, s.limit).min().max();\n      template = template.background(bgColor);\n      if (!templateCroppingMode) {\n        template = template.flatten()\n      }\n      template[fileType]().toBuffer().then(function(templateBuffer){\n        dfd.resolve({\n          Body: templateBuffer,\n        });\n      });\n    } else {\n      if(s.extract){\n        userPhoto.extract(s.extract);\n      }\n      if(s.extend){\n        userPhoto.extend(s.extend);\n      }\n      userPhoto = userPhoto.background(bgColor);\n      if (!templateCroppingMode) {\n        userPhoto = userPhoto.flatten();\n      }\n      userPhoto.toBuffer().then(function(userPhotoBuffer){\n        var userPhoto = sharp(userPhotoBuffer);\n        userPhoto.resize(1200,1200);\n        if  (templateCroppingMode) {\n          userPhoto.png().toBuffer().then(function(userPhotoBuffer){\n            dfd.resolve({\n              Body: userPhotoBuffer,\n            });\n          });\n        } else {\n          var template = sharp(templateFetchResponse.data.Body);\n          template.resize(1200, 1200).min().max();\n          template.toBuffer().then(function(templateBuffer){\n            userPhoto.overlayWith(templateBuffer, {\n              top: 0,\n              left: 0\n            });\n            userPhoto.jpeg().toBuffer().then(function(userPhotoBuffer){\n              dfd.resolve({\n                Body: userPhotoBuffer,\n              });\n            });\n          });\n        }\n      })       \n    }    \n    return userPhoto\n  });\n  return dfd.promise();\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/meldAndCropImages.js","module.exports = function(cropSettings,userPhotoWidthHeight){\n  var limit = 1200;\n  // var scale = overlaySettings.scale;\n  var cropWidth = cropSettings.width;\n  var cropHeight = cropSettings.height;\n  var cropTop = cropSettings.top;\n  var cropLeft = cropSettings.left;\n  var cropRight = cropLeft + cropWidth;\n  var cropBottom = cropTop + cropHeight;\n  var rawWidth = userPhotoWidthHeight.width;\n  var rawHeight = userPhotoWidthHeight.height;\n  var rawRight = rawWidth;\n  var rawBottom = rawHeight;\n  var rawTop = 0;\n  var rawLeft = 0;\n\n  var s = {};\n\n  \n  s.extract = {\n    left: cropLeft > 0 ? cropLeft : 0,\n    top: cropTop > 0 ? cropTop : 0,\n  };\n  s.extract.width = cropRight < rawRight ? cropRight : rawRight;\n  s.extract.width =  s.extract.width - s.extract.left;\n  s.extract.width = s.extract.width > 0 ? s.extract.width : 0;\n  s.extract.height = cropBottom < rawBottom ? cropBottom : rawBottom;\n  s.extract.height =  s.extract.height - s.extract.top;\n  s.extract.height = s.extract.height > 0 ? s.extract.height : 0;\n\n\n\n  s.extend = {\n    left: cropLeft < 0 ? -cropLeft : 0,\n    top: cropTop < 0 ? -cropTop : 0,\n    right: cropRight > rawRight ? cropRight - rawRight : 0,\n    bottom: cropBottom > rawBottom ? cropBottom - rawBottom : 0\n  };\n  \n  s.resize = {\n    width:1200,\n    height:1200\n  }\n\n  s.completelyOutOfBound = false;\n  if(\n    (\n      s.extract.left >= rawRight ||\n      s.extract.top >= rawBottom ||\n      s.extend.left >= cropWidth ||\n      s.extend.top >= cropHeight\n    )\n  ){\n    s.completelyOutOfBound = true;\n  }\n  s.extract = s.extract.width && s.extract.height ? s.extract : null;\n  s.extend = s.extend.left || s.extend.top || s.extend.bottom || s.extend.right ? s.extend : null;\n  s.limit = limit;\n  return s;\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/calcOverlayAndTemplateProcessingSettings.js","/*\n * Respond to GET requests to /get_normalized_image_info.\n * changes size of image if it is too big\n * also rotates exif\n * responds with a new image url\n*/\nimport aws from 'aws-sdk';\nimport jD from 'jquery-deferred';\nimport { x as mongooseStuff } from './mongooseStuff';\n\nexport default ({accessKeyId,secretAccessKey,Bucket,app,userTemplates, urlPattern}) => {\n  var urlToFileData = require('./urlToFileData');\n  var uploadToS3 = require('./uploadToS3')({\n    prepareModuleWithDefaults: true,\n    accessKeyId:accessKeyId,\n    secretAccessKey:secretAccessKey,\n    Bucket:Bucket\n  });\n\n  var parseUrl = require('url').parse;\n\n  var normalizeImageFileData = require('./normalizeImageFileData')({\n    prepareModuleWithDefaults: true,\n    parseSettings: function(s){\n      var filename;\n      var originalFilename;\n      var url;\n      if(s.originalUrl.indexOf('amazonaws.com/') !== -1){\n        var host = s.originalUrl.split('amazonaws.com/');\n        host = host[0] + 'amazonaws.com/';\n        filename = s.originalUrl.split('amazonaws.com/');\n        originalFilename = filename[filename.length - 1];\n        filename = originalFilename.replace('_temp','');\n        filename = filename.split('.');\n        filename = filename[filename.length - 2];\n        filename = filename + '.png';\n        url = host + filename;\n      } else {\n        filename = parseUrl(s.originalUrl).pathname.split('/');\n        filename = filename[filename.length - 1];\n        filename = filename.split('.');\n        filename.pop();\n        filename = filename.join('.');\n        filename = filename + Date.now() + '.png';\n        filename = 'selfies/' + filename;\n        originalFilename = null;\n        url = '//s3-us-west-1.amazonaws.com/bernieapp/' + filename;\n      }\n      s.filename = filename;\n      s.url = url;\n      s.originalFilename = originalFilename;\n      return s;\n    }\n  });\n  var deep = require('deep-get-set');\n  var deleteS3Object = require('./deleteS3Object')({\n    prepareModuleWithDefaults: true,\n    parseSettings: function(s){\n      s.Key = deep(s,'originalFilename');\n      return s;\n    },\n    accessKeyId: accessKeyId,\n    secretAccessKey: secretAccessKey,\n    Bucket: Bucket\n  });\n\n  app.get(urlPattern, function(req, res){  \n    var originalUrl = decodeURIComponent(req.query.image_url);\n    var mustBeSquare = req.query.must_be_square === 'true';\n\n    var respondWithJsonSuccess = require('./respondWithJson')({\n      prepareModuleWithDefaults: true,\n      res:res,\n      isSuccess:true\n    });\n    var respondWithJsonFail = require('./respondWithJson')({\n      prepareModuleWithDefaults: true,\n      res:res,\n      isSuccess:false\n    });\n    var promise = urlToFileData(originalUrl).then(normalizeImageFileData);\n    var promises = [\n      promise,\n      promise.then(deleteS3Object),\n      promise.then(function(fileData){\n        if(mustBeSquare && (Math.abs(fileData.width - fileData.height) > 1)){\n          var dfd = jD.Deferred();\n          dfd.resolve({\n            failingSquare:true\n          });\n          return dfd.promise();\n        } else {          \n          var uploadToS3Promise = this.then(uploadToS3);\n          console.log('uploadToS3');\n          uploadToS3Promise.then(function(){\n            if(mustBeSquare){\n              var userTemplateModel = {\n                created: new Date(),\n                customTemplate: fileData.Key.replace('selfies/','').replace('.png',''),\n                templateHeight: fileData.height,\n                templateWidth: fileData.width\n              };\n              userTemplates.push(userTemplateModel);\n              mongooseStuff.MakeUserTemplate(userTemplateModel);\n            }\n          });\n          return uploadToS3Promise;\n        }\n      }).then(respondWithJsonSuccess)\n\n    ];\n    jD.when.apply(null,promises).then(null,function(err){\n      respondWithJsonFail({error:err})\n    });\n  });\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/endpointGetNormalizedImageInfo.js","var jD = require('jquery-deferred');\nmodule.exports = function(originalUrl){\n  var isHttps = originalUrl.indexOf('https://') !== -1;\n  var url = require('url');\n  \n  var dfd = jD.Deferred();\n  var options = url.parse(originalUrl);\n  var http;\n  if(isHttps){\n    http = require('https');\n  } else {\n    http = require('http');\n  }\n  console.log('http get');\n  http.get(options, function (response) {\n    console.log('GOTTEN');\n    var chunks = [];\n    response.on('data', function (chunk) {\n      chunks.push(chunk);\n    }).on('end', function() {\n      var buffer = Buffer.concat(chunks);\n      var contentType = response.headers['content-type'];\n      dfd.resolve({\n        Body: buffer,\n        ContentType: contentType,\n        originalUrl: originalUrl\n      })\n    }).on('error', (e) => {\n      dfd.reject(e);\n    });\n  }).on('error', (e) => {\n    console.error('urlFileToData http error!!!', e);\n    dfd.reject(e);\n  });;\n\n  return dfd.promise();\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/urlToFileData.js","var jD = require('jquery-deferred');\nvar aws = require('aws-sdk');\nvar prepareModuleWithDefaults = require('./prepareModuleWithDefaults');\n\n\n\nmodule.exports = prepareModuleWithDefaults(function(s){\n  var dfd = jD.Deferred();\n  s = Object.assign({},s);\n  aws.config.update({accessKeyId: s.accessKeyId , secretAccessKey: s.secretAccessKey });\n  var s3 = new aws.S3();\n  \n  //toPass.uploadRequestSettings.originalFilename\n  if(s.Key){\n    s3.deleteObjects(\n      {\n        Bucket: s.Bucket,\n        Delete: {\n            Objects: [\n                 { Key: s.Key }\n            ]\n        }\n      }, function(err, data) {\n          if (err){\n            dfd.reject(err);\n          } else {\n            dfd.resolve(data);\n          }\n      }\n    );\n  } else {\n    console.log('NOTHING TO DELETE');\n    dfd.resolve({msg:'Missing key, nothing deleted.'});\n  }\n  return dfd.promise();\n});\n\n\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/deleteS3Object.js","/*\n * Respond to GET requests to /get_normalized_image_info.\n * changes size of image if it is too big\n * also rotates exif\n * responds with a new image url\n*/\nimport aws from 'aws-sdk';\nimport ensureLeadingSlash from '@defualt/ensure-leading-slash';\nimport respondWithJson from './respondWithJson';\n\nexport default ({\n  app,\n  accessKeyId,\n  secretAccessKey,\n  Bucket,\n  urlPattern\n}) => {\n  // Generates a unique aws url that the client uploads an image to.  Neat.\n  app.get(urlPattern, function(req, res){\n    aws.config.update({accessKeyId: accessKeyId , secretAccessKey: secretAccessKey });\n    var s3 = new aws.S3(); \n    var filename = req.query.file_name;\n    filename = filename.split('.');\n    var secondToLast = filename[filename.length - 2];\n    filename[filename.length - 2] = secondToLast + Date.now()+'_temp';\n    filename = filename.join('.');\n    var s3_params = { \n        Bucket: Bucket, \n        Key: filename, \n        Expires: 60, \n        ContentType: req.query.file_type, \n        ACL: 'public-read'\n    }; \n\n    s3.getSignedUrl('putObject', s3_params, function(err, data){ \n      respondWithJson({\n        res:res,\n        signed_request: err || data,\n        url: 'https://'+Bucket+'.s3.amazonaws.com/'+filename \n      });\n    });\n  });\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/endpointGetS3SignedUploadUrl.js","import ensureLeadingSlash from '@defualt/ensure-leading-slash';\nexport default ({app,accessKeyId,secretAccessKey,Bucket, urlPattern}) => {\n  app.post(urlPattern, function(req, res, next) {\n    var parseUrl = require('url').parse;\n    var normalizeImageFileData = require('./normalizeImageFileData')({\n      prepareModuleWithDefaults: true,\n      parseSettings: function(s){\n        var filename = s.filename;\n        // filename = parseUrl(s.originalUrl).pathname.split('/');\n        // filename = filename[filename.length - 1];\n        filename = filename.split('.');\n        filename.pop();\n        filename = filename.join('.');\n        filename = filename + Date.now() + '.png';\n        filename = 'selfies/' + filename;\n        s.url = '//s3-us-west-1.amazonaws.com/bernieapp/' + filename;\n        s.filename = filename;\n        return s;\n      }\n    });\n    var uploadToS3 = require('./uploadToS3')({\n      prepareModuleWithDefaults: true,\n      accessKeyId:accessKeyId,\n      secretAccessKey:secretAccessKey,\n      Bucket: Bucket\n    });\n    var apiRequestIntoBufferData = require('./apiRequestIntoBufferData');\n    apiRequestIntoBufferData(req).then(normalizeImageFileData).then(uploadToS3).then(function(r){\n      var details = {\n        url:r.url\n      };\n      app.render('iframeuploadbutton.html',{\n        lastData:{\n            width: r.width,\n            height: r.height,\n            public_id:r.Key.replace('selfies/',''),\n            url:r.url\n        },\n        buttonText:decodeURIComponent(req.query.buttonText)\n      },function(err, html){\n        res.end(html);\n      });\n    });\n  });\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/endpointIframeUpload.js","var jD = require('jquery-deferred');\nvar prepareModuleWithDefaults = require('./prepareModuleWithDefaults');\nvar Busboy = require('busboy');\n\nmodule.exports = prepareModuleWithDefaults(function(req){\n  var dfd = jD.Deferred();\n\n  var filenameDfd = jD.Deferred();\n  var busboy = new Busboy({ headers: req.headers });\n  var busboy = new Busboy({ headers: req.headers });\n  var bufferArray = [];\n  var filenamex;\n  var toResolve = {\n    Body: []\n  };\n  busboy.on('file', function(fieldname, file, filename, encoding, mimetype) {\n    // console.log('File [' + fieldname + ']: filename: ' + filename + ', encoding: ' + encoding + ', mimetype: ' + mimetype);\n    toResolve.filename = filename;\n\n    file.on('data', function(data) {\n      // console.log('File [' + fieldname + '] got ' + data.length + ' bytes',data);\n      toResolve.Body.push(data);\n\n    });\n    // file.on('end', function() {\n    //   console.log('File [' + fieldname + '] Finished');\n    // });\n  });\n  // busboy.on('field', function(fieldname, val, fieldnameTruncated, valTruncated, encoding, mimetype) {\n  //   console.log('Field [' + fieldname + ']: value: ' + inspect(val));\n  // });\n  busboy.on('finish', function() {\n    toResolve.Body = Buffer.concat(toResolve.Body);\n    // console.log('Done parsing form!',Body);\n    dfd.resolve(toResolve);\n  });\n  req.pipe(busboy);\n  \n  return dfd.promise();\n\n  /*\n  var data = [];\n  req.on('data', function(chunk) {\n      data.push(chunk);\n  });\n  var endDfd = jD.Deferred();\n  req.on('end', function(x) {\n      var Body = Buffer.concat(data);\n      // console.log(Body)\n      endDfd.resolve({\n        body: data\n      });\n  });\n  req.on('error', function(err) {\n      endDfd.reject(err);\n  });\n  */\n});\n\n\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/apiRequestIntoBufferData.js","module.exports = function(standardModes){\n  if(typeof standardModes === 'string'){\n    standardModes = [standardModes];\n  }\n  var pipedString = ''\n  for(var i =0,l=standardModes.length;i<l;i++){\n    var mode = standardModes[i];\n    pipedString += i > 0 ? '|' + mode : mode;\n\n  }\n  var regx = new RegExp('^/('+pipedString+')(.+)');;\n  return regx;\n};\n\n\n// WEBPACK FOOTER //\n// ../bernieserver/js/generateUrlRegexNamespace.js"],"sourceRoot":""}